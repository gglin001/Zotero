ECG/PPG 量測解決方案

Application Note
Strategic Product Center AN057 – September 2018

摘要
本應用文件介紹了心電圖 (ECG) 與光電容積圖 (PPG) 的基本工作原理，討論了 ECG 與 PPG 生理信號的量測，以及 提高可靠性、實現高精度電氣特性的難點。一般高精準度的 ECG 與 PPG 架構都是採用類比前端和 ADC 組合而成的 解決方案。本文介紹的 RT1025 利用 ECG/PPG 同步採樣 ADC，提供了一個可以同步擷取 ECG/PPG 以應用於血壓 計算的引人注目亮點，及其高度集成的解決方案省去了多個類比前端元件，節省空間的同時也降低了系統成本。 RT1025 符合 IEC 60601-2-27 與 China YY1079 等規範，適用於醫療級 ECG/PPG、健身與穿戴式產品的應用。

目錄
1. 概述.................................................................................................................................................................................2 2. 生理訊號：ECG vs. PPG 與 PTT .................................................................................................................................2 3. 生理訊號處理的挑戰......................................................................................................................................................4 4. ECG 量測電路................................................................................................................................................................5 5. PPG 量測電路 ................................................................................................................................................................6 6. RT1025 產品介紹...........................................................................................................................................................6 7. 總結.................................................................................................................................................................................8

AN057

© 2018 Richtek Technology Corporation

1

ECG/PPG 量測解決方案
1. 概述
心臟運作可以揭露人體許多極具價值的信息，包括其健康、生活方式，甚至是情緒狀態及心臟疾病的早期發病等。傳 統的醫療設備中，監測心跳速率和心臟活動是經由測量電生理訊號與心電圖 (ECG) 來完成，將電極連接到身體來量 測心臟組織中所引發電氣活動的信號。此外，隨著心跳會有一壓力波通過血管，這個波會稍微改變血管的直徑，因此 除了 ECG 外的另一選擇──光體積變化描記圖法 (Photoplethysmography, PPG) 就是利用這個變化，這是一種無需測 量生物電信號就能獲得心臟功能資訊的光學技術。PPG 主要用於測量血氧飽和度 (SpO2)，但也可不進行生物電信號 測量就提供心臟功能資訊。借助 PPG 技術，心率監護儀可集成到手錶或護腕等可穿戴設備上，以達成連續偵測的應 用。
2. 生理訊號：ECG vs. PPG 與 PTT
心電描記術 (Electrocardiography, ECG 或者 EKG) 是一種經胸腔以時間為單位記錄心臟的電生理活動，利用在人體 皮膚表面貼上的電極，可以偵測到心臟的電位傳動，而心電圖所記錄的並不是單一心室或心房細胞的電位變化，而是 心臟整體的電位變化。心電圖的結果通常以波型顯示，包括基本有 P 波、QRS 波組、T 波。P 波代表的是心房收縮， QRS 波組則是心室收縮，T 波是心室舒張，有關心跳率的測量或評估，則是以 R 波與 R 波的間隔時間來代表。當 RR 間隔越大代表心跳率越低，RR 間隔越小代表心跳率越高。測量 ECG 信號常常要在身體多個部位連接感測器電極， 在胸部和四肢之間最多可以連接 10 個電極。

資料來源：HEALTHY-AGEING

光體積變化描記圖法 (Photoplethysmography，簡稱 PPG) 是借光電手段在活體組織中檢測血液容積變化的一種無創 檢測方法。當一定波長的光束照射到指端皮膚表面，每次心跳時，血管的收縮和擴張都會影響光的透射 (例如在透射 PPG 中，通過指尖的光線) 或是光的反射 (例如在反射 PPG 中，來自手腕表面附近的光線)。當光照透過皮膚組織然 後再反射到光敏感測器時，光照會有一定的衰減。像肌肉、骨骼、靜脈和其他連接組織對光的吸收是基本不變的 (前 提是測量部位沒有大幅度的運動)，但是血液不同，由於動脈裡有血液的流動，那麼對光的吸收自然也有所變化。當 我們把光轉換成電信號時，正是由於動脈對光的吸收有變化而其他組織對光的吸收基本不變，得到的信號就可以分為 直流 DC 信號和交流 AC 信號。提取其中的 AC 信號，就能反應出血液流動的特點。

AN057

© 2018 Richtek Technology Corporation

2

ECG/PPG 量測解決方案

心臟舒張

心臟收縮

血管

LED

Photo Detector

PPG Optical Module

心臟收縮

Pulse Peak

心臟舒張

下圖是 PPG 信號和 ECG 信號的對比

R-Wave Peak

ECG PPG

心臟收縮

Time Delay
Pulse Peak

心臟舒張

根據 PPG 與 ECG 個別的生理特徵點，我們可以發現 ECG 的峰值來自於心室的收縮，而 PPG 的峰值則是因為血管 收縮所造成的，因此我們可以得到血液自心臟送出後到達量測部位的傳輸時間，也就是脈搏波傳遞時間 Pulse Transit Time (PTT)，脈搏波傳遞的速度與血壓是直接相關的，血壓高時，脈搏波傳遞快，反之則慢，所以通過心電信號 ECG 與脈搏波信號 PPG 獲得脈搏傳遞時間 (PTT)，再加上常規的一些身體參數 (如身高、體重) 即可得出脈搏波傳遞 速度，通過建立的特徵方程來估計人體脈搏的收縮壓與舒張壓，可實現無創連續血壓測量。

AN057

© 2018 Richtek Technology Corporation

3

ECG/PPG 量測解決方案

3. 生理訊號處理的挑戰
ECG 量測的挑戰
一般 ECG 電極需放置在心臟兩側並緊貼皮膚，可以用來記錄心電信號隨時間的變化。實際 ECG 信號的幅度只有幾 毫伏，頻率不超過幾百赫茲。ECG 測量面臨諸多挑戰：一方面，來自 ECG 主電源的 50Hz 至 60Hz 電容耦合干擾要 比心臟信號強許多；另一方面，身體皮膚的接觸阻抗以及感測器之間阻抗的不匹配，這會導致較大的偏差並降低共模 抑制能力；此外，還要解決接觸雜訊以及電磁源產生的干擾問題。此類應用中一些重要的放大器參數包括共模抑制、 輸入偏移電壓和偏移電壓漂移、輸出擺幅以及放大器雜訊，說明如下：
 共模抑制
如前文所述，放置在患者皮膚上的電極可能有大約數百毫伏特的直流電壓，而有用訊號的電壓通常小於一毫伏特。 儀表放大器配置非常適合這種情況，該放大器將消除任何與差分輸入共模的訊號 (來自電極或任何共模雜訊，如 60Hz 干擾)，同時放大有用的心電訊號。在這種情況下，考慮放大器電路的共模抑制參數是非常重要的，不僅針 對直流訊號，還要考慮跨頻率，尤其是線路頻率為 50Hz 或 60Hz 時。具有高共模抑制比的放大器將消除更多不需 要的雜訊並實現更高精度的測量。
 輸入偏移電壓和偏移電壓漂移
由於有用電壓相當小，放大器需要提供增益，以提高檢測電路的解析度。此應用需要高增益，因此放大器的偏移 電壓非常重要。放大器產生的任何偏移電壓都將乘以電路增益，例如，假定心臟收縮在皮膚上的一個指定電極上 產生 1 毫伏特電壓，假定放大器電路的增益設置為 1000，則放大器電路的理想輸出為 1 伏特，但如果放大器的輸 入偏移電壓為 100 微伏特時，則將在輸出產生 100 毫伏特的誤差 (佔有用訊號的 10%)。值得注意的是，放大器的 輸入偏移誤差以輸入為參考，因此，誤差將與放大器的增益成比例。
與所有電子元件一樣，放大器的特性會隨時間和溫度發生變化，其電壓偏移也是如此。放大器電壓偏移是誤差的 來源，隨著偏移電壓的漂移，此誤差可能變得更大。然而，透過選擇低漂移放大器 (如採用自動歸零校準架構的 放大器) 或者定期執行系統校準，藉此校正失調和漂移的運算放大器，可大幅度地減小此類誤差源帶來的影響。
 放大器輸出擺幅
在前面的示例中，電極上 1 毫伏特電壓變化會在放大器電路的輸出上產生 1 伏特的電壓變化。對於 5 伏特單電源 系統，這代表放大器電路可精確檢測 0 ~ 5 毫伏特的電壓，放大器需要輸出可擺動到最低與最高的電源軌。相反 地，如果放大器不支援軌對軌的輸出擺動，則電壓的動態範圍會變小，就無法正確檢測出完整的輸入訊號，因而 會限制檢測電路的動態範圍，無法做出精確的偵測。
 放大器雜訊
當評估此類應用的放大器時，另一個必須考慮的重要參數是放大器雜訊。值得注意的是，放大器的雜訊可能不會 隨頻率保持恆定，尤其是在 1/f 雜訊可成為主要噪音源的低頻率下；在 ECG 應用中，有用的訊號頻寬通常為直流 到 100Hz，因此 1/f 雜訊仍是誤差源之一。
PPG 量測的挑戰
測量 PPG 面臨的主要挑戰來自環境光和運動產生的干擾。陽光產生的直流誤差相對而言比較容易消除，但日光燈和 節能燈發出的光線都帶有可引起交流誤差的頻率分量。運動也會干擾光學系統，當光學心率監護儀用於睡眠研究時， 這可能不是問題，但如果在活動期間穿戴，則將很難消除運動偽像，光學感測器 (LED 和光電檢測器) 和皮膚之間的 相對移動也會降低光信號的靈敏度。
此外，運動的頻率分量也可能會被誤判為心率，因此，必須測量該運動並進行補償。設備與人體之間相貼越緊密，這 種影響就越小，但採用機械方式消除這種影響幾乎是不可能的。通常可使用多種方法來測量運動的干擾，其中一種是 光學方法，即使用多個 LED 波長。共模信號表示運動，而差分信號用來檢測心率。不過，最好是使用真正的運動感 測器，該感測器不僅可準確測量應用於可穿戴設備的運動，而且還可用於提供其他功能，例如跟蹤活動、計算步數或 者在檢測到特定 g 值時啟動某個應用。

AN057

© 2018 Richtek Technology Corporation

4

ECG/PPG 量測解決方案
4. ECG 量測電路
典型的 ECG 設備通常利用 AFE 進行信號放大、濾波，然後通過一個 ADC 進行資料獲取。使用低解析度 (16 位元) ADC 時，信號需要被顯著增益 (增幅通常為 100 ~ 200 倍) 以達到必要的解析度。使用高解析度 (24 位元) Σ-ΔADC 時， 信號僅需要 4 ~ 5 倍的適度增益。因此可以除去消除直流偏移所需的第二增益級和電路。這將實現面積與成本上的整 體縮減。Σ - ΔADC 方法還將保留信號的整個頻率內容，並為資料後期處理提供充分的靈活性。
儀表放大器 (IA) 儀表放大器 (IA) 的主要任務是抑制共模信號 (通常是 50Hz/60Hz 干擾)，ECG 應用需要 90dB 甚至更高的共模抑制比 (CMRR) 以抑制放大電路從電源耦合的 50Hz/60Hz 信號。即使採用具有高共模抑制比 (CMRR) 的 IA，不同 ECG 電 極的差異或者是皮膚接觸阻抗之間的不匹配不僅產生偏移電壓漂移，也會導致 CMRR 低於所期望的水準。阻抗的不 匹配主要源於電極與皮膚的物理接觸、排汗和肌肉運動等原因。隨後要考慮的因素是 IA 的增益，設置 IA 增益時必須 注意避免增益過大導致削波或飽和。IA 的輸入阻抗指標也很重要，因為 ECG 測量的是微弱信號。推薦選擇具有高阻 輸入的 IA，因為較低的輸入阻抗會導致較大的信號衰減。
第二級放大 (PGA) 利用 IA 和濾波器消除雜訊和干擾後，再進行第二級放大，提供額外的增益以達到 ADC 的輸入量程。有些設計還添加 了一個陷波濾波器，對 50Hz/60Hz 作進一步抑制。
低通/抗混疊濾波器 (Filter) 低通濾波器用來抑制高頻干擾，同時起到一個抗混疊濾波器 (Anti-aliasing Filter) 的作用，即阻止任何大於奈奎斯特或 1/2 採樣頻率的信號，避免產生 ADC 混疊。
為了進一步降低輸入共模信號，ECG 設計通常還引入一級「右腿驅動器」 (VRLD)，驅動反相共模信號返回人體。為 了確保病人的安全，通常利用一個運算放大器和一個限流電阻以確保驅動到人體的是一個非常微弱的信號源。這個右 腿驅動器可以降低 ECG 電極承載信號的雜訊耦合。

Filter

IA

PGA

VRLD

ECG ADC

AN057

© 2018 Richtek Technology Corporation

5

ECG/PPG 量測解決方案
5. PPG 量測電路
PPG 的量測電路包含：光發射驅動系統中的 LED，以及測量光電二極體返回信號的電路。目標是通過消耗的一定 LED 電流量 (電流傳輸比)，測量盡可能高的光電流。光電二極體的輸入接收信號透過轉導放大器 (TIA) 而放大、濾 波，然後通過一個 ADC 進行資料獲取。
環境光干擾是一個大問題，尤其是當調製光時，比如使用 LED 或節能燈的固態照明系統。為了獲得良好的信號回 應，要透過數位信號處理降低環境光干擾的影響，這是一個關鍵功能，能夠非常有效地抑制外部光干擾。

Photo Detector

Ambient Cancel

Filter

LED

TIA

PGA

PPG Driver

PPG ADC

LED + AMB AMB

6. RT1025 產品介紹
RT1025是一個高度集成用來量測心律與心電訊號的前端電路。RT1025整合了低雜訊的電壓與電流放大線路，因此 可以同時量測ECG和PPG訊號。RT1025量測心電訊號時具有大於100dB的動態輸入範圍，並提供從64Hz至4kHz的 高精準度擷取率。透過高集成的電路設計，僅需少數的外部零件，即可設計於低功耗的醫療級ECG/PPG、健身與穿 戴式產品的應用。RT1025提供3.1mm x 3.4mm, 41-Ball, 0.4mm pitch, WL-CSP的封裝。RT1025符合IEC 60601-227與China YY1079等規範，適用於醫療級ECG/PPG、健身與穿戴式產品的應用。

RT1025內含4kB SRAM用於資料緩衝，透過外部的晶體震盪器提供參考時脈，可以利用I2C或是SPI與微處理器溝通 傳遞信息，以下為RT1025的應用電路。

AN057

© 2018 Richtek Technology Corporation

6

ECG/PPG 量測解決方案

ECG Electrode
Boost

RT1025

INP_ECG INN_ECG VRLD INP_PPG

AVDD_HV AVDD28 DVDD18 DVDDIO

1.8V 1.8V~3.6V
2.2uF

INN_PPG
TX1 TX2

XTALI RESETB AFE_PWD I2C / SPI
INT

32kHz / NC RESETB AFEPWD I2C / SPI
INT

VBG

1uF

GND_A GND_HV GND_D

2.8V 2.2uF

2.8V 2.2uF

MCU

2.2uF

RT1025 產品特點
 ECG Channel Features
Supports Two-Electrode (2E) Mode and Right Leg Drive (RLD) Mode Low Noise PGA and High Resolution ADC Input Impedance : 125M to 500MΩ at Two-Electrode Mode and > 1GΩ at Right Leg Drive Mode Low Input-Referred Noise : 0.67μVrms (64Hz ODR, Gain = 12) Dynamic Range : 110dB at Gain = 6 CMRR > 85dB at 60Hz Data Rate : 64SPS to 4k SPS
 PPG Channel Features
Flexible Timing Control and Support Dynamic Power Down TX Supports H-bridge and Push/Pull Mode TX LED Current Range : 10 / 25 / 35 / 50 / 65 / 75 / 90 / 105mA, Each with 8-bit Current Resolution Input Maximum Current Range : 0.5 to 50μA Input Maximum Capacitance : 1nF Input-Referred Noise : 50pArms at 5μA Input Current CMRR > 80dB at 60Hz PGA Gain : 1 to 6V/V Ambient DAC1/DAC2 Range : 1 to 6μA
 Others
2-in-1 Bio-Sensing AFE (Voltage/Current) Built-In Heartbeat Interval Estimation Integrates an Oscillator to offer High-Precision Clock with External Crystal Support I2C and SPI I/F for MCU On-Chip SRAM for Data Buffering Ultra-Low Power Consumption Operating Temperature Range : –20°C to 65°C Small 3.1mm x 3.4mm, 41-Ball, 0.4mm Pitch, and WL-CSP Package RoHS Compliant and Halogen Free

AN057

© 2018 Richtek Technology Corporation

7

ECG/PPG 量測解決方案
ECG/PPG量測評估版 為 了 快 速 評 估 RT1025 的 特 性 ， 立 錡 科 技 開 發 了 ECG/PPG AFE Daughter Board (PCB107_V1) 以 及 Cardioid Evaluation Board (PCB106_V1) 與配對的安卓手機應用軟體 (Cardio EVK)，相關規格書與應用資料請參考立錡科技 網站http://www.richtek.com。

Daughter Board (PCB107_V1)

Cardioid Evaluation Board (PCB106_V1)

7. 總結
RT1025 是可以同時滿足 ECG/PPG 測量要求的器件，在不增加成本的前提下提供理想的特性指標，同步擷取 ECG/PPG 的訊號，可以提升 PTT 血壓計算的準確度，有助於降低您的研發預算、縮短設計階段、縮小電路板面積並 減少系統的元件數量，同時也提高了方案的性能和可靠性。

相關資源
立錡科技電子報

訂閱立錡科技電子報

Richtek Technology Corporation 14F, No. 8, Tai Yuen 1st Street, Chupei City Hsinchu, Taiwan, R.O.C. Tel: 886-3-5526789

Richtek products are sold by description only. Richtek reserves the right to change the circuitry and/or specifications without notice at any time. Customers should obtain the latest relevant information and data sheets before placing orders and should verify that such information is current and complete. Richtek cannot assume responsibility for use of any circuitry other than circuitry entirely embodied in a Richtek product. Information furnished by Richtek is believed to be accurate and reliable. However, no responsibility is assumed by Richtek or its subsidiaries for its use; nor for any infringements of patents or other rights of third parties which may result from its use. No license is granted by implication or otherwise under any patent or patent rights of Richtek or its subsidiaries.

AN057

© 2018 Richtek Technology Corporation

8

