Pulse Transit Time and Heart Rate Variability in Sleep Staging
Sobhan Salari Shahrbabaki1,∗, Beena Ahmed2, Thomas Penzel3 and Dean Cvetkovic 1

Abstract— This paper presents a new and robust algorithm for detection of sleep stages by using the lead I of the Electrocardiography (ECG) and a ﬁngertip Photoplethysmography (PPG) sensor, validated using multiple overnight PSG recordings consisting of 20 human subjects (9 insomniac and 11 healthy). Heart Rate Variability (HRV) and Pulse Transit Time (PTT) biomarkers which were extracted from ECG and PPG biosignals then employed to extract features. Distance Weighted k-Nearest Neighbours (DWk-NN) was used as classiﬁer to differentiate sleep epochs. The validation of the algorithm was evaluated by Leave-One-Out-Cross-Validation method. The average accuracy of 73.4% with standard deviation of 6.4 was achieved while the algorithm could distinguish stages 2, 3 of non-rapid eye movement sleep by average sensitivity of almost 80%. The lowest mean sensitivity of 53% was for stage 1. These results demonstrate that an algorithm based on PTT and HRV spectral analysis is able to classify and distinguish sleep stages with high accuracy and sensitivity. In addition the proposed algorithm is capable to be improved and implemented as a wearable, comfortable and cheap instrument for sleep screening.
I. INTRODUCTION
According to the American Academy of Sleep Medicine (AASM-2007) guidelines, there are two distinguished types of sleep, Rapid Eye Movement (REM) and Non-Rapid Eye Movement (NREM) which is further divided in to three stages (NREM1, NREM2 and NREM3) [1]. A hypnogram graphically represents stages of sleep as a function of time. It is obtained from the simultaneous recording and analysis of Electroencephalography (EEG), Electrooculography (EOG) and sub-mental Electromyography (EMG) according to the AASM criteria during a polysomnography test. AASM criteria deﬁne each sleep stage has unique characteristics including variations in wave patterns, eye movements, and muscle tone. A typical night’s sleep consists of 25% of REM and 75% of NREM, though REM and NREM cyclically alternate [2]. The overnight sleep recording is divided into 30s epochs where each 30s epoch is assigned a sleep stage designation. During transition between sleep stages, several physiological parameters associated to autonomic nervous system (ANS) such as heart rate, body temperature, respiratory rate and blood pressure may alter. In this study, we speciﬁcally focused on two measures of cardiac activity regulated by ANS and their relations with sleep stages.
The ﬁrst measure of ANS was Heart Rate Variability (HRV) which refers to beat-to-beat variations of heart rate.
1School of Engineering, RMIT University, Melbourne, Australia ∗Corresponding author: sobhan.salaryshahrbabaki@rmit.edu.au 2Electrical and Computer Engineering Program, Texas A&M University at Qatar, Doha, Qatar 3Charite Universitatsmedizin Berlin, Berlin, Germany

Spectral analysis of HRV provides a quantitative evaluation of the sympathetic/parasympathetic interaction [3]. HRV spectral analysis establishes three frequency bands. The bands are typically called very low frequency (VLF) from 0.0033 to 0.05 Hz, low frequency (LF) from 0.05 to 0.15 Hz, and the high frequency (HF) from 0.15 to 0.5 Hz . LF band is mainly associated to the sympathetic activity while HF is related to the parasympathetic activity. Several researches recently have investigated applying HRV features to classify the different sleep stages. [4], [5]. In 2010, Yilmaz et al claimed that one lead ECG was capable in determining sleep stages and the degree of apnoea/hypopnea index (AHI) [4]. Their features extraction approach had been based upon time statistical analysis of R-R intervals and they evaluated three classiﬁcation method, k-NN, Support Vector Machine (SVM) and Quadratic Discriminant Analysis (QDA).The accuracy of their algorithm with k-NN, SVM and QDA classiﬁcation were correspondingly 68.9%, 71.5% and 73.1%. Similarly, Xiao et al developed a new method for sleep staging based upon temporal and spectral analysis of HRV [5]. Their proposed method achieved sleep staging with high mean accuracy.
The second cardiovascular measure that we utilised for sleep staging was Pulse Transit Time (PTT). PTT is the time that takes the Pulse Pressure (PP) waveform to propagate through a length of the arterial tree. PTT is assumed as the time delay between R-wave of QRS complex in electrocardiography (ECG) waveform and the consecutive arrival point in photoplethysmography (PPG) [6]. PTT has been shown in several literatures as a marker for autonomic cortical and respiratory activities during the sleep [7], [8], [9].
The objective of this paper was to employ both PTT and spectral features of HRV to develop an algorithm for automatic sleep staging. We investigated whether it was possible to detect sleep stages using the lead I of the ECG along with a ﬁngertip PPG sensor.
II. METHODOLOGY
A. Data Acquisition
We analysed 20 subjects’ overnight polysomnography (PSG) datasets which had been collected at the Center for Sleep Medicine, Charite University Hospital (Berlin, Germany). 9 subjects were diagnosed with insomnia whilst the rest were healthy. Data had been recorded using a SOMNOscreen PSG system (SOMNOscreen PM, SOMNOmedics, USA). ECG and PPG data was included in PSG datasets and hypongrams were automatically scored by DOMINO sleep analysis software (DOMINO 2.6.0, SOMNOmedics, USA).

978-1-4577-0220-4/16/$31.00 ©2016 IEEE

3469

B. Data Preparation
The ECG signals had been recorded at a frequency sampling rate (Fs) of 256 Hz whilst Fs for the PPG recordings was 128 Hz. Then ECG signals were ﬁrstly downsampled to Fs=128 Hz to match with PPG recordings. Sleep staging had been determined in the epoch with duration of 30 seconds. We divided each 30 sec epoch into two sub-epochs with duration of 15 sec. Similarly, PPG and ECG recordings were split up into 15 sec segments (sub-epochs) in order to estimate PTT and HRV spectral features with higher accuracy and precision.

C. PTT Estimation

PTT is the time taken by the pulse wave travel between two arterial sites. The ﬁrst site is once ventricles depolarise and pump blood into the body. This event is represented by QRS complex and R-wave as the highest peak of the complex. We applied Murthy et al algorithm to detect the R-waves [10]. The second arterial site is known as the pulse pressure arrival point and detected using the ﬁngertip PPG sensor. Firstly PPG signals were smoothed by passing through 5-point moving average window. Then the ﬁrst derivative of PPG which is known as the velocity of plethysmography (VPG) was computed to detect the arrival time of the pulse, as follow:

1

V PG[n] = (PPG[n + 1] − PPG[n − 1])

(1)

2T

where n is the data samples and T is the time interval.

In this paper, the time delay between the R wave in the ECG and the consecutive peak of VPG was considered as PTT (Fig. 1). We segmented biosignals into sub-epochs with duration of 15 sec, thus the average PTT of each sub-epoch was considered as its PTT feature.

D. HRV spectral analysis
HRV data was derived from beat-to-beat heart rate or R-R interval. Once R waves of ECG were identiﬁed for each 15s segments, HRV was computed as the time delay between to consecutive R waves. The obtained HRV was resampled at 2 Hz and transformed to frequency domain using Welch’s method [11]. The LF band power was deﬁned as the normalised percentage power in the LF frequency band (0.05-0.15 Hz), and the HF band power was deﬁned as the normalised percentage power in the HF band frequency (0.15-0.5 Hz) [3]. By this means, we computed spectral power of HF and LF as HRV features for every segment.

E. Development of Classiﬁer
The classiﬁer was developed to distinguish whether each 15 sec sub-epoch belonged to NREM1, NREM2, NREM3 and REM sleep stages. The features matrix consisted of the PTT, HF and LF band power of all sub-epochs in an overnight recording. We compared the performance of several classiﬁer models with Distance Weighted k-Nearest Neighbourhood (DWk-NN) algorithm providing the highest sleep stage classiﬁcation accuracy. The outcomes of DWkNN was considerably more accurate and reliable than other types of k-Nearest Neighbours algorithm. DWk-NN is a reﬁnement of k-NN classiﬁcation method and assigns to weigh of contribution of the k-Neighbours according to their distance to the query point [12].

F. Performance Analysis

In order to assess the performance of purposed algorithm, we applied three statistical measures including sensitivity, positive predictive value (PPV) and accuracy which were calculated as following:

TP

Sensitivity =

× 100%

(2)

TP+FN

TP

PPV = T P + FP × 100%

(3)

TP+TN

Accuracy =

× 100% (4)

TP+TN +FP+FN

where TP (True Positive), FP (False Positive), TN (True Negative) and FN (False Negative) indicate the number of sub-epochs whose sleep stages were either correctly or incorrectly identiﬁed.

Fig. 1. PTT estimation by using ECG and ﬁrst derivative of PPG. PTT is pulse transit time from R wave to the consecutive peak of VPG.

III. RESULTS
Leave-one-out-cross-validation (LOOCV) algorithm hwas used to assess the validation of our algorithm. Of the total 20 subjects in our dataset, features from 19 subjects were used for training and data from the remaining one more subject used test. This process was being replicated for all 20 subjects and the overall sensitivity, PPV of each stage and accuracy of whole was computed. The results are reported in Table I and demonstrate how algorithm performed in the detection of sleep stages when used on 15 sec sub-epochs.

3470

TABLE I PERFORMANCE OF THE ALGORITHM USING LOOCV METHOD. SEN AND PPV INDICATE RESPECTIVELY SENSITIVITY AND POSITIVE PREDICTIVE
VALUES. H AND I REPRESENT DIAGNOSED HEALTHY AND INSOMNIA SUBJECT CORRESPONDINGLY.

Subject ID Conditions

Wake

NREM1

NREM2

NREM3

REM

Accuracy

SEN(%) PPV(%) SEN(%) PPV(%) SEN(%) PPV(%) SEN(%) PPV(%) SEN(%) PPV(%)

(%)

1

I

35

63

43

55

81

66

86

90

73

73

71.3

2

H

70

70

46

48

80

73

63

67

63

59

73.0

3

H

54

65

56

64

79

72

88

87

85

84

75.3

4

I

84

85

59

53

82

77

88

91

60

71

82.8

5

H

94

94

59

68

71

66

82

76

74

74

82.8

6

H

76

77

43

46

73

66

66

66

80

81

70.2

7

I

79

82

61

70

83

77

95

91

75

74

82.7

8

I

68

81

74

58

82

75

90

92

64

59

78.8

9

I

64

84

44

60

89

65

86

87

69

68

71.8

10

H

55

69

49

58

77

68

84

81

59

62

69.1

11

I

55

69

55

66

77

68

74

71

66

66

68.3

12

H

36

75

43

73

90

64

82

86

22

60

69.5

13

H

49

68

43

58

84

55

84

84

23

56

65.0

14

I

36

60

49

59

87

71

76

82

58

78

74.4

15

H

92

87

59

61

53

55

76

57

70

68

81.0

16

I

38

70

55

56

82

59

90

91

47

61

66.8

17

H

72

81

86

71

66

68

89

82

81

94

75.3

18

H

71

75

39

43

72

59

68

64

72

68

62.9

19

I

57

78

36

53

87

75

73

72

81

79

73.4

20

H

60

76

58

57

63

61

85

78

57

62

68.4

Mean Std

-

61.9

74.7

53.1

77.7

80.7

67.0

81.3

79.8

64.0

69.9

73.4

-

18.3

10.0

12.1

8.2

9.4

6.8

8.8

10.5

17.1

9.9

6.4

IV. DISCUSSION
Several PSG recordings such as EEG, eye movement and sub-mental EEG are required to identify sleep stages. In this study, we focused on ECG and PPG biosignals which are used to monitor cardiovascular functions, for automatic detection of sleep stages. PTT has been known as a reliable and non-invasive measure for widespread applications from continuous measurement of blood pressure to the sleep events detection e.g apneic episodes or micro-arousals [7], [8], [13]. Since PTT is a marker of autonomic function, we hypothesised it can take an effective role in the determination of sleep stages. Because of the shorter duration, we were able to monitor and analyse changes in HRV band frequencies and PTT values more precisely. Then, we developed an algorithm based on extracted features from PTT biomarker and spectral features of HRV to identify the sleep stages of sub-epochs and a DWk-NN classiﬁer. LOOCV was used to test the performance of our developed algorithm.
Our algorithm achieved mean accuracy of 73.4%. The accuracy was not below of 60%, whilst it reached over 80% in 4 subjects. Indicating that the algorithm was able to classify 15 sec sub-epochs based upon their sleep stages. The average sensitivity for the differentiation of wake sub-epochs from sleep epochs was 61.9%. Similarly, the algorithm could iden-

tify sub-epochs with NREM sleep stage 1, 2 and 3 with an average sensitivity of 53.1%, 80.7% and 81.3%, correspondingly. Whilst the mean sensitivity of algorithm for REM subepochs was about 64%. Our algorithm was more powerful in stages 2 and 3 of NREM with an average sensitivity of over 80%. The average PPV for the detection of wake sub-epochs was 73.5% whilst it was 77.2%, 67.0%, 79.8% and 69.9% for classiﬁcation of NREM1, NREM2, NREM3, and REM respectively. The mean accuracy of patients with Insomnia was 74.5% nonetheless reached 72.4% in healthy subjects. The average accuracy of both groups were very approximate, it therefore illustrates that the algorithm performance was completely independent of patients conditions. On comparing the average sensitivity of the two patient groups, we found that the algorithm was able to classify NREM1 sub-epochs in healthy subjects with a 0.7% greater sensitivity than insomnia patients. On this contrary, the algorithm was more sensitive to identify NREM2, NREM3 and REM sub-epochs in patients with insomnia than healthy subjects where the average sensitivity was greater by 9.3%, 5.4% and 3.5% respectively. The proportion of waking sub-epochs in patients with insomnia should be more than healthy subjects. Thus, we expected the higher number waking epochs would affect the accuracy of algorithm and consequently overestimated

3471

the number of detected waking epochs in insomniac patients. However, we observed the mean sensitivity of detected waking epoch in healthy group was overwhelmingly greater than insomniac group by 9.9%.Therefore, the performance of proposed technique was not associated to sleep latency. Previously, researchers suggested methods for sleep staging based on HRV analysis [4], [5], but we did sleep staging by a combination of PTT and HRV.
V. CONCLUSIONS
In this paper, we recommended a new algorithm to classify sleep stages using a combination of PTT and HRV features extracted from one ECG lead and ﬁngertip PPG recordings. The algorithm average accuracy of 73.4% when the lowest accuracy was about 63% manifests that the classiﬁcation model performed successfully. The algorithm was evaluated in two group subjects (healthy and insomnia patients) and we achieved similar results in both cases. This indicates that our recommended method can distinguish sleep stages regardless of the human subjects’ conditions. Development of the algorithm was completely independent of EEG, sub-mental EMG and eye movement recordings and their considerable number of electrodes and sensors. It means that our suggested method requires fewer recordings and subsequently fewer electrodes. Hence, the patient would feel more comfortable during the recording. Furthermore, wearable technologies have recently become extremely popular for screening purposes, as a consequence a sleep staging technique which is not very complicated and does not require a bunch of sensors and electrodes could be highly desirable. For improving the performance and reaching higher accuracy in sleep staging, further spectral and temporal HRV features along with PTT biomarker can be evaluated. The algorithm can be implemented and used as a simple, reliable and wearable instrument for sleep screening.

[6] R. Smith, J. Agord, J. Pepin and P. Levy, ”Pulse transit time: an appraisal of potential clinical applications”, Thorax, Vol 54(5), pp. 452–457, 1999, doi:10.1136/thx.54.5.452.
[7] E. S. Katz, J. Luiz, C. Black andC. L. Marcus, ”Pulse transit time as a measure of arousal and respiratory effort in children with sleepdisordered breathing”, Pediatric Research, Vol 53(4), pp. 580–588, 2003, doi: 10.1203/01.PDR.0000057206.14698.47.
[8] J. L Pepin, N. Delavie, I. Pin et al, ”Pulse transit time improves detection of sleep respiratory events and microarousals in children”, Chest, Vol 127(3), pp. 722–730, 2005.
[9] D. Poyares, C. Guilleminault, A. Rosa et al, ”Arousal, EEG spectral power and pulse transit time in UARS and mild OSAS subjects”, Clinical Neurophysiology, Vol 113, pp. 1598–1606, 2002.
[10] I. S.N Murthy, M. R Rangaraj, K. J Udupa et al, ”Homomorphic analysis and modeling of ECG signals”, IEEE Transaction on Biomedical Engineering, Vol 29, pp. 330–344, 1979.
[11] P. D. Welch, ”The use of fast fourier transform for the estimation of power spectra: A method based on time averaging over short, modiﬁed periodograms”, IEEE Transactions on Audio and Electroacoustics, Vol 15(2), pp. 70–73, 1967.
[12] Z. Hajizadeh, M. Taheri and M. Zolghadri Jahromi, ”Nearest neighbor classiﬁcation with locally weighted distance for imbalanced data”, International Journal of Computer and Communication Engineering, Vol 3(2), pp. 81–86, 2014.
[13] H. Gesche, D. Grosskurth, G. Kchler et al, ”Continuous blood pressure measurement by using the pulse transit time: comparison to a cuffbased method”, European Journal Application Physiology, pp. 309– 315, 2011.

ACKNOWLEDGMENT
This work was supported by NPRP grant #[5-1327-2-568] from the Qatar National Research Fund which is a member of Qatar Foundation. The statements made herein are solely the responsibility of the authors.

REFERENCES
[1] M. H. Silber, S. Ancoli-Israel, M. H.Bonnet et al, ”The visual scoring of sleep in adults”, Clinical Sleep Medicine, Vol 3(2), pp. 121–131, 2007.
[2] H. R. Colten and B. M. Altevogt, ”Sleep disorders and sleep deprivation: An unmet public health problem. in ”National Academies Press”, Institute of Medicine (US) Committee on Sleep Medicine and Research, Vol 2, 2006, doi:10.17226/11617.
[3] S. Elsenbruch, M. J.Harnish and W. C. Orr, ”Heart rate variability during waking and sleep in healthy males and females”, Sleep, Vol 22(8), pp. 1067–1071, 1999.
[4] B. Yilmaz, M. H Asyali, E. Arikan et al, ”Sleep stage and obstructive apneaic epoch classiﬁcation using single-lead ECG”,BioMedical Engineering OnLine, Vol 9(39), pp. 1–14, 2010.
[5] M. Xiao, H. Yan, J. Song, Y. Yang, X. Yang,”Sleep stages classiﬁcation based on heart rate variability and random forest”, Biomedical Signal Processing and Control, Vol 8, pp. 624-633, 2013, doi:10.1016/j.bspc.2013.06.001.

3472

