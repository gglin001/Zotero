"use strict";function LoginFormField(e,i,a){var s=function(e){if(null!=t.error&&e){t.error.html(""),t.error.removeClass("dn");var i=$("<div>").html(e).text();t.error.append(i)}},t=this;this.container=e,this.control=i,this.error=a,this.validators=[],this.isValid=!1,this.validate=function(e,i){i=i||!1;for(var a in t.container.removeClass("notValid").removeClass("valid"),t.validators){var r=t.validators[a].validate();if(r&&!r.isValid)return t.isValid=!1,void(e||(t.container.addClass("notValid"),s(r.errorMessage)))}t.isValid=!0,i||t.container.addClass("valid"),null!=t.error&&(t.error.html(""),t.error.addClass("dn"))},this.showValidationStatus=function(e){t.container.removeClass("notValid").removeClass("valid"),t.isValid?t.container.addClass("valid"):t.container.addClass("notValid"),s(e)},this.applyValidationResult=function(e){t.isValid=e.isValid,t.showValidationStatus(e.errorMessage)},this.showInfoMessage=function(e){t.container.removeClass("notValid").removeClass("valid"),s(e)},this.highlightErrorField=function(){t.container.addClass("notValid").removeClass("valid")}}var userLoginValidation=null;function UserLoginFormBase(r){userLoginValidation=new UserLoginValidation(r.validationServiceEndpoint,r.passwordHttpRequestHeaderKey);var s=function(){r.errorMessageContainer.find(".login-error-span").text(""),r.errorMessageContainer.hide()};s();var t=function(){if(!userLoginValidation)return!0;var e=!0;for(var i in r.formFields)if(!userLoginValidation.isFieldSelectedOrCheckedOrNotEmpty(r.formFields[i])){e=!1;break}return e},o=function(e){var i;e.isValid?s():(r.formFields.password.control.val(""),r.formFields.password.highlightErrorField(),r.formFields.password.control.focus(),(i=e.errorMessage)&&(r.errorMessageContainer.find(".login-error-span").text(i),r.errorMessageContainer.show()),disableSubmitButtonOnError(e,r))},i=this;i.messages={userNameReqired:"&lt;span class=&#39; red i b db mb3 &#39;&gt;User name is required.&lt;/span&gt;",passwordRequired:"&lt;span class=&#39; red i b db mb3&#39;&gt;Password is required.&lt;/span&gt;"},i.updateSubmitButtonAvailability=function(){if(!t())return r.submitButton.hasClass("disabled")||r.submitButton.addClass("disabled"),void r.submitButton.removeClass("active");var e=!0;for(var i in r.formFields)r.formFields[i].isValid||(e=!1);e?(r.submitButton.hasClass("active")||r.submitButton.addClass("active"),r.submitButton.removeClass("disabled")):(r.submitButton.hasClass("disabled")||r.submitButton.addClass("disabled"),r.submitButton.removeClass("active"))},i.validateField=function(e){e.validate(),i.updateSubmitButtonAvailability()},r.errorMessageContainer.find("[aria-label='close dialog']").on("click",function(){clearPostLoginAction(),s()}),r.keepMeLoggedInHelpLink.on("click",function(){showRememberMe&&(showRememberMe(),s(),closeDropdown())}),r.submitButton.on("click",function(e){if(!t())return r.submitButton.hasClass("disabled")||r.submitButton.addClass("disabled"),r.submitButton.removeClass("active"),e.preventDefault(),e.stopPropagation(),!1;if(!userLoginValidation.isAccountValid(r.formFields.userName.control.val(),r.formFields.password.control.val(),r.journalShortName,o))return e.preventDefault(),e.stopPropagation(),!1;var i=!0;for(var a in r.formFields)r.formFields[a].showValidationStatus(),r.formFields[a].isValid||(i=!1);return i?(s(),r.submitButton.addClass("disabled"),r.submitButton.unbind("click"),r.submitButton.on("click",function(e){e.preventDefault(),e.stopPropagation()}),!0):(e.preventDefault(),e.stopPropagation(),!1)})}function UserLoginForm(i){var e=new UserLoginFormBase(i);userLoginValidation&&(i.formFields.userName.validators.push(new RequiredFieldValidator(i.formFields.userName,e.messages.userNameReqired)),i.formFields.userName.control.on("keyup change blur input",function(){e.validateField(i.formFields.userName)}),i.formFields.password.validators.push(new RequiredFieldValidator(i.formFields.password,e.messages.passwordRequired)),i.formFields.password.control.on("keyup blur input",function(){e.validateField(i.formFields.password)}),i.formFields.password.control.change(function(){e.validateField(i.formFields.password),""!==i.formFields.password.control.value&&e.validateField(i.formFields.userName)})),this.init=function(){for(var e in i.type,i.submitButton.addClass("disabled"),i.formFields){i.formFields[e].validate(!0)}i.errorMessageContainer.hide()}}function disableSubmitButtonOnError(e,i){e.isValid||i.submitButton.hasClass("disabled")||i.submitButton.addClass("disabled")}function ValidationResult(e,i){return{isValid:e,errorMessage:i}}function RequiredFieldValidator(e,i){var a=this;this.field=e,this.errorMessage=i,this.validate=function(){var e=a.field.control.prop("tagName").toLowerCase();if("input"===e){var i=a.field.control.attr("type");return"checkbox"===i?new ValidationResult(a.field.control.is(":checked")):("text"===i||"email"===i||"password"===i)&&""===a.field.control.val().trim()?new ValidationResult(!1,a.errorMessage):new ValidationResult(!0)}return"select"===e?new ValidationResult("-1"!==a.field.container.find(":selected").val(),a.errorMessage):new ValidationResult(!0)}}function UserLoginValidation(e,i){var d=e,u=i;return{isAccountValid:function(e,i,a,r){return s=i,t=a,o=r,n=d+"/IsAccountValid?userName="+encodeURIComponent(e)+"&journalShortName="+encodeURIComponent(t),l=!1,$.ajax({url:n,type:"GET",async:!1,dataType:"json",success:function(e){e?(o(new ValidationResult(e.IsValid,e.ErrorMessage)),l=e.IsValid):(o(new ValidationResult(!1,"The service is irresponsible, please try again later.")),l=!1)},error:function(e,i,a){o(new ValidationResult(!1,"The service is irresponsible, please try again later.")),console.error("The service is irresponsible. Status: "+i+". Error: "+a),l=!1},beforeSend:function(e){e.setRequestHeader(u,s)}}),l;var s,t,o,n,l},isFieldSelectedOrCheckedOrNotEmpty:function(e){return function(e){var i=e.control.prop("tagName").toLowerCase();if("input"===i){var a=e.control.attr("type");return"checkbox"===a?e.control.is(":checked"):"text"!==a&&"email"!==a&&"password"!==a||""!==e.control.val().trim()}return"select"!==i||"-1"!==e.container.find(":selected").val()}(e)}}}