UseR !
Constantino Antonio García Martínez Abraham Otero Quintana Xosé A. Vila María José Lado Touriño Leandro Rodríguez-Liñares Jesús María Rodríguez Presedo Arturo José Méndez Penín
Heart Rate Variability Analysis with the R package RHRV

Use R!
Series editors Robert Gentleman Kurt Hornik Giovanni Parmigiani

Use R!
Moore: Applied Survival Analysis Using R Luke: A User’s Guide to Network Analysis in R Monogan: Political Analysis Using R Cano/M. Moguerza/Prieto Corcoba: Quality Control with R Schwarzer/Carpenter/Rücker: Meta-Analysis with R Gondro: Primer to Analysis of Genomic Data Using R Chapman/Feit: R for Marketing Research and Analytics Willekens: Multistate Analysis of Life Histories with R Cortez: Modern Optimization with R Kolaczyk/Csárdi: Statistical Analysis of Network Data with R Swenson/Nathan: Functional and Phylogenetic Ecology in R Nolan/Temple Lang: XML and Web Technologies for Data Sciences with R Nagarajan/Scutari/Lèbre: Bayesian Networks in R van den Boogaart/Tolosana-Delgado: Analyzing Compositional Data with R Bivand/Pebesma/Gómez-Rubio: Applied Spatial Data Analysis with R
(2nd ed. 2013) Eddelbuettel: Seamless R and C++ Integration with Rcpp Knoblauch/Maloney: Modeling Psychophysical Data in R Lin/Shkedy/Yekutieli/Amaratunga/Bijnens: Modeling Dose-Response Microarray
Data in Early Drug Development Experiments Using R Cano/M. Moguerza/Redchuk: Six Sigma with R Soetaert/Cash/Mazzia: Solving Differential Equations in R
More information about this series at http://www.springer.com/series/6991

Constantino Antonio García Martínez Abraham Otero Quintana Xosé A. Vila • María José Lado Touriño Leandro Rodríguez-Liñares Jesús María Rodríguez Presedo Arturo José Méndez Penín
Heart Rate Variability Analysis with the R package RHRV
123

Constantino Antonio García Martínez University of Santiago de Compostela Santiago de Compostela Spain
Abraham Otero Quintana CEU San Pablo University Madrid Spain
Xosé A. Vila University of Vigo Ourense Spain
María José Lado Touriño University of Vigo Ourense Spain

Leandro Rodríguez-Liñares University of Vigo Ourense Spain
Jesús María Rodríguez Presedo University of Santiago de Compostela Santiago de Compostela Spain
Arturo José Méndez Penín University of Vigo Ourense Spain

ISSN 2197-5736 Use R! ISBN 978-3-319-65354-9 DOI 10.1007/978-3-319-65355-6

ISSN 2197-5744 (electronic) ISBN 978-3-319-65355-6 (eBook)

Library of Congress Control Number: 2017948618

© Springer International Publishing AG 2017 This work is subject to copyright. All rights are reserved by the Publisher, whether the whole or part of the material is concerned, speciﬁcally the rights of translation, reprinting, reuse of illustrations, recitation, broadcasting, reproduction on microﬁlms or in any other physical way, and transmission or information storage and retrieval, electronic adaptation, computer software, or by similar or dissimilar methodology now known or hereafter developed. The use of general descriptive names, registered names, trademarks, service marks, etc. in this publication does not imply, even in the absence of a speciﬁc statement, that such names are exempt from the relevant protective laws and regulations and therefore free for general use. The publisher, the authors and the editors are safe to assume that the advice and information in this book are believed to be true and accurate at the date of publication. Neither the publisher nor the authors or the editors give a warranty, express or implied, with respect to the material contained herein or for any errors or omissions that may have been made. The publisher remains neutral with regard to jurisdictional claims in published maps and institutional afﬁliations.

Printed on acid-free paper

This Springer imprint is published by Springer Nature The registered company is Springer International Publishing AG The registered company address is: Gewerbestrasse 11, 6330 Cham, Switzerland

Foreword
It would be very difﬁcult if not impossible to ﬁnd a signal processing technique applied to cardiac electrophysiology data that gained more popularity than the methods of heart rate variability. The two decades old HRV standardisation document belongs to the most cited publications in cardiovascular literature and the stream of new technical approaches to HRV analyses and of new clinical HRV studies is not showing any sign of decline.
While this is of course most pleasing to specialists in the HRV ﬁeld, the widespread popularity also brings problems and challenges. Among others, technical agreement on the details of signal processing and HRV measurement exists practically only with the most simple statistical methods. Only a small number of more advanced techniques are sufﬁciently standardized. With all others, different nuances in data acquisition, artifact removal, and settings used to implement signal processing methods may inﬂuence the numerical values of HRV measurements to that extent that comparisons of results obtained by different research groups are at best problematic and at worst misleading. The more elaborate mathematical apparatus beyond a signal processing method, the more implementation variants exist, hampering both the physiological understanding of the measurements and consequently their clinical and/or epidemiologic potential. Indeed, the recent extension of the HRV standard that aimed at reviewing and organizing the novel nonlinear HRV methods observed growing divergence between technological HRV advances and their clinical utilization. This divergence exists mainly because the clinical researchers ﬁnd it difﬁcult to be guided by scientiﬁc reports from different centers that might agree in principal observations but not in numerical details.
Solution of these problems clearly lies in further standardization. The more research and clinical groups would use the very same technical setting of HRV processing packages, the more mutually comparable measurements would become available for critical scientiﬁc review, and consequently the more chances would exist to agree on the correct physiologic and clinical interpretation of the advanced signal processing technologies. Of course, without providing the necessary devices to everybody, this all is easier to declare than to achieve. Obviously, widespread tools are needed. Having this in mind, the authors of this book need to be
v

vi

Foreword

commended for their contribution to the attempts of standardizing, under a common umbrella, all the different facets of HRV analyses ranging from data preparation and signal inputs to the more mathematically intricate processing tools. Offering the RHRV package for free and unrestricted use by all is an example of welcome assistance to the research community. For this unselﬁsh approach, the developers of the package and the authors of this book deserve our thanks.

February 2016

Marek Malik Imperial College
London, UK

Preface
The rhythm of the heart is inﬂuenced by both the sympathetic and parasympathetic branches of the autonomic nervous system. There are also some feedback mechanisms modulating the heart rate that try to maintain cardiovascular homeostasis by responding to the perturbations sensed by baroreceptors and chemoreceptors. Another major inﬂuence of the heart rate is the respiratory sinus arrhythmia: the heartbeat synchronization with the respiratory rhythm. All these mechanisms are responsible for continuous variations in the heart rate of a healthy individual, even at rest. These variations are referred to as heart rate variability (HRV). Subtle characteristics of these small variations conceal information about all the mechanisms underlying heart rate control, and hence about the health status of the individual.
Since the 1960s, researchers have developed a wide range of algorithms to extract the information hidden in these variations. Using these algorithms, researchers have found markers for many pathologies such as myocardial infarction, diabetic neuropathy, sudden cardiac death, and ischemia. The starting point for all these algorithms is a simple recording of the instantaneous heart rate of the patient, usually extracted from an electrocardiogram. Therefore, a diagnostic based on a HRV marker is inexpensive, simple to perform, and requires no invasive procedure, making it a very attractive test. This is probably the reason behind the increasing amount of research related to HRV (see Fig. 1).
From the point of view of the authors, the main hindrance in the HRV research ﬁeld is the difﬁculty in reproducing results from other researchers. When a new analysis technique or a new ﬁnding is published in the HRV literature, thinking it will be easy to reproduce the same result on your own data often is a mistake. We have tried it on several occasions. But the exact reproduction of the results was not possible, although we obtained results that qualitatively were similar to the originals. This is due to the lack of standardization in the values of many parameters and other implementation details in the HRV algorithms. Some examples are how exactly ectopic beats are ﬁltered, the algorithm used to interpolate the RR intervals to obtain a time series of constant sampling frequency, how to remove the DC component (from all the RR series, from each window, etc.), the window type
vii

viii
20000

Preface

15000

Number of papers

10000

5000

0
1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016
Date
Fig. 1 Papers on HRV published per year according to Google Scholar
(Hamming, Welch, etc.), window size, and window overlap used in the Fast fourier transform, or the mother wavelet used.
Explicitly or implicitly, in any HRV analysis dozens of decisions on either parameters or implementation details are made. Some of these decisions are difﬁcult to document in a scientiﬁc paper. But they are essential for the faithful and accurate reproduction of the results. Furthermore, the analyses are often performed with a third party tool, whose source code is probably not available. In this case, many of these decisions have been made by the tool developers, and researchers may be unaware of some (even most) of them.
Another hindrance in the ﬁeld is that researchers often use analytical techniques that are not the current state of the art, simply because their tool of choice does not support them, and they do not have the time and/or the necessary expertise to implement the techniques themselves. There is often a disconnect in the HRV literature between researchers who develop new and more powerful analysis techniques (often engineers), and those performing applied research in humans or animals (often physicians). The latter still often uses older less powerful techniques and does not beneﬁt from the progress made by the former. For example, in the literature there are many more HRV studies using the Fourier transform than the wavelet transform, despite the theoretically superior properties of the latter for the analysis of nonstationary signals. We believe that the main reason for this is the

Preface

ix

Number of Downloads

400
200
0 20122−001922−011132−001132−001332−001532−001732−001932−011142−001142−001342−001542−001742−001942−011152−001152−001352−001552−001752−001952−01116−01
Date
Fig. 2 Monthly RHRV downloads in the RStudio’s CRAN mirror
historical lack of HRV analysis tools with support for spectral analysis based on wavelets.
RHRV is our attempt to address these problems. RHRV is a free of charge and open-source package for the R environment that comprises a complete set of tools for heart rate variability analysis. RHRV can import data ﬁles containing heartbeat positions in the most broadly used formats and supports time domain, frequency domain, and nonlinear (fractal and chaotic) HRV analysis. The vast majority of the commonly used HRV analysis algorithms used in the literature have already been implemented in the tool. For example, the tool supports frequency analysis using the Fourier transform (with and without Daniell smoothers), short-time Fourier transform, autoregressive models, Lomb-Scargle periodogram, and the wavelet transform. And we will continue adding new functionality to RHRV. Furthermore, as any good open-source project, contributions are welcome.
Beyond being an invaluable help when performing HRV analysis (a typical HRV analysis with RHRV usually has just 10–15 lines of R code), we believe that RHRV can help the whole HRV ﬁeld. Simply by posting the RHRV analysis script as supplementary material of a paper, the reproduction of the results over the same, or over new data, will be trivial: just run the script. Being RHRV an open and free package, no one should have any impediment to reproduce the results. And given that the state-of-the-art analysis techniques are implemented in RHRV, there is no

x

Preface

reason not to use them. For example, in RHRV the difference between carrying out a spectral analysis based on Fourier or wavelets is simply changing a parameter in a function call.
Many researchers have already noticed the advantages of RHRV, and a strong community has already formed around it. During 2015 on average, the package was downloaded 450 times a month just from the RStudio CRAN mirror (see Fig. 2). We hope that the trend shown in Fig. 2 continues, and that RHRV will become the de facto tool for performing HRV analysis. And this book, as the best documentation written so far about RHRV, will contribute to this end.

Santiago de Compostela, Spain Madrid, Spain Ourense, Spain Ourense, Spain Ourense, Spain Santiago de Compostela, Spain Ourense, Spain December 2015

Constantino Antonio García Martínez
Abraham Otero Quintana Xosé A. Vila
María José Lado Touriño Leandro Rodríguez-Liñares Jesús María Rodríguez Presedo Arturo José Méndez Penín

Contents
1 Introduction to Heart Rate Variability . . . . . . . . . . . . . . . . . . . . . . . . 1 1.1 Historical Perspective . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 1.2 Physiological Basis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4 1.2.1 Cardiac Output and Heart Rate . . . . . . . . . . . . . . . . . . . . . . 4 1.2.2 Autonomous Nervous System . . . . . . . . . . . . . . . . . . . . . . . 5 1.2.3 Autonomous Nervous System and Heart Rate Regulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 1.2.4 Nonlinear Dynamics of the Heart . . . . . . . . . . . . . . . . . . . . 7 1.3 Clinical Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 1.3.1 Monitoring . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 1.3.2 Acute Care . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 1.3.3 Chronic Disorders . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
2 Loading, Plotting, and Filtering RR Intervals. . . . . . . . . . . . . . . . . . . 15 2.1 Getting Started . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 2.2 Data File Format . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 2.3 Loading Beat Series into RHRV. . . . . . . . . . . . . . . . . . . . . . . . . . . 17 2.4 Preprocessing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20 2.4.1 Instantaneous Heart Rate Signal Extraction . . . . . . . . . . . . . 21 2.4.2 Removing Artifacts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 2.4.3 Interpolation of the Heart Rate Signal . . . . . . . . . . . . . . . . . 23 2.5 Preprocessing Beat Data with RHRV . . . . . . . . . . . . . . . . . . . . . . . 23 References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
3 Time-Domain Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 3.1 Time-Domain Measures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 3.2 Time-Domain Analysis with RHRV . . . . . . . . . . . . . . . . . . . . . . . . 33 3.3 Changes in HRV Time-Based Statistics Under Pathological Conditions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35 References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
xi

xii

Contents

4 Frequency Domain Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37 4.1 Frequency Components of the HRV. . . . . . . . . . . . . . . . . . . . . . . . 37 4.2 Frequency Analysis Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . 39 4.2.1 Frequency Analysis of Stationary Signals . . . . . . . . . . . . . . 39 4.2.2 Frequency Analysis of Nonstationary Signals . . . . . . . . . . . 41 4.3 Frequency Domain Analysis with RHRV . . . . . . . . . . . . . . . . . . . . 43 4.3.1 Frequency Analysis of Stationary Signals . . . . . . . . . . . . . . 43 4.3.2 Frequency Analysis of Nonstationary Signals . . . . . . . . . . . 54 4.4 Changes in HRV Frequency-Based Statistics Under Pathological Conditions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65 References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 66
5 Nonlinear and Fractal Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69 5.1 An Overview of Nonlinear Dynamics. . . . . . . . . . . . . . . . . . . . . . . 69 5.2 Chaotic Nonlinear Statistics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70 5.2.1 Nonlinearity Tests . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70 5.2.2 Phase Space Reconstruction . . . . . . . . . . . . . . . . . . . . . . . . 71 5.2.3 Correlation Dimension . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72 5.2.4 Generalized Correlation Dimension and Information Dimension. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 5.2.5 Kolmogorov-Sinai Entropy . . . . . . . . . . . . . . . . . . . . . . . . . 74 5.2.6 Maximal Lyapunov Exponent . . . . . . . . . . . . . . . . . . . . . . . 75 5.2.7 Recurrence Quantiﬁcation Analysis (RQA) . . . . . . . . . . . . . 76 5.2.8 Poincaré Plot . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79 5.3 An Overview of Fractal Dynamics . . . . . . . . . . . . . . . . . . . . . . . . . 80 5.3.1 Detrended Fluctuation Analysis. . . . . . . . . . . . . . . . . . . . . . 81 5.3.2 Power Spectral Density Analysis. . . . . . . . . . . . . . . . . . . . . 82 5.4 Chaotic Nonlinear Analysis with RHRV . . . . . . . . . . . . . . . . . . . . 83 5.4.1 Nonlinearity Tests . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85 5.4.2 Phase Space Reconstruction . . . . . . . . . . . . . . . . . . . . . . . . 87 5.4.3 Nonlinear Statistics Computation . . . . . . . . . . . . . . . . . . . . 94 5.4.4 Generalized Correlation Dimension and Information Dimension. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 94 5.4.5 Sample Entropy. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100 5.4.6 Maximal Lyapunov Exponent . . . . . . . . . . . . . . . . . . . . . . . 101 5.4.7 RQA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104 5.4.8 Poincaré Plot . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106 5.5 Fractal Analysis with RHRV . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108 5.5.1 Detrended Fluctuation Analysis. . . . . . . . . . . . . . . . . . . . . . 109 5.5.2 Power Spectral Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . 111 5.6 Nonlinear and Fractal Analysis of HRV Under Pathological Conditions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 112 5.7 Some Final Remarks Regarding HRV Analysis with Chaotic and Fractal Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113 References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114

Contents

xiii

6 Comparing HRV Variability Across Different Segments of a Recording . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 117 6.1 Episodes and Physiological Events . . . . . . . . . . . . . . . . . . . . . . . . . 117 6.2 Using Episodes in RHRV. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118 6.2.1 Managing Episodes in a HR Record . . . . . . . . . . . . . . . . . . 119 6.3 Using Episodes in Plots . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123 6.4 Making Use of Episodes in HRV Analysis. . . . . . . . . . . . . . . . . . . 126 6.5 An Example . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 128 6.6 Clinical Applications of HRV Analysis by Episodes . . . . . . . . . . . 130 References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 132
7 Putting It All Together, a Practical Example . . . . . . . . . . . . . . . . . . . 133 7.1 Problem Statement . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 133 7.2 Methodology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 134 7.2.1 Database Description. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 134 7.2.2 Applying HRV Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . 136 References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 143
Appendix A: Installing RHRV . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 145
Appendix B: How do I Get a Series of RR Intervals from a Clinical/Biological Experiment?. . . . . . . . . . . . . . . . 147
Index . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 155

Acronyms

ACF AIC AMI ANS AR ASCII CI COPD DFA DFT ECG EDF fBm FFT fGn FT HF HR HRV IAPS ICU IRRR
k-NN KS LF MADRR MODWPT OSAH

Autocorrelation function Akaike information criterion Average mutual information Autonomic nervous system Autoregressive American Standard Code for Information Interchange Conﬁdence intervals Chronic obstructive pulmonary disease Detrended ﬂuctuation analysis Discrete Fourier transform Electrocardiogram European Data Format Fractional Brownian motion Fast Fourier transform Fractional Gaussian noise Fourier transform High frequency Heart rate Heart rate variability International Affective Picture System Intensive care unit Interquartile (difference between third and ﬁrst quartile) Range of the RR intervals series K-Nearest Neighbor Kolmogorov-Sinai Low frequency Median of the Absolute Differences between adjacent RR intervals Maximal overlap discrete wavelet packet transform Obstructive sleep apnea and hypoapnea

xv

xvi

Acronyms

pNN50
PSD REM r-MSSD RP RQA RSA SDANN
SDNN SDNNIDX
SDSD STFT SWV TINN
ULF VARVI VLF WFDB WT

proportion of successive Normal to Normal differences greater than 50 ms in percent Power spectral density Rapid eye movement root Mean Square of Successive heartbeat interval Differences Recurrence plot Recurrence quantiﬁcation analysis Respiratory sinus arrhythmia Standard Deviation of the Averages of Normal to Normal intervals in 5 minutes segments Standard Deviation of Normal to Normal RR intervals mean of the Standard Deviation of Normal to Normal Intervals in 5 minutes segments Standard Deviation of Successive heartbeat interval Differences Short-time Fourier transform Scaled windowed variance baseline width of the Triangular Interpolation of the Normal to Normal intervals histogram Ultralow frequency Variability of the heArt Rate in response to Visual stImuli Very low frequency WaveForm DataBase Wavelet transform

Chapter 1
Introduction to Heart Rate Variability

Abstract Searching on Google Scholar the string “heart rate variability” (HRV) provides about half a million references, which gives us an idea of the research activity around this concept. This chapter describes the historical development of this research ﬁeld, from the pioneering work of the eighteenth and nineteenth centuries to the boom of the ﬁnal decade of the twentieth century. HRV analysis is important from a clinical point of view because of its direct relationship with the autonomic nervous system (ANS). Therefore, we include a section explaining the physiological basis of HRV and its relationship with the ANS. Finally, we review the most relevant clinical applications of HRV in three distinct lines: patient monitoring, acute care, and chronic disorders. The reader of this chapter must bear in mind that the purpose of this book is to present a software tool, RHRV, which greatly simpliﬁes performing heart rate variability analysis. This chapter does not pretend to be a comprehensive review of the physiology of heart rate variation, but just a brief introduction to the ﬁeld whose main purpose is building a common language to be able to present concepts more effectively throughout the book.

1.1 Historical Perspective

The heartbeat and pulse were already “known” by Greek physicians like Galen of Pergamon (130–200 AD), who mentioned it on many of his manuscripts relating it to the “vital pneuma” and the “spirited soul.” They knew that lack of pulse caused death and, based on its power, frequency, and regularity, they could make diagnoses. Since then, great progress has been made in the analysis of the variations of the heart rate (HR), which can be seen summarized in Fig. 1.1.
In the early eighteenth century, John Floyer (1649–1734) invented the “physician pulse watch” (1707), a precursor of the chronometer, which he began to use to accurately measure the heart rate of patients.
An important proof of the variability of the heart rate was contributed by Stephen Hales (1677–1761) who, in 1733, published a manuscript [12] in which he mentioned that the distance between heartbeats and the blood pressure varied during the respiratory cycle. Later, Carl Ludwig (1816–1895) improved these observations,

© Springer International Publishing AG 2017

1

C.A. García Martínez et al., Heart Rate Variability Analysis

with the R package RHRV, Use R!, DOI 10.1007/978-3-319-65355-6_1

2

1 Introduction to Heart Rate Variability

Fig. 1.1 Main heart rate variability analysis historic milestones
clearly stating that the pulse increased during inspiration and decreased during expiration [25], thus laying the foundation of what would be called later respiratory sinus arrhythmia (RSA).
The transition from prehistory to modernity in the ﬁeld of electrocardiography was given by Willem Einthoven (1860–1927), who recorded the ﬁrst electrocardiogram (ECG) in 1901 using galvanometers [9]. Figure 1.2 shows one of his early designs, weighting about 270 kg and needing ﬁve people to operate it. The current nomenclature of (P, Q, R, S, T) was ﬁrst used by Einthoven.
The ECG recording techniques improved gradually, and in 1961 Norman Holter (1914–1983) developed a device (that still bears his name, Holter) allowing the registration of long-term ECG records [14].
From the 1970 s on, improvements in measuring equipment and computational techniques caused this research ﬁeld to take off. In 1970, Caldwell presented the “cardiotachometer” [5], capable of automatically recording beat positions using a small and inexpensive equipment. In 1973, Rompelman [39] presented another device capable of performing a basic statistical analysis of the HR values.
Due to the generalization of these devices and computers, speciﬁc studies on HRV started to appear, identifying the basic characteristics of the HR signal, and isolating some well-deﬁned peaks in its spectrum [39, 43]. In 1977, a paper comparing different techniques of HRV analysis was published [37], and in 1982 the ﬁrst implementation of a system for HRV analysis over a standard PC was developed [38], which made this kind of analysis affordable for any researcher.
It could be considered that the ﬁrst documented clinical application of HRV was the one published by Hon and Lee in 1963 [15]. They noted that fetal distress was accompanied by changes in HRV, even before there was a detectable change in HR. Another paper that boosted the research in this ﬁeld was the one by Wolf in 1967 [48], which showed the relationship between HRV and the ANS and its role in sudden cardiac death.
It was certainly in the 1980 s when the ﬁeld of HRV reached maturity. Methodological issues were ﬁxed, its physiological basis and its relationship with the ANS were demonstrated, and more clinical applications were described. In 1980, the ﬁrst

1.1 Historical Perspective

3

Fig. 1.2 Electrocardiograph from 1911
book devoted entirely to the HRV was published [22]. In 1981, Akselrod et al. published a paper in Science in which the relationship among each one of the spectral components of HRV and the various components of the ANS was empirically demonstrated [1]. A proof of the relevance of this paper is that it currently has more than 4500 citations in Google Scholar.
Other important paper was the one published by Pagani et al. in 1986 [33], describing results obtained with people and dogs of different age ranges following different therapies and placed in different positions. Although many other papers were published in this decade, we will cite only one more: the paper of Baselli et al. of 1987 [3], in which they describe the results of an analysis of hypertensive, diabetic, and myocardial infarction patients, compared with healthy people.
Until the 1990s, the parameters used for HRV analysis were limited to statistical parameters in the time domain and power in spectral bands obtained by the Fourier transform (FT). In 1990, two important works on fractality and chaotic dynamics of HR were published [8, 11], questioning the “linear” classical techniques and promoting the analysis of nonlinear dynamics of HR. Soon, interesting clinical applications of these techniques were documented, such as in fetal monitoring [35]. Technological advances and applications of this line continue to the present.

4

1 Introduction to Heart Rate Variability

It was also in this decade when some doubts about the validity of the Fourier transform as spectral estimator in some circumstances were raised. One of the ﬁrst studies comparing classical Fourier estimation against nonparametric estimation and time-frequency distributions is the one by Pola et al. of 1996 [36]. Other important paper about this subject was published by Novak et al. in 1993 [32], which empirically established the superiority of time-frequency distributions when dealing with signals whose spectrum varies with time.
In the 1990s, other book devoted exclusively to HRV was published by Malik and Camm [26]. This book was a reference in the ﬁeld of HRV for a long time and described as clinical applications of HRV the stratiﬁcation of patients after myocardial infarction, its relationship with the occurrence of ventricular arrhythmias, and sudden cardiac death, and its behavior in transplanted patients, in diabetic patients, and in fetal monitoring. Also in this decade, in 1996, the European Society of Cardiology and the North American Society of Pacing and Electrophysiology published a proposal for the methodology of HRV analysis prepared by a working group of experts [46]. Despite being an important contribution, it was quickly overtaken by technological advances since it did not consider using spectral estimators different from the FT, nor it included nonlinear analysis techniques [41].
Research in the ﬁeld of HRV has not stopped in recent years. New methodologies have been proposed, experiments have been developed to better explain its physiological basis, and different studies have conﬁrmed its clinical utility. It also has been applied to other ﬁelds such as psychiatry, sports training, or marketing. All of them will be discussed in the following sections.

1.2 Physiological Basis
1.2.1 Cardiac Output and Heart Rate
Cardiac output is deﬁned as the volume of blood pumped by the heart in one minute. Therefore, this magnitude is in fact the product of two variables: the volume of blood pumped at each beat (which in turn is a function of blood pressure), and the heart rate.
Cardiac output varies greatly according to the physical constitution of the subjects. Obviously, it is not the same to pump blood to oxygenate and feed the cells of a person who is 1.90 m tall and weights 85 Kg, than to meet the needs of a person of 1.60 m and 58 Kg [7]. Other factors, such as gender or age, also inﬂuence the cardiac output needs.
In addition to these factors, the cell needs of each individual change dynamically. Of course, necessities are not the same when sleeping or when running a marathon. However, without resorting to such extreme situations, simply sitting and getting

1.2 Physiological Basis

5

up produces changes in these needs, and some adjustment in the cardiac output is required. The responsible for controlling cardiac output in this different setting is the autonomic nervous system [47].
Even more, a subject in the same situation will have a cardiac output that is continuously changing, from second to second. In fact, as it was mentioned in the previous section, it is known since the nineteenth century that there is a variation in heart rate during each breathing cycle. In a healthy individual, the autonomic nervous system would properly make these continuous adjustments in heart rate and blood pressure, both the “fast” adjustments to meet “abrupt” situations and the long-term adjustments to maintain cardiac output in a stable situation. Since the mid-twentieth century, and as we have also pointed out in the previous section, we know that it is possible to use the heart rate variability as an indirect measure of the status of the autonomic nervous system.
Here, we will brieﬂy present the characteristics of the autonomic nervous system and then analyze its relationship with HRV.

1.2.2 Autonomous Nervous System
The autonomous or vegetative nervous system is responsible for regulating involuntary body responses (heart rate, digestion, pupil dilatation, etc.). It is also responsible for maintaining the body stable against external disturbances, which is known as homeostasis [19].
Within the autonomic nervous system, we distinguish three components:
• Sympathetic system: It uses acetylcholine and norepinephrine as neurotransmitters. It has nodes on both sides of the spinal column, and in the aorta. It is involved in situations that require energy expenditure and in stressful situations. It is responsible, for example, of increasing the heart rate in dangerous situations.
• Parasympathetic system: It uses acetylcholine as neurotransmitter, and its nodes are mainly in the sacrum area and next to the brain. It is responsible for storing and preserving energy, to keep the body in a normal situation. Therefore, it would be also responsible for recovering the normal heart rate, when the danger has disappeared.
• Enteric nervous system: It is speciﬁcally responsible for controlling the gastrointestinal system.
As far as the heart rate is concerned, the parasympathetic system would be responsible for maintaining a stable heart rate value, enough to meet the required cardiac output, but without unnecessary waste. In fact, it seems proved that in the absence of autonomic control, “intrinsic” heart rate would be between 100 and 120 beats per minute [26]. By contrast, the sympathetic system would be responsible for raising the heart rate temporarily to prepare the body for situations that require increased

6

1 Introduction to Heart Rate Variability

energy expenditure. The greater or lesser activation of both systems and their different response times would be the cause of the continuous changes in heart rate, as we will discuss in the next section.

1.2.3 Autonomous Nervous System and Heart Rate Regulation
To explain this relationship, we will use the results of the experiment described by Akselrod et al. in Science in 1981 [1]. This paper was a key milestone in the use of HRV for clinical purposes.
In 1981, it was established that variations in heart rate were not just noise, and it was known that if the series of “instantaneous heart rate” was taken as a time series, and its spectrum was analyzed, some predominant peaks in certain frequencies appeared. In their paper, Akselrod et al. quoted two pioneering works documenting this behavior. Authors mentioned the papers of Kitney-Rompelman and Sayers [22, 43], indicating that besides the component related with the RSA (about 0.25 Hz), other low-frequency components could be distinguished, speciﬁcally around 0.04 Hz (low frequency) and 0.12 Hz (mid-frequency). Moreover, they mentioned other papers by Hyndman et al. and Kitney [18, 21], suggesting that the 0.04 Hz frequency component could be related to cyclic ﬂuctuations in peripherical vasomotor tone associated with thermoregulation, and that the 0.12 Hz component is related with the frequency response of the baroreceptor reﬂex.
Akserod et al. designed an experiment to test whether there were indeed those three spectral components of HRV by using unanesthetized, conscious dogs, to which some drugs, whose effects on the ANS were known, were administered.
First, they administered glycopyrrolate to block the parasympathetic system observing that the mid- and high-frequency peaks were abolished, while the lowfrequency peak was reduced. Then, they administered propranolol to block the sympathetic system and observed a reduction in the low-frequency peak. When administering both drugs, they noted the removal of all peaks, making the heart rate series steadily, almost a metronome. Finally, investigators administered a nonapeptideconverting enzyme inhibitor to block the renin-angiotensin system and observed a large increase in the low-frequency peak.
To explain these results, they proposed, in the same paper, a simple model of “short-term cardiovascular control.” In Fig. 1.3, we reproduce this model. According to their own explanation, the sympathetic and parasympathetic nervous system were directly responsible for modulating heart rate in response to ﬂuctuations in variables such as arterial blood pressure. The response time of the parasympathetic system is faster than the sympathetic one, so it is the only one that has effects on the peaks of medium and high frequency. However, the low-frequency peak is inﬂuenced by both systems. Finally, Akselrod et al. suggested that the renin-angiotensin

1.2 Physiological Basis

7

Fig. 1.3 Cardiovascular control model proposed in [1]
system somehow limits ﬂuctuations in the vasomotor tone, and when it is blocked the vasomotor tone increases, occurring its manifestations mainly at low frequencies.
Akselrod’s ﬁndings and their model are shared by many other authors, but some have added interesting information. For example, Saul [42] suggests that if the respiratory rate decreases, the high-frequency peak could scroll down, interacting with the medium-frequency peak and, therefore, entering the zone of inﬂuence of the sympathetic system. Malliani et al. [27] studied the occurrence of circadian rhythms when records of 24 hours were examined: They observed an increase in the low-frequency peak daytime, which intensiﬁes with physical exercise.
1.2.4 Nonlinear Dynamics of the Heart
In the previous section, some heart rate spectral components were mentioned. To obtain these components, we start from the premise that analyzed data corresponds to a stationary and linear system, which allows us to use techniques such as the FT to obtain its spectrum.

8

1 Introduction to Heart Rate Variability

For decades, that assumption has been questioned. In fact, it has been found by means of mathematical models and by developing experiments with real heart data that a healthy heart has a nonlinear, nonperiodic behavior, showing long-range correlations and typical fractal systems features [10, 11]. Moreover, it is known that this nonlinear behavior is a symptom of cardiovascular health, and that certain diseases or conditions, such as old age, diminish such nonlinearity, which is considered an indicator of worsening prognosis.
In addition, it is believed that when the cardiovascular system becomes more linear, and therefore more predictable, its ability to adapt to changes in the environment decreases, thus increasing the risk of falling into situations such as arrhythmias or ﬁbrillations.

1.3 Clinical Applications
Given that there is a relationship between HRV and the control of the cardiac activity by the neurovegetative control system, it seems logical that in any illness in which the ANS is involved, HRV will be affected in some way. Finding associations between HRV alterations and pathologies is hindered by the fact that there are many causes that may affect HRV, even in healthy people. For example, the position of the body while the ECG recording is done, if it is done at daytime or nighttime, the mood of the person, etc. This is the reason why it is so difﬁcult to conclude the existence of any disease or aggravation by studying only the value of a single HRV index.
The most relevant work done so far in order to standardize methodologies for the analysis of HRV and to establish clinical protocols using that information was published in 1996 by the European Society of Cardiology and the North American Society of Pacing and Electrophysiology [46]. In this report, although several potential clinical applications of HRV are cited, only two with a broad consensus are mentioned: predicting the risk after myocardial infarction and its use as an early detector of diabetic neuropathy. A recent publication by Sassi et al. [41] reviewed new appearing methodologies to analyze HRV, but none of them has signiﬁcantly contributed to the development of new clinical tools.
A later article about clinical applications of HRV [44] added a third potential application: its use in risk stratiﬁcation after a heart failure.
In the important book published by Malik and Camm in 1995 [26], the following clinical applications are also mentioned:
• Prediction of ventricular arrhythmias; • Prediction of sudden death; • Hypertension monitoring; • Prognosis of patients with heart transplant; • Assessment of fetal status; • Assessment of diabetic patients.

1.3 Clinical Applications

9

However, in none of these cases neither clear clinical guidelines are given nor protocols with broad consensus are established. This prevents HRV from being used in routine clinical practice as a marker for these conditions.
One of the more recent books about the clinical utility of HRV is the one by Kamath, Watanabe [20] and Upton. In this book, three possible scenarios in which the HRV could be used to obtain relevant information from a clinical point of view are presented. These scenarios are patient monitoring, application in intensive care units (ICUs) and use in some chronic diseases.
In the rest of this section, based on the chapters of this book and other recent papers, we provide a detailed explanation about some of these clinical applications.

1.3.1 Monitoring
1.3.1.1 Fetal Monitoring
The fetus heartbeat can be distinguished in a simple abdominal ECG, superimposed to the mother ECG. There are methods to separate both signals [20]. A simple visual representation of the fetal heart rate shows two fundamental differences with the adult. First, its average value is higher, around 150 bpm (beats per minute). Second, periodical accelerations and decelerations every few minutes are superimposed over the short-term variability [26]. It is also known that as the fetus matures, the heart rate decreases and its complexity or variability increases.
A decrease in the fetal HRV is considered negative, and correlations have been found between its descent and fetal metabolic acidosis, neurological abnormalities, drug effects, or growth delays [26].
In a recent paper by Nageotte [31], fetuses were classiﬁed as follows, depending on their HR and HRV:
• Type I or normal, with HR between 110 and 160 bpm and moderate HRV; • Type III or abnormal, with HR outside those ranges and low HRV; • Type II or unclassiﬁed, those that do not fall into the other two categories.
This classiﬁcation has been recognized by various associations and is reported in various clinical guidelines. Its main drawback is that about 80% of fetuses were classiﬁed as Type II. More scientiﬁc studies and clearer clinical guides are needed in order to increase the clinical interest of fetal HRV.
1.3.1.2 HRV and Hypertension
Hypertension is a well-known factor of cardiac risk and its prevalence is high in Western society. It is known that hypertensive patients show alterations in their cardiovascular control system. Speciﬁcally, in these patients the balance between sympathetic and parasympathetic systems is shifted toward the ﬁrst. Since HRV is

10

1 Introduction to Heart Rate Variability

controlled by the autonomic nervous system, variations are expected when comparing the HRV of hypertensive patients against the healthy population. It also seems possible that HRV indexes could be used in hypertensive patients monitoring, as indicators of its evolution and prognosis, or even as early detector of hypertension risk.
Studies developed until now indicate that there is a clear correlation between diminished HRV and risk of hypertension. It has also been found that HRV indexes are reduced in hypertensive patients when compared to the healthy population [20]. Other studies [30] distinguish between patients with moderate and severe hypertension and found signiﬁcant differences, enabling then correlation of HRV index with the severity of hypertension.

1.3.1.3 Sleep Disorders
During sleep, a healthy person goes through different stages, each one characterized by a different brain activity pattern. This has implications over the cardiac activity, which we know is mediated by the nervous system. Several studies have found correlations between sleep stages and changes in HRV indexes [4, 20]. Another factor that causes alterations on HRV indexes is the circadian rhythm itself [16], with differences between daytime and nighttime values.
It is, therefore, not surprising that some studies try to analyze the extent to which healthy people with sleep disorders show altered HRV patterns. Several of the authors of this book have participated in studies related to sleep apnea [23] and COPD (chronic obstructive pulmonary disease) [49], ﬁnding signiﬁcant differences in some HRV indexes. For example, when studying sleep apnea, we found differences not only between healthy people and patients with apnea, but also among patients with different degrees of apnea.

1.3.2 Acute Care
1.3.2.1 HRV in the Intensive Care Unit (ICU)
Patients admitted to ICUs are permanently monitored. Variables such as temperature, ECG, oxygen saturation, respiration, and urine output are continuously recorded, and any deviation from the normal range usually triggers the corresponding alarm. Besides analyzing these variables, it is critical to diagnose the patient and to continually adjust his/her medication.
Many of these variables are controlled by the autonomic nervous system. Therefore, a malfunction of this system may cause alterations in them. In fact, it is known that such dysfunction occurs in patients with brain damage, infection, cardiovascular

1.3 Clinical Applications

11

disorders, and multiorgan failure [20]. Therefore, an indirect measure of the state of the autonomic nervous system could be useful when evaluating or establishing the prognosis of such patients.
For example, in patients hospitalized for trauma, a low HRV correlates with increased mortality [40]. There are also studies that ﬁnd low HRV in patients with sepsis who then evolve negatively [2].

1.3.2.2 HRV and Anesthesia
The application of anesthesia, whether local or general, is always a situation of increased risk, because it involves external interference in the control mechanism of the body’s physiological variables. Therefore, especially in the application of general anesthesia, the patient is continuously monitored, and the anesthesiologist continuously monitors these variables to set the optimal dose of anesthesia.
Among the variables that the anesthesiologist monitors are heart rate, oxygen saturation, blood pressure, and respiratory rate. In the last decades, there have been experiments in which HRV was analyzed during the application of anesthesia [20], and signiﬁcant variations in different HRV indexes have been found.
For example, it has been found that a previous study of HRV can detect people at risk of hypotension when anesthetized for cesarean [13]. The effects of different drugs on HRV indexes are also known, and studies exist on risk stratiﬁcation after anesthesia. However, studies trying to correlate HRV indexes and the ideal dose of anesthesia are not conclusive [28].

1.3.3 Chronic Disorders
1.3.3.1 Congestive Heart Failure
It is fully accepted that HRV decreases in patients with heart failure. These patients are less able to regulate their HR than the normal population, which is reﬂected in a lower variability [6].
In fact, decreased HRV has been used in many studies as a predictor of risk of heart failure in patients after myocardial infarction [17]. Going a step further, correlations between levels of severity of heart failure and HRV indexes have been found; they have enabled the proposal of remote diagnostics systems to classify these patients [34]. The effects of various treatments on HRV indexes have even been studied, including implantable pacemakers installation, supply of drugs, and prescription of moderate physical activity [20]. In all these cases, there has been recovery in HRV indexes in parallel with the improvement of the cardiovascular system of the patients.

12

1 Introduction to Heart Rate Variability

1.3.3.2 Neuropsychiatric Disorders

In today’s society, psychiatric disorders have a growing prevalence. Obviously, all these disorders are associated with a malfunction of the nervous system and a loss of its capacity to adapt to the environment, due to a decrease in its ﬂexibility.
HRV is one of the external manifestations of the nervous control system. In a healthy person, HRV is high and varies according to changes in environmental situations. But in a person with psychiatric disorders, the HRV is usually diminished, in accordance with his decrease.
Among the diseases for which there are studies that correlate HRV and disease severity are schizophrenia, bipolar disorder, anxiety disorders, post-traumatic stress disorders, depression, or suicidal ideation [20, 24, 29, 45].

References
1. Akselrod S, Gordon D, Ubel FA, Shannon DC, Berger A, Cohen RJ (1981) Power spectrum analysis of heart rate ﬂuctuation: a quantitative probe of beat-to-beat cardiovascular control. Science 213(4504):220–222
2. Barnaby D, Ferrick K, Kaplan DT, Shah S, Bijur P, Gallagher EJ (2002) Heart rate variability in emergency department patients with sepsis. Acad Emerg Med 9(7):661–670
3. Baselli G, Cerutti S, Civardi S, Lombardi F, Malliani A, Merri M, Pagani M, Rizzo G (1987) Heart rate variability signal processing: a quantitative approach as an aid to diagnosis in cardiovascular pathologies. Int J Biomed Comput 20(1):51–70
4. Berlad I, Shlitner A, Ben-Haim S, Lavie P (1993) Power spectrum analysis and heart rate variability in stage 4 and REM sleep: evidence for state-speciﬁc changes in autonomic dominance. J Sleep Research 2(2):88–90
5. Caldwell WM, Smith LD, Wilson MF (1970) A wide-range linear beat-by-beat cardiotachometer. Med Biol Eng 8(2):181–185
6. Casolo G. (1995). Heart rate variability in patients with heart failure. In Heart Rate Variability, pages 499–46633. Futura Publishing Company
7. Collis T, Devereux RB, Roman MJ, de Simone G, Yeh J-L, Howard BV, Fabsitz RR, Welty TK (2001) Relations of stroke volume and cardiac output to body composition: the strong heart study. Circulation 103(6):820–825
8. Denton TA, Diamond GA, Helfant RH, Khan S, Karagueuzian H (1990) Fascinating rhythm: a primer on chaos theory and its application to cardiology. Am Heart J 120(6):1419–1440
9. Einthoven W (1895) Über die form des menschlichen electrocardiogramms. Pﬂüg Arch Eur J Physiol 60(3):101–123
10. Goldberger AL, Amaral LA, Hausdorff JM, Ivanov PC, Peng C-K, Stanley HE (2002) Fractal dynamics in physiology: alterations with disease and aging. In: Proceedings of the national academy of sciences 99(suppl 1):2466–2472
11. Goldberger AL, Rigney DR, West BJ (1990) Chaos and fractals in human physiology. Sci Am 262(2):42–49
12. Hales S (1733) Statistical essays: concerning haemastaticks. W. Innys and R. Manby, London 13. Hanss R, Bein B, Ledowski T, Lehmkuhl M, Ohnesorge H, Scherkl W, Steinfath M, Scholz J,
Tonner PH (2005) Heart rate variability predicts severe hypotension after spinal anesthesia for elective cesarean delivery. Anesth-Hagerstown 102(6):1086–1093 14. Holter NJ (1961) New method for heart studies continuous electrocardiography of active subjects over long periods is now practical. Science 134(3486):1214–1220

References

13

15. Hon EH, Lee S (1963) Electronic evaluation of the fetal heart rate. VIII. Patterns preceding fetal death, further observations. Am J Obstet Gynecol 87:814–826
16. Huikuri HV, Niemelä M, Ojala S, Rantala A, Ikäheimo M, Airaksinen K (1994) Circadian rhythms of frequency domain measures of heart rate variability in healthy subjects and patients with coronary artery disease. Effects of arousal and upright posture. Circulation 90(1):121–126
17. Huikuri] HV, Stein PK (2012) Clinical application of heart rate variability after acute myocardial infarction. Front Physiol 3
18. Hyndman B, Kitney R, Sayers BM (1971) Spontaneous rhythms in physiological control systems. Nature 233:339–341
19. Janig W (1989) Autonomic nervous system. In: Schmidt RF, Thews G (eds) Human physiology. Springer, Berlin Heidelberg, pp 333–370
20. Kamath MV, Watanabe M, Upton A (2012) Heart rate variability (HRV) signal analysis: clinical applications, CRC Press
21. Kitney R (1975) An analysis of the nonlinear behaviour of the human thermal vasomotor control system. J Theor Biol 52(1):231–248
22. Kitney R, Rompelman, O (1980) The study of heart-rate variability, vol 3, Oxford University Press
23. Lado MJ, Méndez AJ, Rodríguez-Liñares L, Otero A, Vila XA (2012) Nocturnal evolution of heart rate variability indices in sleep apnea. Comput Biol Med 42(12):1179–1185
24. Latalova K, Prasko J, Diveky T, Kamaradova D, Grambal A, Jelenova D, Mainerova B, Cerna M, Ociskova M, Velartova H et al (2013) Euthymic bipolar affective disorder patients and their heart rate variability. Eur Psychiatry 28:1
25. Ludwig C (1847) Beiträge zur kenntniss des einﬂusses der respirationsbewegungen auf den blutlauf im aortensysteme. Archiv für Anatomie, Physiologie und Wissenschaftliche Medicin, pp 242–302
26. Malik M, Camm AJ (1995) Heart rate variability, Futura Publishing Company 27. Malliani A, Pagani M, Lombardi F, Cerutti S (1991) Cardiovascular neural regulation explored
in the frequency domain. Circulation 84(2):482–492 28. Mazzeo A, La Monaca E, Di Leo R, Vita G, Santamaria L (2011) Heart rate variability:
a diagnostic and prognostic tool in anesthesia and intensive care. Acta Anaesthesiol Scand 55(7):797–811 29. Méndez AJ, Lado MJ, Vila XA, Rodríguez-Liñares L, Alonso RA, García-Caballero A (2013) Heart of darkness: heart rate variability on patients with risk of suicide. In: 8th Iberian Conference on information systems and technologies (CISTI). pp. 1–4 30. Mussalo H, Vanninen E, Ikäheimo R, Laitinen T, Laakso M, Länsimies E, Hartikainen J (2001) Heart rate variability and its determinants in patients with severe or mild essential hypertension. Clin Physiol 21(5):594–604 31. Nageotte MP (2015) Fetal heart rate monitoring. Semin Fetal Neonatal Med 20(3):144–148 32. Novak P, Novak V (1993) Time/frequency mapping of the heart rate, blood pressure and respiratory signals. Med Biol Eng Comput 31(2):103–110 33. Pagani M, Lombardi F, Guzzetti S, Rimoldi O, Furlan R, Pizzinelli P, Sandrone G, Malfatto G, Dell’Orto S, Piccaluga E (1986) Power spectral analysis of heart rate and arterial pressure variabilities as a marker of sympatho-vagal interaction in man and conscious dog. Circ Res 59(2):178–193 34. Pecchia L, Melillo P, Bracale M (2011) Remote health monitoring of heart failure with data mining via CART method on HRV features. IEEE Trans Biomed Eng 58(3):800–804 35. Pincus SM, Viscarello RR (1992) Approximate entropy: a regularity measure for fetal heart rate analysis. Obstet Gynecol 79(2):249–255 36. Pola S, Macerata A, Emdin M, Marchesi C (1996) Estimation of the power spectral density in nonstationary cardiovascular time series: assessing the role of the time-frequency representations (TFR). IEEE Trans Biomed Eng 43(1):46–59 37. Rompelman O, Coenen A, Kitney R (1977) Measurement of heart-rate variability: part 1: Comparative study of heart-rate variability analysis methods. Med Biol Eng Comput 15(3):233– 239

14

1 Introduction to Heart Rate Variability

38. Rompelman O, Snijders JB, Van Spronsen CJ (1982) The measurement of heart rate variability spectra with the help of a personal computer. IEEE Trans Biomed Eng BME 29(7):503–510
39. Rompelman O, Snoeijer W, Ros H (1973) A special purpose computer for dynamic statistical analysis of RR intervals. In: Digest of the 10th International Conference on Medical and Biological Engineering. Dresden, vol 31
40. Ryan ML, Ogilvie MP, Pereira BM, Gomez-Rodriguez JC, Manning RJ, Vargas PA, Duncan RC, Proctor KG (2011) Heart rate variability is an independent predictor of morbidity and mortality in hemodynamically stable trauma patients. J Trauma Acute Care Surg 70(6):1371– 1380
41. Sassi R, Cerutti S, Lombardi F, Malik M, Huikuri HV, Peng C-K, Schmidt G, Yamamoto Y, Gorenek B, Lip GH, Grassi G, Kudaiberdieva G, Fisher JP, Zabel M, Macfadyen R (2015) Advances in heart rate variability signal analysis: joint position statement by the e-Cardiology ESC Working Group and the European Heart Rhythm Association co-endorsed by the Asia Paciﬁc Heart Rhythm Society. Europace, pp euv015
42. Saul JP (1990) Beat-to-beat variations of heart rate reﬂect modulation of cardiac autonomic outﬂow. Physiology 5(1):32–37
43. Sayers B (1973) Analysis of heart rate variability. Ergonomics 16(1):17–32 44. Stys A, Stys T (1998) Current clinical applications of heart rate variability. Clin Cardiol
21(10):719–724 45. Tan G, Dao TK, Farmer L, Sutherland RJ, Gevirtz R (2011) Heart rate variability (HRV) and
posttraumatic stress disorder (PTSD): a pilot study. Appl Psychophys Biofeedback 36(1):27–35 46. Task Force of the European Society of Cardiology and the North American Society of Pacing
and Electrophysiology (1996) Heart rate variability: Standards of measurement, physiological interpretation and clinical use. Eur Heart J 17:354–381 47. Thomas GD (2011) Neural control of the circulation. Adv Physiol Educ 35(1):28–32 48. Wolf S (1967) The end of the rope: the role of the brain in cardiac death. Can Med Assoc J 97(17):1022 49. Zamarrón C, Lado MJ, Teijeiro T, Morete E, Vila XA, Lamas PF (2014) Heart rate variability in patients with severe chronic obstructive pulmonary disease in a home care program. Technol Health Care 22(1):91–98

Chapter 2
Loading, Plotting, and Filtering RR Intervals
Abstract The initial steps to work with RHRV functions are presented in this chapter. The process starts with the loading of records containing beat positions that should be preprocessed prior to frequency, time, or nonlinear analysis. Data can be stored in various types of ﬁles, and RHRV routines can deal with different data formats. Next, heart rate must be obtained from beat positions. It may occur that spurious points appear in the heart rate signal. RHRV allows users to delete these outliers, when necessary. Besides, the signal can be ﬁltered to reject automatically points that do not correspond to acceptable physiological values.
2.1 Getting Started
RHRV is a free software package to analyze HRV in frequency, time, and nonlinear domains. The starting point is a beat positions series that must be loaded into a speciﬁc structure, described later in the text. RHRV is not able to process ECG directly. In this case, before starting working with RHRV, it is necessary to use a tool capable of identifying the beats and exporting them to any of the multiple formats supported by RHRV (interested readers can check Appendix B).
Once loaded into RHRV, data containing beat positions must be processed to obtain a heart rate signal that can be used to perform different analyses. In order to obtain satisfactory results, outliers should be ﬁrst removed (manually or automatically), and data must be interpolated.
Figure 2.1 summarizes this process, including the RHRV functions that should be used. The rest of this chapter explains all these functionalities in depth.

© Springer International Publishing AG 2017

15

C.A. García Martínez et al., Heart Rate Variability Analysis

with the R package RHRV, Use R!, DOI 10.1007/978-3-319-65355-6_2

16

2 Loading, Plotting, and Filtering RR Intervals

Fig. 2.1 Steps of the preprocessing procedure to obtain the heart rate signal
2.2 Data File Format
To perform HRV analysis from the sequence of beat positions, it will be necessary to generate the corresponding heart rate signal. This signal can then be analyzed in terms of frequency, time, or nonlinear parameters.
In RHRV, data acquisition can be performed from a simple ASCII (American Standard Code for Information Interchange) ﬁle, that is, a single-column ﬁle containing beat positions, which may appear in different units (seconds, milliseconds,etc.). However, data is not always available in this format, thus implying a previous conversion or using alternative functions to load it into RHRV. In the following paragraphs, we will describe the most commonly used formats to store beat position information.
The WFDB (WaveForm DataBase) software is a collection of tools for viewing, analyzing, and creating recordings of physiological signals. These tools are freely distributed from the PhysioNet Web site [5]. We will use the term “WFDB format” to refer to those records that follow the standard accepted by the WFDB software tools, which is one of the most used formats by researchers in ECG signal processing.
The WFDB format uses header ﬁles to specify the format and attributes of signal and annotation ﬁles. Although the WFDB format can be used to store records of different physiological signals, it is mainly used to store ECG records. In this case, the header contains information about the number of leads, calibration format, etc. ECG samples are stored as binary ﬁles, and, if there is information about beat positions or other annotations, it will be stored in one or more annotation ﬁles.
Nowadays, WFDB is being widely used by a considerable part of the research community, as well as by different organizations. However, there are many other for-

2.2 Data File Format

17

mat ﬁles worth presenting here. EDF+ (European Data Format) is another extended format, characterized by its ﬂexibility and simplicity [1, 16]. It is commonly used for exchange and storage of multichannel biological and physical signals, which are recorded in .edf ﬁles.
EDF+ is based on EDF [17], but it can store many more types of data. It is a binary ﬁle with two main parts: header, which identiﬁes the record and speciﬁes the technical characteristics of the stored signals; and data, corresponding to the samples of the signals.
Improvements in technology have enabled the development of an increasing number of mobile devices (smartphones, tablets, watches, etc.), which can be used for obtaining real-time heart rate data by means of a chest strap. Products can be found for sport applications, such as Sports Tracker [7] or Endomondo [2]. Most of these applications obtain and show only the mean heart rate, but some recent chest straps are also able to detect instantaneous beat positions and to store and export these values. One of these is the Polar WearLink band, which can record the heart rate in a very simple and easy way using a speciﬁc data format [6].
Some Polar devices generate a .hrm ﬁle, storing data in ASCII format. Each ﬁle is composed of several data sections that are separated by empty lines. In each line, the data section name is separated from the data by using brackets. Multiple data in each row are separated by tab characters, including optional information about the exercise, such as speed, cadence, and altitude.
Other widely used format is the one used by Suunto (.sdf ﬁles), one of the most important watch manufacturers in the ﬁeld of trekking, scuba diving, or climbing [8]. These .sdf ﬁles also store information in ASCII format and contain several sections delimited by their names between brackets. A header section speciﬁes all the parameters that must be considered, each of them in one line, if they are present in the ﬁle (not all of them are mandatory). Data is stored in other section, separating the different attributes by colons.
Apart from these most commonly used formats, data can be also stored in RR ﬁles that are usually text ﬁles which only include the time differences between each consecutive beats.
In the next section, we will explain how to load data into RHRV from different ﬁle formats, namely ASCII, WFDB, EDF+, Polar, Suunto, and RR formats.

2.3 Loading Beat Series into RHRV
In order to load the heart beat positions from the data ﬁles, a custom data structure, called HRVData, must be initially created by using the RHRV software package. Figure 2.2 shows the ﬁelds contained in HRVData. This structure is implemented in R language as a list data object, and it will store in different ﬁelds all the information related to the digital records, including date and time (datetime ﬁeld), verbose (returning of information to the user, Verbose ﬁeld), beat positions (Beat ﬁeld), interpolated heart rate series (HR ﬁeld), frequency of interpolation (Freq_HR ﬁeld), episodes

18

2 Loading, Plotting, and Filtering RR Intervals

...
... ... ... ...
...
... ... ...

HRVData Beat

Time niHR RR

HR

Episodes InitTime Type Duration Value

Verbose

Ext

datetime

Index of the analysis

NonLinearAnalysis 1

p

SurrogateTest NonlinearityTests correlation sampleEntropy lyapunov dfa rqa PoincarePlot

-
...
...

Index of the analysis

TimeAnalysis 1

p

size SDNN SDANN SDNNIDX pNN50 SDSD rMSSD IRRR MADRR TINN HRVi

Index of the analysis

FreqAnalysis 1

n

spectrogram HRV ULF VLF LF HF LFHF ULF_mean VLF_mean LF_mean HF_mean LFHF_mean

ULFmin ULFmax VLFmin VLFmax LFmin LFmax HFmin HFmax type size/wavelet shift/bandtolerance sizesp/depth

Fig. 2.2 HRVData structure

(speciﬁc intervals within the heart beat time series that can exist or not, Episodes ﬁeld), and parameters resulting from the different time (TimeAnalysis ﬁeld), frequency (FreqAnalysis ﬁeld), and nonlinear analysis (NonLinearAnalysis ﬁeld).
All the ﬁelds in this structure will be carefully described in this book. Meanwhile, in this paragraph, we will explain the ﬁelds of the data structure needed to load and preprocess the original data:
• datetime: information related to the date and time associated with the original record, provided in the original data ﬁle or speciﬁed by the user.
• Verbose: boolean argument to enable or disable verbose mode. • Beat: dataframe to store information on the instantaneous heart rate data. It contains
the original beat positions (Time), the instantaneous, noninterpolated frequency (niHR), and the RR intervals (distances between two consecutive beats, RR). • HR: vector containing the interpolated heart rate data. • Freq_HR: the heart rate interpolation frequency. • Ext: string used as ﬁle extension by loading/writing functions.

2.3 Loading Beat Series into RHRV

19

It is important to notice that some ﬁelds of the HRVData structure may be empty. These ﬁelds will be ﬁlled by processing routines when applied to the original heart beat position signal.
Listing 2.3.1 shows the code to create the HRVData structure.
R listing 2.3.1
# HRVData structure containing the heart beats library(RHRV) hrv.data <- CreateHRVData() hrv.data <- SetVerbose(hrv.data, TRUE)

Once the data structure has been created, the beats should be loaded. Depending on the original ﬁle format, the user must employ a different R routine. We will show how to use various loading routines in the following paragraphs.
Different functions can be used to load beat data into the HRVData structure:
• LoadBeatAscii: for data stored in an ASCII ﬁle. • LoadBeatWFDB: for WFDB format records. • LoadBeatEDFPlus: for EDF+ data ﬁles.
However, a more general function (LoadBeat) can be used to load records in the RHRV software package. In this case, the format should be speciﬁed as an argument of this function.
As a practical example, we will consider now a record stored in the WFDB format that can be freely donwloaded from PhysioNet [3]. It belongs to the European ST-T Database, intended to be used in the evaluation of algorithms for the analysis of ST and T-wave changes [14, 23]. In the example, we are going to use the “e0115” ﬁle (header, data, and annotation ﬁles).
As previously said, to load the beat position information, the user can employ either the generic LoadBeat or the LoadWFDB functions. In both cases, the LoadHeaderWFDB function, which reads the header ﬁle in order to obtain information, is implicitly executed. In Listing 2.3.2, the code to load the original data in two different HRVData structures, employing both functions, is presented. Note that an argument giving the extension of the annotation ﬁle must also be provided (annotator, by default “qrs”).
R listing 2.3.2
# Loading the beats in WFDB format hrv.data1 <- CreateHRVData() hrv.data <- SetVerbose(hrv.data1, TRUE) hrv.data2 <- CreateHRVData() hrv.data <- SetVerbose(hrv.data2, TRUE) hrv.data1 <- LoadBeat("WFDB", hrv.data1,"sampleData/e0115", annotator = "atr") hrv.data2 <- LoadBeatWFDB(hrv.data2, "sampleData/e0115", annotator = "atr")

20

2 Loading, Plotting, and Filtering RR Intervals

As it can be observed, both routines yield the same original data, stored in hrv.data1 and hrv.data2.
We will explain now how to load data in ASCII format. An example of an ASCII ﬁle that can be freely downloaded is “beat_ascii.txt”, available from the MILE Group Web page [4]. This ﬁle contains heart beat positions, and it was generated employing the VARVI (Variability of the heArt Rate in response to Visual stImuli) software package, a free software tool developed to perform heart rate variability analysis in response to different visual stimuli [22]. In this case, the code to load the original data and its result are given in Listing 2.3.3.
R listing 2.3.3

# Loading the beats in ASCII format hrv.data3 <- CreateHRVData() hrv.data <- SetVerbose(hrv.data3, TRUE) hrv.data3 <- LoadBeatAscii(hrv.data3, "sampleData/beat_ascii.txt")

The same result could be obtained using LoadBeat(“Ascii”, hrv.data3, “beat_ascii.txt”).
The rest of the ﬁle formats supported by RHRV can be loaded in a similar way by using the functions LoadBeatEDFPlus, LoadBeatSuunto, LoadBeatPolar, and LoadBeatRR.
Both the generic LoadBeat function and the rest of the functions for loading the various data ﬁle formats can include several input parameters, such as the record path (RecordPath, by default ‘.’) if the ﬁle to load is not in the working directory; the scale, factor applied in RR or ASCII format if data are not in seconds (scale, by default 1); the datetime, also for ASCII and RR ﬁles (datetime, by default “1/1/1900 0:0:0”); and the annotation type for EDF+ format (annotationType, by default “QRS”). For ASCII ﬁles, the possibility of loading only a speciﬁc portion of the record is also controlled by two other parameters: starttime and endtime. If they are not speciﬁed, the full record is loaded. When speciﬁc values (in seconds) are provided, only the corresponding portion of the record is loaded into the HRVData structure.

2.4 Preprocessing
At this point, a heartbeat sequence has been loaded into the HRVData structure, and it is time to preprocess the signal in order to obtain the heart rate signal. This is the starting point to perform time, frequency, and nonlinear analysis. A detailed explanation is given in the following sections.

2.4 Preprocessing

21

2.4.1 Instantaneous Heart Rate Signal Extraction

The distance between two consecutive beats is the well-known RR interval [15], which corresponds to the distance of the R waves associated with each beat. The instantaneous heart rate can be deﬁned as the inverse of the time separation between two consecutive heart beats. In RHRV, this corresponds to the calculation of the series:
R R[i] = (T ime[i] − T ime[i − 1]) ∗ 1000

H R(i) =

1000 R R[i] ∗ 60

where Time[i] is the time when the beat i occurs, measured in seconds, RR[i] is the beat-to-beat distance, measured in milliseconds, and HR(i) is the instantaneous heart rate, measured in beats per minute.

2.4.2 Removing Artifacts
Algorithms to detect and classify heartbeats from ECG signals often fail or may yield incorrect outputs. This means that the instantaneous heart rate signal that is directly obtained from the RR intervals can be corrupted with artifacts, that is, undesired information originated by either extern sources or physiological events. Some QRS complexes can be missed, some anomalous, ectopic beats can be incorrectly classiﬁed as normal, or the original signal can be affected by noise. Ectopic beats are not triggered as the result of the heart rate control mechanisms, but they arise from the automatism that heart muscle ﬁbers present. Given that the goal of HRV analysis is the study of the heart rate control mechanisms, these beats must be removed before performing a HRV analysis. Besides, as the beats are not regularly originated, the heart rate is not constant, which means that the signal will be not sampled regularly in time.
Several scientiﬁc works have tried to establish if the existing detection algorithms are adequate to perform heart rate variability analysis, or if a manual revision of detection is required [11, 18]. Conclusions of those works indicate that errors may signiﬁcantly affect some variability indices, speciﬁcally those corresponding to spectral analysis [20, 24].
Researchers have proposed removing artifacts employing a broad variety of algorithms. Some of these works include wavelet-based methods [19, 27], different ﬁlters and thresholding values [9, 21], or independent component analysis techniques [13].
The RHRV software package provides an algorithm to automatically remove artifacts. This algorithm uses adaptive thresholding for rejecting beats whose RR

22

2 Loading, Plotting, and Filtering RR Intervals

value differs from previous and following beats, and from a mobile mean more than a threshold value. The ﬁlter also removes points that are not within acceptable physiological values [25]. This algorithm is presented as pseudo-code in Listing 2.4.1.
R listing 2.4.1
ULAST = 13 LONG = 50 UMEAN = 1.5 * ULAST MINIMUM = 12 MAXIMUM = 20 MINBMP = 25 MAXBPM = 200 from (i = 2 to NBEATS) {
if (i < LONG) MEAN = mean of previous beats
else MEAN = mean of the last long beats
if ((100 * abs(hr(i) hr(i - 1)) / hr(i - 1)) < ULAST) || (100 * abs(hr(i) hr(i + 1)) / hr(i - 1)) < ULAST) || (100 * abs(hr(i) MEAN) / MEAN) < UMEAN) && (MINBPM <= hr(i) <= MAXBPM)) { valid beat SIGNALDEV = 10 + SIGNALDEV(last LONG beats) if (SIGNALDEV < MINIMUM) SIGNALDEV = MINIMUM if (SIGNALDEV > MAXIMUM) SIGNALDEV = MAXIMUM update ULAST = SIGNALDEV update UMEAN = 1.5 * SIGNALDEV
} else
i=i+1 }

This algorithm uses as starting point some preﬁxed values (experimentally calculated) that include the initial threshold values for the ﬁlter (ULAST = 13 and UMEAN = 1.5 * ulast), the number of beats (LONG) employed to calculate the mean value and corresponding standard deviation, and minimum (MINIMUM = 12) and maximum (MAXIMUM = 20) values allowed for the ULAST threshold. A ﬁxed quantity is also added to the signal deviation (SIGNALDEV ) to obtain the adaptive threshold employed by the ﬁlter. Accepted physiological minimum (MINBPM) and maximum (MAXBPM) values are also ﬁxed.
Using a loop, all the consecutive beats are analyzed, excluding the ﬁrst and last beat, since it is not possible to compare them with the previous or next beats, respectively. The mean value of the beats is calculated considering the LONG previous beats, if possible. A beat will be considered as a valid one if the corresponding heart rate differs from the previous or from the next beat less than ULAST (in %), or from the mean less than UMEAN (in %).

2.4 Preprocessing

23

Threshold values are updated after a number of beats equal to LONG. If an artifact is detected, the next beat will be discarded, since its associated RR distance is not valid.
Most artifacts are removed by this algorithm. However, RHRV also supplies a function that provides an intuitive method to manually remove the remaining artifacts, by selecting them from a graphical window.
After the automatic and/or manual edition of the artifacts, the noninterpolated, nonequally spaced heart rate signal is obtained as result.

2.4.3 Interpolation of the Heart Rate Signal
The noninterpolated heart rate signal obtained in the previous step can be used to obtain time and nonlinear measurements. However, in the frequency analysis, several problems may arise, since one of the main drawbacks is that sometimes the continuity of the signal is broken, and in the frequency domain, this can lead to erroneous results. Because of this, an important aspect that should be carefully studied is handling artifacts and noninterpolated signals. Furthermore, the RR signal does not have equidistant sampling, and most of the frequency algorithms require an evenly interpolated signal.
Many different interpolation algorithms can be found in the literature. The most usual are linear or cubic splines interpolation, but many others can be used. Some researchers performed interpolation using the K-nearest neighbor (k-NN) algorithm [10], or used Fourier-based methods to interpolate data [26].
When using RHRV, users can select either linear or cubic splines interpolation [12]. The sampling frequency to obtain the equally spaced heart rate signal has to be set in both cases (default is 4 Hz). After this step, a new heart rate signal that is adequate for performing spectral analysis, as well as time and nonlinear studies is obtained.

2.5 Preprocessing Beat Data with RHRV
In this section, a detailed explanation about the calculation of RR intervals with RHRV will be provided. Filtering and edition of the heart rate signal will also be explained in a practical way.
As it was explained in former paragraphs, the heart rate signal needs to be obtained from the heart beats data before performing different types of analysis. First, the noninterpolated heart rate signal is obtained and must be ﬁltered to remove outliers and detection errors.
Let us consider the hrv.data3 structure, containing the heart beats data, created in Listing 2.3.3. From this signal, the instantaneous heart rate will be now obtained

24
Fig. 2.3 Instantaneous heart rate signal for the “beat_ascii.txt” data

2 Loading, Plotting, and Filtering RR Intervals Non−interpolated instantaneous heart rate

200

150

HR (beats/min.)

100

50

0

1000

2000

3000

4000

time (sec.)

with the BuildNIHR function. The corresponding R code developed in the RHRV software package, and results are given in Listing 2.5.1.
R listing 2.5.1
# Building the non-interpolated heart rate signal hrv.data3 <- BuildNIHR(hrv.data3)
Now, the instantaneous, noninterpolated heart rate signal has been calculated. The previously empty ﬁelds in hrv.data3 corresponding to Beat, that is, niHR and RR are now ﬁlled with the appropriate values. A graphical representation can also be obtained using the function PlotNIHR(hrv.data3), a plot function that allows the representation of data values for the instantaneous heart rate (Fig. 2.3).
The automatic ﬁltering algorithm can now be applied over the heart rate signal, employing the FilterNIHR function. Listing 2.5.2 provides the R code and results of this function.
R listing 2.5.2
# Filtering the non-interpolated heart rate signal hrv.data3 <- FilterNIHR(hrv.data3)
When the function FilterNIHR is used, the algorithm previously described will reject those beats that differ a certain value from the established threshold. If not speciﬁed, default parameters are used (long = 50 and last = 13).
This ﬁltering also eliminates points that are not within acceptable physiological values. Users can modify these physiological values as well, by varying the values

2.5 Preprocessing Beat Data with RHRV

25

Fig. 2.4 Example of use of the EditNIHR function. Outliers can be manually removed
of the arguments minbpm (minimum value) and maxbpm (maximum value), set by default to 25 and 200, respectively. The rest of the arguments (mini, maxi, ﬁxed, and verbose) are deprecated ones and ﬁxed to NULL by default.
For manually removing outliers, the EditNIHR function can be used. Figure 2.4 shows an example of use of the EditNIHR function. The user can interact with the graphical window and remove outliers. The user has to select the points to be removed by clicking on the upper-left corner, and on the bottom-right corner of the area enclosing the points. This way, a red rectangular area will be marked, and the user can decide to remove the points within (remove outliers button), to clear the selected area (Clear button), or to ﬁnish the manual edition. After removal, RHRV gives information about the removed points.
In case the user does not want to use the EditNIHR function, but wants to remove more spurious points, the function FilterNIHR can be applied more than once. This can result in the elimination of more beats because, after running once the function and eliminating some of the beats, the dynamic thresholds of the ﬁlter will change. Results can be similar to the application of the EditNIHR function, as shown in Listing 2.5.3.

26

2 Loading, Plotting, and Filtering RR Intervals

R listing 2.5.3
# Filtering the non-interpolated heart rate signal hrv.data3 <- FilterNIHR(hrv.data3)

It is time now to estimate the interpolated heart rate signal. The function that performs this task is InterpolateNIHR, with the following arguments:
• sampling frequency (freqhr): in Hz. (default value is 4). • interpolation method (method): default value is linear, although spline can be
selected. • verbose: deprecated.
Listing 2.5.4 provides the code and results of the calculation and graphical representation of the results.
R listing 2.5.4
#Interpolation of the instantaneous heart rate hrv.data3 <- InterpolateNIHR(hrv.data3)

After applying these functions, the HRVData structure will contain in its ﬁelds: the original heart beat positions, the RR intervals, the noninterpolated heart rate signal, and the equally spaced heart rate signal. This last ﬁeld can be graphically represented employing the PlotHR function (Fig. 2.5). The interpolated heart rate signal will be the starting point for the time, frequency, and nonlinear analysis that will be explained in next chapters of this book.

Fig. 2.5 Interpolated heart rate signal

Interpolated instantaneous heart rate

100

95

90

HR (beats/min.)

85

80

0

1000

2000

3000

4000

time (sec.)

References

27

References

1. EDF+: http://www.edfplus.info. Last accessed: 27-05-2016 2. Endomondo: http://www.endomondo.com. Last accessed: 27-05-2016 3. European ST-T Database: http://www.physionet.org/physiobank/database/edb. Last accessed:
27-05-2016 4. gHRV: http://milegroup.github.io/ghrv/packages.html. Last accessed: 27-05-2016 5. PhysioNet: http://www.physionet.org. Last accessed: 27-05-2016 6. Polar: http://www.polar.com. Last accessed: 27-05-2016 7. SportsTracker: http://www.sports-tracker.com. Last accessed: 27-05-2016 8. Suunto: http://www.suunto.com. Last accessed: 27-05-2016 9. Al Osman H, Eid M, El Saddik A (2015) A pattern-based windowed impulse rejection ﬁlter
for nonpathological HRV artifacts correction. IEEE Trans Instrum Meas 64(7):1944–1956 10. Begum S, Islam MS, Ahmed MU, Funk P (2011) K-NN based interpolation to handle artifacts
for heart rate variability analysis. In: IEEE international symposium on signal processing and information technology (ISSPIT), 2011. IEEE, pp 387–392 11. Bigger JT, Fleiss JL, Steinman RC, Rolnitzky LM, Kleiger RE, Rottman JN (1992) Frequency domain measures of heart period variability and mortality after myocardial infarction. Circulation 85(1):164–171 12. Friedman J, Hastie T, Tibshirani R (2009) The elements of statistical learning, vol 2. Springer 13. Gimeno-Blanes F, Rojo-Álvarez JL, Requena-Carrión J, Everss E, Hernández-Ortega J, Alonso-Atienza F, García-Alberola A (2007) Denoising of heart rate variability signals during tilt test using independent component analysis and multidimensional recordings. In: Computers in cardiology, 2007. IEEE, pp 399–402 14. Goldberger AL, Amaral LA, Glass L, Hausdorff JM, Ivanov PC, Mark RG, Mietus JE, Moody GB, Peng C-K, Stanley HE (2000) PhysioBank, PhysioToolkit, and PhysioNet. Components of a new research resource for complex physiologic signals. Circulation 101(23):e215–e220 15. Goldman MJ (1986) Principles of clinical electrocardiography. Lange Medical Publications 16. Kemp B, Olivan J (2003) European Data Format plus(EDF+), an EDF alike standard format for the exchange of physiological data. Clin Neurophysiol 114(9):1755–1761 17. Kemp B, Värri A, Rosa AC, Nielsen KD, Gade J (1992) A simple format for exchange of digitized polygraphic recordings. Electroencephalog Clin Neurophysiol 82(5):391–393 18. Malik M, Farrell T, Cripps T, Camm A (1989) Heart rate variability in relation to prognosis after myocardial infarction: selection of optimal processing techniques. Eur Heart J 10(12):1060– 1074 19. Mcnames J, Thong T, Aboy M (2004) Impulse rejection ﬁlter for artifact removal in spectral analysis of biomedical signals. In: IEMBS’04. 26th annual international conference of the IEEE engineering in medicine and biology society, 2004, vol. 1. IEEE, pp 145–148 20. Molina-Picó A, Cuesta-Frau D, Miró-Martínez P, Oltra-Crespo S, Aboy M (2013) Inﬂuence of QRS complex detection errors on entropy algorithms. Application to heart rate variability discrimination. Comput Methods Programs Biomed 110(1):2–11 21. Niskanen J-P, Tarvainen MP, Ranta-Aho PO, Karjalainen PA (2004) Software for advanced HRV analysis. Comput Methods Programs Biomed 76(1):73–81 22. Rodríguez-Liñares L, Cuesta P, Alonso R, Méndez A, Lado M, Vila X (2013) VARVI: a software tool for analyzing the variability of the heart rate in response to visual stimuli. In: Computing in cardiology conference (CinC), 2013. IEEE, pp 401–404. 23. Taddei A, Distante G, Emdin M, Pisani P, Moody G, Zeelenberg C, Marchesi C (1992) The European ST-T database: standard for evaluating systems for the analysis of ST-T changes in ambulatory electrocardiography. Eur Heart J 13(9):1164–1172

28

2 Loading, Plotting, and Filtering RR Intervals

24. Thuraisingham R (2006) Preprocessing RR interval time series for heart rate variability analysis and estimates of standard deviation of RR intervals. Comput Methods Programs Biomed 83(1):78–82
25. Vila J, Palacios F, Presedo J, Fernández-Delgado M, Félix P, Barro S (1997) Time-frequency analysis of heart-rate variability. Eng Med Biol Mag IEEE 16(5):119–126
26. Wei Z, Dechang C, Xueyun W, Hongxing L (2014) Heart rate estimation by iterative Fourier interpolation algorithm. Electron Lett 50(24):1799–1801
27. Zidelmal Z, Amirou A, Adnane M, Belouchrani A (2012) QRS detection based on wavelet coefﬁcients. Comput Methods Programs Biomed 107(3):490–496

Chapter 3
Time-Domain Analysis

Abstract Heart rate variability can be analyzed by several methods, being timedomain methods the simplest measures that can be obtained from RR intervals series. Numerical indices summarizing the variability of the series are calculated from the RR intervals series. These measures are easily implemented and have low computational cost. They are usually calculated over longer segments of data than frequency-domain methods, typically 24 h. However, they can be also estimated from smaller segments (typically 5 min) in order to compare different episodes. In this chapter, a review of time-domain measures and their calculation within RHRV will be shown.

3.1 Time-Domain Measures

Researchers have proposed an extensive number of HRV indexes that can be estimated in the time domain [1, 4, 10]. The most used ones are summarized in Table 3.1.
The arithmetic mean of the RR interval series, RR, can be deﬁned as follows:

RR = 1 N

N

RRi

i=1

Being N the length of the RR series, and RRi the RR interval between beats i and i − 1, where each beat position corresponds to the beat detection instant. SDNN is
the standard deviation of the RR interval series:

SDNN =

1 N −1

N

(RRi − RR)2

i=1

SDNN reﬂects the global variability of the series. However, SDNN value depends on the length of the recording, and therefore, durations of recording should be standardized in order to obtain comparable results. As discussed in [10], both short-term

© Springer International Publishing AG 2017

29

C.A. García Martínez et al., Heart Rate Variability Analysis

with the R package RHRV, Use R!, DOI 10.1007/978-3-319-65355-6_3

30

3 Time-Domain Analysis

Table 3.1 Most important time-domain measures

Index

Units

Description

SDNN

ms

Standard deviation of RR intervals series

SDANN

ms

Standard deviation of the mean of RR intervals in 5- min

segments of the entire series

SDNNIDX

ms

Mean of the standard deviation of RR intervals in 5- min segments of the entire series

pNN50

%

Proportion of adjacent RR intervals differing by more than 50 ms

SDSD

ms

Standard deviation of differences between adjacent RR intervals

r-MSSD

ms

The square root of the mean of the squares of differences

between adjacent RR intervals

IRRR

ms

Difference between third and ﬁrst quartile of the RR intervals

series

MADRR

ms

Median of the absolute differences between adjacent RR intervals

TINN

ms

Baseline width of the triangular interpolation of the intervals

histogram

HRV index

ms

Integral of the intervals histogram divided by its maximum

(5 min) and long-term (24 h) recordings are commonly used to calculate SDNN as well as another HRV measures.
Other time-domain measures are estimated from segments of the total recording, usually 5 min. For instance, SDANN is the standard deviation of the means of these segments, while SDNNIDX is the mean of the standard deviations of these same segments. To compute these indices, the RR series is divided into fragments 5 min long, and mean and standard deviation of RR distances can be calculated for each fragment:

1 Ns

RRs

=

Ns

RRi
i=1

SDNNs =

Ns

1 −

1

Ns i=1

(RRi

−

RRs)2

where RRs and SDNNs are the mean and the standard deviation, respectively, of the RR distances in fragment s, and Ns is the number of elements in this fragment. As said, SDANN is the standard deviation of the means of all the fragments, and SDNNIDX is the mean of the standard deviations of all fragments:

3.1 Time-Domain Measures

31

RRalls

=

1 m

m
RRs
s=1

SDANN =

1 m−1

m

(RRs − RRalls)2

s=1

SDNNIDX =

1 m

m

SDNNs

s=1

where RRalls is the mean of all segments, and m is the total number of segments. SDANN evaluates long-term variability, due to cycles longer than 5 min, and SDNNIDX quantiﬁes short-term variability, because of cycles shorter than 5 min.
Indexes based on the difference between adjacent RR values quantify the power due to high-frequency components. The most used are pNN50, SDSD, and r-MSSD. pNN50 is the proportion of values of the RR series that differ from the previous value more than 50 ms:

ΔRRj = RRj+1 − RRj, for j = 1, ..., N − 1

NN50 = number of ΔRRj > 50ms

pNN50 =

1 N − 1 NN50

·

100

SDSD is the standard deviation of differences between adjacent RR intervals:

ΔRR

=

N

1 −

1

N

−1
ΔRRj

j=1

SDSD =

N

1 −

2

N −1
(ΔRRj
j=1

−

ΔRR)2

32

3 Time-Domain Analysis

And r-MSSD is deﬁned as the square root of the mean of the squares of differences between adjacent RR intervals:

r − MSSD =

N

1 −

1

N −1
ΔRRj2

j=1

These three short-term measurements estimate high-frequency variations and, therefore, show high correlation with each other. Other similar indices are IRRR and MADRR, correlated with SDNN and pNN50, respectively, and that solve some of their problems. IRRR is the interquartile range, that is, the difference between the third and the ﬁrst quartile of the RR series, and it is a very robust measure against artifacts:

IRRR = Q3(ΔRR) − Q1(ΔRR)

Quartiles are deﬁned as the three values of the points that divide the ordered data set into four equally sized groups. The ﬁrst quartile (Q1) splits off the lowest 25% of the RR values, and the third quartile (Q3) splits off the highest 25% of the RR values. If the RR series has a Gaussian distribution, IRRR is an estimation of standard deviation (overall HRV).
MADRR is the median of the absolute differences between adjacent RR values and does not suffer from saturation problems as pNN50. Similar to pNN50, MADRR measures the power due to high-frequency components. This median is calculated as the second quartile (Q2) of |ΔRR|:

MADRR = Q2(|ΔRR|)

In addition to these statistical parameters, there are some geometric measures that can be estimated from the RR interval histogram, such as TINN and the HRV index, in order to avoid the negative inﬂuence of artifacts in the determination of variability indexes. A bin of approximately 8 ms (exactly 7.8125 ms) can be used to construct smoothed histograms [10].
TINN is the baseline width of the triangular interpolation of the RR intervals histogram. TINN may be calculated as the total area of the histogram of the RR series, divided by the maximum of the histogram multiplied by 2:

TINN

=

N · bin size max(histogram(RR))

·2

Figure 3.1 shows an example of the triangular interpolation of RR histogram using this method.

3.1 Time-Domain Measures

33

Fig. 3.1 Triangular interpolation of the RR histogram

An approximation to this measure is the HRV index. The HRV index is the integral of the intervals histogram (the number of all RR intervals, that is, the length of the RR series) divided by the maximum of the intervals histogram. The HRV index does not need triangular interpolation, and it is dimensionless:

HRV

index

=

N max(histogram(RR))

Both measures, TINN and HRV index, reﬂect overall HRV and are more inﬂuenced by the lower than by the higher frequencies.

3.2 Time-Domain Analysis with RHRV
Time domain analysis with RHRV [8] is very simple, given that only the execution of one function is needed: CreateTimeAnalysis. Let us consider the hrv.data3 structure previously created in Chap. 2. Once the signal is loaded, and the instantaneous heart rate (RR series) is calculated and ﬁltered to eliminate artifacts, the CreateTimeAnalysis function modiﬁes the HRVData structure to include all the time-domain measures mentioned in the previous section (Listing 3.2.1).

34

3 Time-Domain Analysis

R listing 3.2.1
# Creating time analysis for the hrv.data3 structure created in chapter 2.
hrv.data3 <- CreateHRVData(Verbose = FALSE) hrv.data3 <- LoadBeatAscii(hrv.data3, "sampleData/beat_ascii.txt")
# Building the non-interpolated heart rate signal hrv.data3 <- BuildNIHR(hrv.data3)
# Filtering the non-interpolated heart rate signal #(twice to eliminate all artifacts) hrv.data3 <- FilterNIHR(hrv.data3) hrv.data3 <- FilterNIHR(hrv.data3)
hrv.data3 <- SetVerbose(hrv.data3, TRUE) hrv.data3 <- CreateTimeAnalysis(hrv.data3)
## Creating time analysis ## Size of window: 300 seconds ## Width of bins in histogram: 7.8125 milliseconds ## Number of windows: 15 ## Data has now 1 time analyses ## SDNN: 30.2246 msec. ## SDANN: 12.3131 msec. ## SDNNIDX: 26.9153 msec. ## pNN50: 0.4743 % ## SDSD: 15.0925 msec. ## r-MSSD: 15.0915 msec. ## IRRR: 40 msec. ## MADRR: 8 msec. ## TINN: 133.8299 msec. ## HRV index: 8.5651

It should be noted that it is not necessary to perform the interpolation process before applying the time-domain techniques, since these parameters are calculated directly from the noninterpolated RR-time series. In this example, default parameters are used, although the following arguments can be used:
• size: length of segments in which the RR series is divided (default: 300 seconds). • numofbins: number of bins in RR histogram; when not speciﬁed, the interval
parameter is used (default). • interval: width of bins in RR histogram (default: 7.8125 ms).
Each time-domain measure can be accessed directly in the HRVData structure. For instance, to access the IRRR value, hrv.data3$TimeAnalysis[[1]]$IRRR can be used. RHRV allows users to have more than one time analysis by using the CreateTimeAnalysis function more than once. For example, if this function were used twice, the HRVData structure would have another element in the TimeAnalysis ﬁeld (hrv.data3$TimeAnalysis[[2]]). The TimeAnalysis ﬁeld index is increased automatically when a new time analysis is created.

3.3 Changes in HRV Time-Based Statistics Under Pathological Conditions

35

3.3 Changes in HRV Time-Based Statistics Under Pathological Conditions

Many HRV measures show correlation among them [1]. SDNN is an estimate of overall HRV, such as IRRR, TINN, and HRV index; SDANN is an estimate of longterm components of HRV; and SDNNIDX is anestimate of short-term components of HRV, such as pNN50, SDSD, r-MSSD, and MADDR. Therefore, the following four measures are recommended for time-domain HRV assessment: SDNN and HRV index (estimate of overall HRV), SDANN (estimate of long-term components of HRV), and r-MSSD (estimate of short-term components of HRV).
Measures expressing overall HRV and its long- and short-term components cannot replace each other, and the selection of which measures to use should correspond to the aim of each particular study. Furthermore, it is not correct to compare timedomain measures, especially those referring to overall HRV, obtained from recordings of different durations. Although it must be taken into account that depressed HRV is generally a predictor of a nonhealthy state.
A study using RHRV was carried out with the purpose of assessing possible correlations between HRV parameters and personality impulsive traits, in order to establish if subjects are at risk of suffering from suicidal ideation [5]. The results showed a signiﬁcant drop on some time-domain parameters (MADRR, IRRR, and pNN50) from the healthy group to the patients showing more impulsivity. Despite the small number of cases, the smaller value of these parameters indicates that HRV could be used as a tool for the diagnosis of suicidal ideation.
Depressed HRV in the acute phase of myocardial infarction has also been reported, particularly the reduction in 24-h SDNN [2]. Furthermore, in neuropathy associated with diabetes mellitus, a reduction in time-domain parameters of HRV was also observed [10]. In chronic mitral regurgitation, SDANN correlated well with ventricular performance and predicted clinical events [9]. SDNN was signiﬁcantly related to 1-year mortality in sudden cardiac arrest [3]. Moreover, using simple time-domain methods, about one-fourth of 107 alcoholic patients were identiﬁed as having autonomic neuropathy [6].
Additionally, heart rate variability appears to be a potential good indicator of cumulated training load in middle-distance runners, which could help to plan training programs [7].

References
1. Acharya UR, Joseph KP, Kannathal N, Lim CM, Suri JS (2006) Heart rate variability: a review. Med Biol Eng Comput 44(12):1031–1051
2. Casolo GC, Stroder P, Signorini C, Calzolari F, Zucchini M, Balli E, Sulla A, Lazzerini S (1992) Heart rate variability during the acute phase of myocardial infarction. Circulation 85(6):2073– 2079

36

3 Time-Domain Analysis

3. Dougherty CM, Burr RL (1992) Comparison of heart rate variability in survivors and nonsurvivors of sudden cardiac arrest. Am J Cardiol 70(4):441–448
4. García-González M, Pallás-Areny R (1996) Novel, robust indexes for time-domain analysis of heart rate variability. In: Proceedings of the 18th annual international conference of the IEEE, vol 4, pp 1660–1661
5. Méndez AJ, Lado MJ, Vila XA, Rodríguez-Liñares L, Alonso RA, García-Caballero A (2013) Heart of darkness: heart rate variability on patients with risk of suicide. In: 8th Iberian Conference on Information Systems and Technologies (CISTI), pp 1–4
6. Monforte R, Estruch R, Valls-Solé J, Nicolás J, Villalta J, Urbano-Márquez Á (1995) Autonomic and peripheral neuropathies in patients with chronic alcoholism: a dose-related toxic effect of alcohol. Arch Neurol 52(1):45–51
7. Pichot V, Roche F, Gaspoz J-M, Enjolras F, Antoniadis A, Minini P, Costes F, Busso T, Lacour J-R, Barthelemy JC (2000) Relation between heart rate variability and training load in middledistance runners. Med Sci Sports Exerc 32(10):1729–1736
8. Rodríguez-Liñares L, Méndez AJ, Lado MJ, Olivieri DN, Vila XA, Gómez-Conde I (2011) An open source tool for heart rate variability spectral analysis. Comput Methods Programs Biomed 103(1):39–50
9. Stein KM, Borer JS, Hochreiter C, Okin PM, Herrold EM, Devereux RB, Kligﬁeld P (1993) Prognostic value and physiological correlates of heart rate variability in chronic severe mitral regurgitation. Circulation 88(1):127–135
10. Task Force of the European Society of Cardiology and the North American Society of Pacing and Electrophysiology (1996) Heart rate variability: Standards of measurement, physiological interpretation and clinical use. Eur Heart J 17:354–381

Chapter 4
Frequency Domain Analysis

Abstract The sympathetic and parasympathetic branches of the ANS strongly inﬂuence heart rate. Afferent sympathetic activity increases heart rate, while afferent parasympathetic activity decreases heart rate. The speed with which changes in these systems are reﬂected in changes in heart rate is different. The sympathetic system is slow in its effects (a few seconds), while the parasympathetic system is faster (0.2–0.6 s). Given the different speeds of response, it is possible to use frequency analysis to study sympathetic and parasympathetic contributions to the HRV. A key fact to keep in mind in this analysis is that the RR series is not stationary. In this chapter, we will see how to perform HRV frequency analysis using RHRV.

4.1 Frequency Components of the HRV

Akselrod et al. [4] were the ﬁrst to realize that power spectrum analysis of heart rate ﬂuctuations provides quantitative information about the function of the cardiovascular control systems. Akselrod et al. described three components in the HRV power spectrum with physiological relevance: the Very Low Frequency component (VLF, frequencies below 0.03 Hz), the Low Frequency component (LF, 0.03–0.15 Hz), and the High Frequency component (HF, 0.15–0.4 Hz). At present, sometimes the VLF component is split into two components: the VLF band (0.003–0.03 Hz) and the Ultra Low Frequency band (ULF, 0–0.003 Hz).
Although the limits given here for these frequency bands are the most used in the literature when analyzing the HRV of adult humans at rest, or while performing a low level of physical activity, there is not an absolute consensus on the precise limits of these bands’ boundaries [8, 9, 11, 12]. Moreover, these bands’ boundaries are not suitable for the study of HRV in children [23] or during exercise [7]. For example, the upper limit of the HF may extend up to 1 Hz for children or for adults during exercise. These boundaries are neither suitable for the study of HRV in animals, especially small mammals such as mice or rats [31, 42]. The faster dynamics of cardiovascular regulation in these animals require higher spectral boundaries in the study of the VLF, LF, and HF components. If a study of HRV in adults under conditions of physical exercise, in children or in some animal, is going to be conducted, it is advisable to

© Springer International Publishing AG 2017

37

C.A. García Martínez et al., Heart Rate Variability Analysis

with the R package RHRV, Use R!, DOI 10.1007/978-3-319-65355-6_4

38

4 Frequency Domain Analysis

review the scientiﬁc literature on the subject to ﬁnd out what frequency bands are being used.
The HF component not only is believed to be of parasympathetic origin, but it also contains a strong contribution of the RSA, i.e., the heartbeat synchronization with the respiratory rhythm [49]. An increase of the HF activity occurs during cold stimulation of the face, rotational stimuli, and controlled respiration [47].
The LF component is a subject of certain controversy. Some authors believe it is of both sympathetic and parasympathetic origin [4, 6], although others have suggested that the sympathetic system predominates [27, 35]. This discrepancy is mainly due to the fact that under conditions of sympathetic excitation, there is a decrease in the absolute power of the LF band. This band also includes a component arising from the Mayer waves. Mayer waves are cyclic changes in arterial blood pressure caused by oscillations in the baroreceptor and chemoreceptor reﬂex control systems, which have a frequency of about 0.1 Hz.
An increase in LF occurs during mental stress, standing, and moderate exercise in healthy subjects, during hypotension, physical activity, and occlusion of a coronary artery or common carotid arteries in conscious dogs [47]. Both LF and HF exhibit a circadian pattern and reciprocal ﬂuctuations, with higher values of LF in the daytime and higher values of HF at night [35].
The ratio of the spectral power in the LF and HF bands, often referred to as LF/HF, is considered a quantitative measure of the sympatho/vagal balance; higher values of LF/HF indicate a predominance of the sympathetic system, while lower values indicate a predominance of the parasympathetic system. However, some researchers disagree about the usefulness of this ratio [10].
At present, there is relatively little knowledge about the origins of the VLF and ULF components. While some authors have related the VLF with the renin– angiotensin system [37], others doubt that there is a speciﬁc physiological process attributable to these components. A problem associated with the study of the VLF and ULF is that they are strongly affected by baseline removal algorithms [47], which complicates the reproduction of the results obtained by other authors.
When performing a frequency analysis, researchers should always keep in mind the length of the recordings they are working with. If the recording has a length of between 1 and 5 min, the spectral power in the LF and HF bands can be estimated with a reasonable level of accuracy. But estimating the power in the VLF band provides dubious information if the recording lasts less than 5 min [47]. To obtain reliable information about VLF, 5–10 min are needed. And even longer recordings are needed to obtain reliable information about the ULF band: at least a 30–60 min. If our recording is not long enough, we must be careful when interpreting the results obtained for the spectral power of bands for which the optimum recording length has not been met. As always in a experimental work, the more data we have, the more information we can extract from it. But, of course, it is not always possible to obtain more data.

4.2 Frequency Analysis Techniques

39

4.2 Frequency Analysis Techniques

4.2.1 Frequency Analysis of Stationary Signals

The most basic frequency analysis technique of HRV is the Fourier Transform, which

decomposes a periodic signal into a sum of a (possibly inﬁnite) set of sines and

cosines. If the signal is not periodic (as in the case of ﬁnite signals), a periodic signal

is created by replicating the original one (an operation known as periodic extension).

The discrete implementation of the Fourier Transform is called Discrete Fourier

Transform (DFT), and its efﬁcient implementation is called Fast Fourier Transform

(FFT). The DFT of N points of the RR series, {RR0, RR1, ..., RRL−1} (L ≤ N), is

obtained by padding with zeros the original sequence (to obtain a signal of length N)

and by the periodic extension of the padded sequence. This procedure permits the

transformation of a sequence {RRn} of L ≤ N points in a sequence {Xk} of N points

given by:

L−1

Xk =

RRn

·

e−2π ki

n N

k = 0, 1, 2, . . . , N − 1.

n=0

Xk

contains

information

about

the

normalized

angular

frequency

2π

k N

,

k=

0, 1, 2, . . . , N − 1, present in signal RRn. It must be noted that zero-padding does

not alter the original set of frequencies present in {RRn}. However, zero-padding

provides a more detailed representation of the set of these frequencies.

Zero-padding can also be used to increase the efﬁciency of the FFT. If N is a

highly composite number (for example, N = 2l, being l an integer), the FFT can

be computed with O(N log N) operations. Otherwise O(N2) operations are needed.

When the length of the RR series is not highly composite, often zero-padding is used

to extend the series to the next highly composite number in order to compute the

FFT efﬁciently.

It must also be noted that after the periodic extension, there will usually exist a

jump between the end of one replicate and the beginning of the next one. These jumps

are usually avoided by reducing the amplitude of the time series at the beginning and

toward its end. This operation is known as tapering.

The DFT is a complex transformation. However, in practical applications, the so-

called periodogram | Xk |2 is often used. The periodogram gives information about

the relative strengths of the various frequencies present in the signal, and it is usually

interpreted as a sample estimate of a population function called the Power Spectral

Density (PSD).

The DFT can also be applied to stationary random signals, although its inter-

pretation in terms of frequencies is often difﬁcult. A simpler interpretation of this

transformation is given by the Wiener–Khinchin theorem, that states that the power

spectral density of a stationary process is the DFT of its autocorrelation function

[43].

40

4 Frequency Domain Analysis

The calculation of the periodogram through the DFT often leads to rough estimations of the population spectral density. Furthermore, the raw periodogram is not a consistent estimator of the spectral density. However, since adjacent values are asymptotically independent, a consistent estimator can be built by smoothing the raw periodogram. In the context of time series analysis, one of the most used smoothers is the Daniell kernel [36]. An alternative approach for obtaining smoother periodograms is based on the fact that most stationary time series can be approximated by an autoregressive AR(p) model (p is the order of the process). AR(p) models state that the output of the variable depends linearly on its own p previous values:
p
RRt = c + φiRRt−i + εt,
i=1
where εt is a white noise process. To obtain an estimation of the periodogram, a suitable AR(p) model is ﬁtted to the time series. The periodogram of the time series is then computed as the expected periodogram of the ﬁtted AR model [36]. In the context of heart rate analysis, a ﬁxed order of p = 16 has been suggested [15]. PSD estimation methods that require some sort of signal model prior to the calculation of the periodogram are referred to as parametric methods. In contrast, nonparametric methods do not make any assumption about the signal. An example of a nonparametric method would be the DFT with Daniell smoothers.
The main advantages of the nonparametric method are: no assumption is made about the signal (and thus there is no need to verify the suitability of the chosen model), the simplicity of the algorithm employed (FFT), and its high processing speed. On the other hand, the main advantages of parametric methods are: smoother spectral components, easy identiﬁcation of the central frequency of each component, and accurate estimation of PSD even with a small number of samples (provided that the signal is stationary, and the AR model is suitable).
All the methods presented so far require uniformly sampled data. That is, the discrete signal is assumed to have been created by measuring the value of a continuous physical signal at a constant rate (the sampling interval). However, the RR intervals are not equidistantly sampled. The most common solution to this problem is to use interpolation methods for converting the nonequidistantly sampled RR intervals in an uniformly sampled time series. Another possible solution is using PSD estimation methods specially prepared for unevenly sampled signals. The most widely used technique of this type is the Lomb-Scargle periodogram [34, 45]. The Lomb-Scargle periodogram estimates the frequencies present on the signal by applying a least squares ﬁt of sinusoids to the data samples. Some authors have argued that the Lomb-Scargle periodogram should be the preferred HRV analysis method, since it avoids artefactual contributions that distort the high/low power ratio in the classical methods [32].

4.2 Frequency Analysis Techniques

41

4.2.2 Frequency Analysis of Nonstationary Signals

All methods presented in Sect. 4.2.1 are powerful tools for analyzing signals that do not evolve in time (stationary), but they are not good tools for studying nonstationary signals: For example, the Fourier Transform can determine which frequencies are present in a signal, but not when they are present (a similar reasoning applies when autocorrelation changes in time). To be able to study nonstationary signals, several techniques capable of representing a signal in both time and frequency domain have been developed. The key idea behind these time-frequency joint representations is to deﬁne elementary time-frequency atoms as waveforms with minimum spread in the time-frequency plane [19]. Then, these time-frequency atoms (instead of the inﬁnite time spread sines and cosines) are used to decompose the signals. Selecting the time-frequency atoms is not a trivial problem because of the time-frequency uncertainty principle: The energy spread of a function and its Fourier Transform cannot simultaneously be arbitrarily small [19].
One of the most common time-frequency decompositions for discrete signals is the Short-Time Fourier Transform (STFT), which uses a symmetric window to select an interval of the signal that is going to be analyzed. The remaining signal is analyzed by repeatedly shifting the window in time. Often these shifts are made in such a way that the multiple time-windows used have a certain degree of overlap between them. In order to sample the frequency interval with M equally spaced frequencies, the practical implementation of the STFT of the RR series is given by:

L−1

Xr,k =

RRrR+n

·

wn e−2π ki

n M

n=0

where r and k are integers fulﬁlling 0 ≤ r ≤

N −L−1 R

, N is the length of x, and

0 ≤ k ≤ M − 1, and w is the L-point discrete window used in the analysis whose

position moves in jumps of R samples in time. To compute the STFT efﬁciently, the

width of window w must be a highly composite number. Using a window with a small

width provides good temporal resolution, at the cost of loosing frequency resolution,

especially in the lower frequencies. On the contrary, a wider window provides better

spectral resolution at the expense of time resolution. Although it will not be exposed

here, this idea of windowing can also be applied to parametric PSD estimation.

When HRV frequency analysis is performed using the STFT, there is an inher-

ent tension between studying short-duration phenomena (e.g., apnea) that may be

reﬂected in the higher frequency spectral bands (LF and HF) and obtaining informa-

tion on the lower frequency bands (VLF and ULF). If we want information about the

VLF band, we should use at least a 5–10 min window. To obtain a reliable estimation

about the ULF band, we should use an even wider window. But if we use very wide

windows, we will not be able to capture the effect of a short-duration phenomenon,

such as an apnea, that usually lasts about 30–60 s. A common practice in these sce-

narios is to perform two frequency analyses. The ﬁrst one uses a wide window that

42
Fig. 4.1 Example of a mother wavelet

4 Frequency Domain Analysis Mother Wavelet

1.0

0.5

0.0

−0.5

−2

0

2

4

time

provides reliable information on the VLF and ULF bands, but it is not capable of extracting information about short-duration phenomenon. The second analysis uses a narrow window that can capture the effect of short-duration phenomenon on the LF and HF bands, but it does not provide a good estimation of the VLF and ULF bands.
A better solution to this problem is to use the wavelet Transform (WT). A wavelet is a “small wave” with zero mean that grows and decays in a limited time period (see Fig. 4.1). A function fulﬁlling these conditions is called “mother wavelet.” The mother wavelet ψ can be scaled and shifted in time, yielding a set of wavelet functions with different sizes and centered in different time positions:

ψu,s(t)

=

√1 ψ( t s

− s

u)

where s is positive and deﬁnes the scale, and u is any real number deﬁning the shift. This set of functions is used to extract time-frequency information by correlating them with the signal f (t) being analyzed:

[Wψ f ](u, s)

=

√1 s

∞ ψ( t − u )f (t)dt

−∞

s

where [Wψ f ](u, s) is the WT of the signal f (t) using the mother wavelet ψ. When working with discrete signals, and if the proper set of orthonormal wavelets is used in the decomposition, it is possible to efﬁciently compute the WT as a set of conjugate mirror ﬁlters and subsampling operations [21].

4.2 Frequency Analysis Techniques

43

The WT provides a better compromise between time and frequency resolution than the STFT. The STFT uses just one window to analyze the signal. However, the ideal approximation would be to use narrow windows at high frequencies, and wide windows at low frequencies. The Wavelet Transform uses multiple windows, obtained by applying dilatations to the mother wavelet, leading to a multiresolution analysis.
In the literature, there are more HRV studies that use the STFT than studies that use the WT, despite the theoretically superior properties of the latter. We believe that the main reason for this is the historical lack of HRV analysis tools with support for spectral analysis based on WT, and the greater complexity of implementing manually these algorithms. RHRV can perform HRV frequency analysis using both techniques, and they both have similar computational efﬁciency. When we perform a spectral analysis with RHRV, we often use both techniques and compare the results (after all, using both techniques means adding a single line of code to the analysis script). Our experience is that, as a general rule, the WT analysis is more sensitive in detecting subtle HRV changes [21].

4.3 Frequency Domain Analysis with RHRV
4.3.1 Frequency Analysis of Stationary Signals
To illustrate the frequency domain analysis techniques of stationary signals, we shall brieﬂy explore the interesting phenomena of RSA. RSA produces a shortening in RR intervals during inspiration and prolonged RR intervals during expiration. The register that will be used in this section for illustration purposes may be downloaded from [1] (“M2.hea” and “M2.qrs” ﬁles). It belongs to a volunteer recorded in supine position and breathing at a ﬁxed rate of 0.25 Hz for 10 min (thus, ULF estimates will not be accurate). The database to which the recording belongs is described in [40].
The effect of RSA in heart rhythm is evident when plotting the RR series, as shown in Fig. 4.2. The code to obtain this ﬁgure is shown in Listing 4.3.1.
R listing 4.3.1
hrv.data <- CreateHRVData() hrv.data <- LoadBeatWFDB(hrv.data,RecordName = "M2",
RecordPath = "sampleData", annotator = "qrs") hrv.data <- BuildNIHR(hrv.data) PlotNIHR(hrv.data, xlim = c(200,400))
The sinusal pattern that can be appreciated in Fig. 4.2 should be even more evident in frequency domain. To carry out a frequency analysis with RHRV, we must start

44

4 Frequency Domain Analysis

Non−interpolated instantaneous heart rate

HR (beats/min.) 55 60 65 70 75 80

200

250

300

350

400

time (sec.)

Fig. 4.2 Heart rate series from a volunteer breathing at a constant rate. Note the sinusal pattern

by creating the data structure that will store the results of the analysis. This data structure stores the analysis results as a member of the FreqAnalysis list, under the HRVData structure (see Fig. 2.2). Each analysis structure created is identiﬁed by a number, starting by the number 1 for the ﬁrst analysis created, and increasing by 1 for every new frequency analysis created. To create the frequency analysis structure, the CreateFreqAnalysis function is used (see Listing 4.3.2).
R listing 4.3.2
hrv.data <- SetVerbose(hrv.data, TRUE) hrv.data <- CreateFreqAnalysis(hrv.data)
## Creating frequency analysis ## Data has now 1 frequency analysis
If verbose mode is on, the CreateFreqAnalysis function prints information about the number of frequency analysis structures that have been created so far.
The main function to estimate the PSD of the RR time series is the CalculatePSD function. When using the CalculatePSD function, the user may specify the following parameters:
• indexFreqAnalysis: indicates in which spectral analysis structure the results will be stored. The default value uses the last analysis structure that has been created.
• method: the method that should be used for estimating the PSD. Allowed values are “pgram” (estimates the PSD using the FFT and optionally smooths the estimate with Daniell smoothers), “ar” (uses and AR model for the estimation) and “lomb” (Lomb-Scargle periodogram).

4.3 Frequency Domain Analysis with RHRV

45

• doPlot: logical value, if TRUE (default) the periodogram is plotted using the PlotPSD function. Thus, if doPlot is TRUE, the same parameters used in PlotPSD can be speciﬁed to the CalculatePSD function.
• Depending on the selected method, additional parameters can be speciﬁed.
As we have said, the PlotPSD function plots the PSD estimate of the RR time series. This function highlights the different frequency bands by using colors. Thus, the PlotPSD function accepts as input parameters:
• indexFreqAnalysis: indicates which spectral analysis should be plotted. The default value uses the last analysis structure that has been created.
• The values of the band boundaries: ULFmin, ULFmax, VLFmin, VLFmax, LFmin, LFmax, HFmin, and HFmax. If no boundaries are speciﬁed, the default values are: ULF = [0, 0.03] Hz, VLF = [0.03, 0.05] Hz, LF = [0.05, 0.15] Hz, and HF= [0.15, 0.4] Hz. If some band limit takes the NULL value, the corresponding band is not plotted.
• Usual R plotting parameters such as log, xlab, ylab, and main. • AddLegend: If TRUE, a simple legend with the band boundaries is added to the
plot.

4.3.1.1 Lomb-Scargle Periodogram
Listing 4.3.3 estimates and plots the PSD using the Lomb-Scargle periodogram. The plot produced by Listing 4.3.3 is shown in Fig. 4.3. Note the prominent peak centered at 0.25 Hz (plots are in logarithmic scale), which is the breathing frequency.

Lomb Periodogram

ULF: [0, 0.03] Hz VLF: [0.03, 0.05] Hz LF: [0.05, 0.15] Hz HF: [0.15, 0.4] Hz

10000

Spectrum

100

1

0.0

0.1

0.2

0.3

0.4

Frequency (Hz)

Fig. 4.3 PSD estimate obtained with the Lomb-Scargle periodogram

46

4 Frequency Domain Analysis

R listing 4.3.3
hrv.data <- CreateHRVData() hrv.data <- LoadBeatWFDB(hrv.data, RecordName = "M2",
RecordPath = "sampleData", annotator = "qrs") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) hrv.data <- SetVerbose(hrv.data,TRUE) hrv.data <- CreateFreqAnalysis(hrv.data)
## Creating frequency analysis ## Data has now 1 frequency analysis
hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 1, method = "lomb", doPlot = F)
## Calculating Periodogram using Lomb periodogram
PlotPSD(hrv.data, indexFreqAnalysis = 1)

After running this code, the results of the spectral analysis have been stored in the periodogram ﬁeld of the spectral analysis data structure. Depending on the method used for performing the estimation, the periodogram ﬁeld will contain different slots. However, all methods share the following common ﬁelds:
• freq: vector of frequencies at which the spectral density is estimated. • spec: spectral density estimation. • method: method used to calculate the periodogram.
Thus, hrv.data$FreqAnalysis[[1]]$spectrogram$spec (see Fig. 2.2) is an array containing the periodogram; the subscript [[1]] is due to the use of a list to store the (possibly) multiple spectral analysis data structures.
In Listing 4.3.3, the PlotPSD is using default values for all the parameters that it uses. We may change basic plotting parameters (e.g., main and log parameters), colors, or the default frequency bands shown in the plot, as shown in Listing 4.3.4. It must be noted that the frequency bands do not change the PSD estimation, but they only change the representation of this estimation (see Fig. 4.4).
R listing 4.3.4
PlotPSD(hrv.data, indexFreqAnalysis = 1, usePalette = c("black", "darkorchid3", "darkolivegreen4", "dodgerblue4", "goldenrod1"), ULFmin = NULL, ULFmax = NULL, VLFmin = 0, VLFmax = 0.05, main = "PSD estimate using Lomb-Scargle method", log = "")

4.3 Frequency Domain Analysis with RHRV

47

PSD estimate using Lomb−Scargle method
VLF: [0, 0.05] Hz LF: [0.05, 0.15] Hz HF: [0.15, 0.4] Hz

Spectrum
0 50000 100000

0.0

0.1

0.2

0.3

0.4

Frequency (Hz)

Fig. 4.4 Nondefault options with the PlotPSD function

4.3.1.2 AR-Based Periodogram
When the CalculatePSD function is used for performing AR-based PSD estimation (method = “ar”), the following parameters can be speciﬁed:
• indexFreqAnalysis and doPLot: with the same meaning as in Sect. 4.3.1.1. • n.freq: the number of frequency points at which the estimation is performed (default
is 500 points). • order: the order of the AR model to be ﬁtted. If omitted, a suitable order is chosen
using Akaike information criterion (AIC) [3].
Listing 4.3.5 illustrates how to calculate the periodogram using AR modeling prior to the PSD estimation. Since no order has been speciﬁed, CalculatePSD automatically selects a suitable order of the model. In this case, an AR(24) model has been selected, as shown in Fig. 4.5. Again, the coupling between respiration and heart rhythm produces a clear peak centered at 0.25 Hz. However, the AR spectrum is smoother than the Lomb-Scargle periodogram.
It should be noted that the AR-based PSD estimation requires equally sampled time series. To derive this series from the original RR series, Listing 4.3.5 uses the function InterpolateNIHR (see Sect. 2.2) with a sampling frequency of 4 Hz (default value), which is sufﬁcient to avoid spurious effects in the spectrum in most RR recordings. Note that Listing 4.3.3 did not use interpolation because the LombScargle periodogram does not require equally sampled data.

48

4 Frequency Domain Analysis

AR (24) spectrum

ULF: [0, 0.03] Hz VLF: [0.03, 0.05] Hz LF: [0.05, 0.15] Hz HF: [0.15, 0.4] Hz

Spectrum
0 5000 15000

0.0

0.1

0.2

0.3

0.4

Frequency (Hz)

Fig. 4.5 AR-based PSD estimation. Note the smooth periodogram that is obtained with this method

R listing 4.3.5
hrv.data <- CreateHRVData() hrv.data <- LoadBeatWFDB(hrv.data, RecordName = "M2",
RecordPath = "sampleData", annotator = "qrs") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) # AR methods do need interpolated data!! hrv.data <- InterpolateNIHR(hrv.data) hrv.data <- SetVerbose(hrv.data, TRUE) hrv.data <- CreateFreqAnalysis(hrv.data)
## Creating frequency analysis ## Data has now 1 frequency analysis
hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 1, method = "ar", doPlot = T, log = "")
## Calculating Periodogram using AR modelling
In Listing 4.3.5, CalculatePSD is using default values for all parameters for which it is possible. In Listing 4.3.6, an AR model of order 16 is used, as suggested by [15]. The periodogram obtained using the resulting model is evaluated at n.freq=1000 data points (see Fig. 4.6). It should be noted the huge effect that the order parameter has in the estimation. The spectrum showed in Fig. 4.6 has more energy in the VLF band that the spectrum showed in Fig. 4.5. The energy of the 0.25 Hz harmonic also differs between the estimates. Indeed, this variability in the AR spectrum can be misleading. The general advice is using AR modeling when we are certain that the process that is generating the data is a stationary AR model. On the other hand, when we are uncertain about the nature of the process generating the data, a nonparametric procedure should be preferred.

4.3 Frequency Domain Analysis with RHRV

49

AR (16) spectrum

ULF: [0, 0.03] Hz VLF: [0.03, 0.05] Hz LF: [0.05, 0.15] Hz HF: [0.15, 0.4] Hz

Spectrum
0 4000 8000

0.0

0.1

0.2

0.3

0.4

Frequency (Hz)

Fig. 4.6 Periodogram obtained using a ﬁxed AR model of order 16

R listing 4.3.6
# ... load, filter and interpolated data hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 1,
method = "ar", order = 16, n.freq = 1000, doPlot = T, log = "")
## Calculating Periodogram using AR modelling

4.3.1.3 DFT-Based Periodogram
The most widely used methods for PSD estimation are based on the DFT. To calculate the periodogram using a FFT (and optionally smoothing), the method parameter must take the value “pgram” within the CalculatePSD function. In this case, the CalculatePSD function shares most of its parameters with the spec.pgram function (stats package). The CalculatePSD parameters are:
• indexFreqAnalysis and doPLot: with the same meaning as in Sect. 4.3.1.1. • spans: vector of odd integers giving the widths of modiﬁed Daniell smoothers to
be used to smooth the periodogram. By default, no smoothing is applied. • kernel: alternatively, a kernel smoother of class tskernel. • taper: speciﬁes the proportion of data to taper. By default, the tap is applied to
10% of the data at the beginning and at the end of the series. • pad: proportion of data to pad. Zeros are added to the end of the series to increase
its length by the proportion pad. • fast: if TRUE, the RR series is padded to achieve a highly composite length. • demean: if TRUE, subtract the mean of the series. Default is FALSE. • detrend: if TRUE, the linear trend of the time series is removed. Default is TRUE.
Listing 4.3.7 estimates the periodogram by using the default values when method= “pgram”. Hence, the time series is detrended, taper is applied to 10% of data, and no smoothing is used (that is the reason why the resulting plot, shown in Fig. 4.7, has as title “Raw periodogram”). We can obtain smoother estimates by using longer Daniell

50

4 Frequency Domain Analysis

1e+05

Raw Periodogram

ULF: [0, 0.03] Hz VLF: [0.03, 0.05] Hz LF: [0.05, 0.15] Hz HF: [0.15, 0.4] Hz

Spectrum
1e−01 1e+01 1e+03

1e−03

0.0

0.1

0.2

0.3

0.4

Frequency (Hz)

Fig. 4.7 Periodogram obtained using the DFT (no smoothing is applied)

kernels. The Daniell kernel creates a smoothed value at time t by averaging all values between times t − m and t + m (inclusive). We can specify the length (2m + 1) of the desired Daniell kernel with the spans parameter. It is also possible to specify several passes of different smoothers by using a vector in the spans deﬁnition as shown in Listing 4.3.8. Figure 4.8 shows the PSD estimates generated by Listing 4.3.8, which are smoother than those obtained with the DFT in Fig. 4.7.
R listing 4.3.7
# ... load, filter and interpolated data hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 1,
method = "pgram")
## Calculating Periodogram using DFT + Daniell smoothers

R listing 4.3.8
# ... load, filter and interpolated data hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 1,
method = "pgram", spans = c(9, 9), ULFmin = NULL)
## Calculating Periodogram using DFT + Daniell smoothers
Although the signal being analyzed is too short for obtaining a reliable ULF estimate, we will explore the huge impact that detrending the series has in this band for illustrative purposes (see Fig. 4.9). In Listing 4.3.9, no detrending is performed, and thus, the energy in the ULF band is greater than the estimates showed in Figs. 4.7 and

4.3 Frequency Domain Analysis with RHRV

51

Smoothed Periodogram
VLF: [0.03, 0.05] Hz LF: [0.05, 0.15] Hz HF: [0.15, 0.4] Hz

Spectrum
1 10 100 1000 10000

0.1

0.2

0.3

0.4

Frequency (Hz)

Fig. 4.8 Periodogram obtained using the DFT and two passes of a Daniell smoother of length 9

Smoothed Periodogram
ULF: [0, 0.03] Hz VLF: [0.03, 0.05] Hz LF: [0.05, 0.15] Hz HF: [0.15, 0.4] Hz

1e+04

Spectrum

1e+00

0.0

0.1

0.2

0.3

0.4

Frequency (Hz)

Fig. 4.9 Illustration of the effect of detrending in the PSD estimation. Compare this ﬁgure with Fig. 4.8. Since the time series has not been detrended, the energy in the ULF band dominates the periodogram

4.8. Most authors recommend detrending the RR series before performing spectral analysis to avoid spurious effects in the ULF band [32].
R listing 4.3.9
# ... load, filter and interpolated data hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 1,
method = "pgram", spans = c(9, 9), detrend = F)
## Calculating Periodogram using DFT + Daniell smoothers

Additional parameters or even different kernels can be used when method=“pgram” but, for the sake of brevity, we will not explain them here. The interest reader is referred to [36] and the documentation of the spec.pgram function.

52

4 Frequency Domain Analysis

4.3.1.4 Creating Several Frequency Analysis

It is possible to store in the same hrv.data structure multiple spectral analyses. There are several reasons why this may be useful. We may be interested in performing the analyses with different parameters (e.g., different kernels or AR models). We may also be interested in using different techniques (Lomb-Scargle, AR models, or the FT) and compare the results.
We can call the function CreateFreqAnalysis as many times as necessary to create a data structure to store the results of each frequency analysis, and then, we shall use the parameter indexFreqAnalysis to indicate which spectral analysis we are working with. Listing 4.3.10 uses this procedure for creating a “multiplot” in which we compare the different analysis methods presented in the previous sections. Figure 4.10 illustrates the main characteristics of the three methods. The DFT-based periodogram looks like a compromise between both the Lomb-Scargle periodogram and the AR periodogram. The Lomb-Scargle periodogram provides clear evidence of the harmonics present in the signal whereas its estimations in the lower frequencies are usually smaller than in the rest of the methods, since it avoids the low pass effect introduced by the resampling [32]. Finally, The AR method produces the smoothest spectrum although as we have already argued, the spectrum can be misleading [48].

Lomb Periodogram

AR (16) spectrum

100 10000

Spectrum

100 10000

Spectrum

1

1

0.0 0.1 0.2 0.3 0.4 Frequency (Hz)
Raw Periodogram

0.0 0.1 0.2 0.3 0.4 Frequency (Hz)
Smoothed Periodogram

100 10000

Spectrum

100 10000

Spectrum

1

1

0.0 0.1 0.2 0.3 0.4 Frequency (Hz)

0.0 0.1 0.2 0.3 0.4 Frequency (Hz)

Fig. 4.10 Comparison of the different PSD estimation methods

4.3 Frequency Domain Analysis with RHRV

53

R listing 4.3.10
hrv.data <- CreateHRVData() hrv.data <- LoadBeatWFDB(hrv.data, RecordName = "M2",
RecordPath = "sampleData", annotator = "qrs") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) hrv.data <- SetVerbose(hrv.data, TRUE) # Lomb-Scargle does not require interpolation ... hrv.data <- CreateFreqAnalysis(hrv.data)
## Creating frequency analysis ## Data has now 1 frequency analysis
hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 1, method = "lomb", doPlot = F)
## Calculating Periodogram using Lomb periodogram
# ... but the others methods need equally sampled data hrv.data <- InterpolateNIHR(hrv.data)
## Interpolating instantaneous heart rate ## Frequency: 4 Hz ## Number of beats: 662 ## Number of points: 2387
hrv.data <- CreateFreqAnalysis(hrv.data)
## Creating frequency analysis ## Data has now 2 frequency analysis
hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 2, method = "ar", order = 16, doPlot = F)
## Calculating Periodogram using AR modelling
hrv.data <- CreateFreqAnalysis(hrv.data)
## Creating frequency analysis ## Data has now 3 frequency analysis
hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 3, method = "pgram", doPlot = F)
## Calculating Periodogram using DFT + Daniell smoothers
hrv.data <- CreateFreqAnalysis(hrv.data)
## Creating frequency analysis ## Data has now 4 frequency analysis
hrv.data <- CalculatePSD(hrv.data, indexFreqAnalysis = 4, method = "pgram", spans = 9, doPlot = F)
## Calculating Periodogram using DFT + Daniell smoothers
# Plot the results use.ylim = c(1, 1.5e+5) layout(matrix(1:4, 2, 2, byrow = TRUE)) PlotPSD(hrv.data, 1, addLegend = FALSE,
addSigLevel = F, ylim = use.ylim) PlotPSD(hrv.data, 2, addLegend = FALSE,
ylim = use.ylim) PlotPSD(hrv.data, 3, addLegend = FALSE,
ylim = use.ylim) PlotPSD(hrv.data, 4, addLegend = FALSE,
ylim = use.ylim)

54

4 Frequency Domain Analysis

Non−interpolated instantaneous heart rate

HR (beats/min.)
80 120 160

0

2000

4000

6000

time (sec.)

Fig. 4.11 Heart rate series used for illustrative purposes in this chapter. Note the drop in heart rate due to the prostaglandin E1 administration

4.3.2 Frequency Analysis of Nonstationary Signals
In this section, a recording that belongs to a patient admitted to an ICU that suffered from paraplegia and hypertension (systolic blood pressure above 200 mmHg) will be used. About 30 min after starting the recording, he is administered prostaglandin E1 (a vasodilator). His systolic blood pressure fell quickly to 100 mmHg, and then, it increased slowly during almost an hour up to approximately 150 mmHg. The heart rate time series is shown in Fig. 4.11.
This recording, that will be referred to as “example.beats,” can be freely downloaded from [20] (under the Documentation section). Additionally, the data from this ﬁle has been included in RHRV. The user can access this data executing the code shown in Listing 4.3.11.
R listing 4.3.11
# hrv.data structure containing the heart beats data("HRVData") # HRVData structure storing the results of processing # the # heart beats: the beats have been filtered, # interpolated, ... data("HRVProcessedData")
The most important function to perform nonstationary spectral HRV analysis is the CalculatePowerBand function. The CalculatePowerBand function computes the spectrogram of the RR series in the ULF, VLF, LF, and HF frequency bands using STFT or wavelets. Boundaries of the bands may be chosen by the user by

4.3 Frequency Domain Analysis with RHRV

55

specifying the values of the function parameters ULFmin, ULFmax, VLFmin, VLFmax, LFmin, LFmax, HFmin, and HFmax. If no boundaries are speciﬁed, the default values are: ULF= [0, 0.03] Hz, VLF=[0.03, 0.05] Hz, LF= [0.05, 0.15] Hz, and HF= [0.15, 0.4] Hz.
Internally, the CalculatePowerBand function computes the spectrogram by using either STFT or wavelets. The type of analysis can be selected by the user by specifying the type parameter. The possible values of this parameter are “fourier” or “wavelet”. Although the analysis based on wavelets is theoretically superior and more suitable for nonstationary signals, to maintain backwards compatibility in RHRV the default value for this parameter is “fourier”. In the following subsections, we will see the parameters that can be speciﬁed when performing the analysis using Fourier and wavelets.

4.3.2.1 Frequency Domain Analysis Using Fourier
When CalculatePowerBand uses the STFT to compute the spectrogram, the user may specify the following parameters:
• indexFreqAnalysis: indicates in which spectral data structure the analysis results will be stored. The default value uses the last analysis structure that has been created.
• The values of the band boundaries: ULFmin, ULFmax, VLFmin, VLFmax, LFmin, LFmax, HFmin, HFmax.
• size: the size of the window used for calculating the spectrogram measured in seconds. Internally, the RHRV package uses a Hamming window when computing the STFT.
• shift: the displacement of window for calculating the spectrogram measured in seconds. If shift < size, there will be overlap between the windows.
• sizesp: the number of points for calculating each window of the STFT. It must be greater than or equal to the number of samples of the window size. It is highly recommended to select sizesp so that it is a highly composite number. If the user does not specify the value of sizesp, RHRV uses the shortest length that is a power of two and that is larger than the window size.
Listing 4.3.12 performs a frequency analysis in the typical HRV spectral bands, based on the STFT. It uses a 600 s window size and a 30 s displacement (these are typical values when performing HRV spectral analysis). As usual, before performing any analysis of the RR intervals, we must ﬁlter out outliers (FilterNIHR). As in Sects. 4.3.1.2 and 4.3.1.3, we need an equally spaced time series, and hence the use of the InterpolateNIHR function.

56

4 Frequency Domain Analysis

R listing 4.3.12
hrv.data <- CreateHRVData() hrv.data <- SetVerbose(hrv.data, FALSE) hrv.data <- LoadBeatAscii(hrv.data, "sampleData/example.beats") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) hrv.data <- InterpolateNIHR(hrv.data) hrv.data <- CreateFreqAnalysis(hrv.data) hrv.data <- SetVerbose(hrv.data, TRUE) hrv.data <- CalculatePowerBand(hrv.data, size = 600,
shift = 30)
## Calculating power per band ## Using Fourier analysis ## Windowing signal... 227 windows ## Power per band calculated

After running this code, the results of the spectral analysis have been stored in the ﬁelds of the spectral analysis data structure. For example, hrv.data$FreqAnalysis[[1]] $HRV (see Fig. 2.2) is an array containing the total spectral power for each of the windows used in the STFT; the subscript [[1]] is due to the use of a list to store the (possibly) multiple spectral analysis data structures. The ﬁelds $ULF, $VLF, $LF and $HF of the data structure $FreqAnalysis[[1]] are arrays containing the power in the bands ULF, VLF, LF, and HF, respectively. The ﬁeld $LFHF is an array containing the ratio of the power in LF and in HF. Each of these arrays contains one value for each shift of the window used in the STFT.
Given that the RR series is not stationary, it is often interesting to analyze the temporal evolution of the spectral power in the different bands. However, if the recording analyzed is short, or if we assume approximately stationary conditions over the recording, we may be interested in working with the average values of the spectral power in each of the bands. These average values are also computed by the function CalculatePowerBand and stored in the ﬁelds $ULF_mean, $VLF_mean, $LF_mean, HF_mean, and $LFHF_mean (see Fig. 2.2).
In Listing 4.3.12, the function CalculatePowerBand is using default values for all the parameters for which it is possible to use a default value. We may have speciﬁed the number of points for calculating each window of the STFT, and the limits of the frequency bands. The call to the function CalculatePowerBand in Listing 4.3.13 is equivalent to the function call in Listing 4.3.12, where all possible parameters when using the STFT have been speciﬁed (although they have assigned the same values that are assigned by default):

4.3 Frequency Domain Analysis with RHRV

57

R listing 4.3.13

hrv.data <CalculatePowerBand(hrv.data, indexFreqAnalysis= 1, size = 600, shift = 30, sizesp = 4096, type = "fourier", ULFmin = 0, ULFmax = 0.03, VLFmin = 0.03, VLFmax = 0.05, LFmin = 0.05, LFmax = 0.15, HFmin = 0.15, HFmax = 0.4 )

The value of the zero-padding must be greater than the number of samples of the window. Given that the sampling frequency is fs = 4 Hz (the default value of the InterpolateNIHR function), the zero-padding value must fulﬁll sizesp ≥ size · fs. In this occasion, we have selected the smallest power of 2 that meets the previous condition: sizesp = 4096 = 212 > 2400 = 600 · 4 (size · fs); hence the 4096 = 212 value of the sizesp parameter.

4.3.2.2 Plotting the Spectral Bands
RHRV provides a function for plotting the spectral power of each frequency band: PlotPowerBand. This function can receive as inputs:
• indexFreqAnalysis: indicates which spectral analysis will be plotted. By default, the last spectral analysis that has been carried out is plotted.
• ymax: the maximum value of the y-axis of the power bands plot. • ymaxratio: the maximum value of the y-axis in the LF/HF plot.
R listing 4.3.14
PlotPowerBand(hrv.data, ymax = 200, ymaxratio = 1.7)
## Plotting power per band ## Plotted LF/HF ## Plotted ULF ## Plotted VLF ## Plotted LF ## Plotted HF ## Power per band plotted
Listing 4.3.14 plots the power bands computed in Listing 4.3.12. Figure 4.12 shows the plot produced by Listing 4.3.14. We can observe a signiﬁcant temporal

58

4 Frequency Domain Analysis

Power bands of HRV

LF/HF 0.0 1.0

1000

2000

3000

4000

5000

6000

7000

ULF 0 100 200

1000

2000

3000

4000

5000

6000

7000

VLF 0 100 200

1000

2000

3000

4000

5000

6000

7000

LF 0 100 200

1000

2000

3000

4000

5000

6000

7000

HF 0 100 200

1000

2000

3000

4000

Time (seconds)

5000

6000

7000

Fig. 4.12 Power Bands computed using the STFT

variation in the spectral power bands throughout the two hours of recording, especially in the ULF band. Computing only average values of the spectral bands hides this type of information. Therefore, when conducting a frequency analysis, we recommend, at least, to perform a visual inspection of the temporal evolution of the spectral bands.
RHRV supplies another function for computing the spectrogram without being restricted to the four standard bands: CalculateSpectrogram. This function uses the STFT to compute a matrix where rows represent time, and columns represent frequency. This matrix is not stored in the HRVData structure, since it can be very expensive in terms of memory. In the function CalculateSpectrogram we can specify the same size, shift, and sizesp parameters used in the CalculatePowerBand function.
We shall compute the spectrogram of the “example.beats” recording:

4.3 Frequency Domain Analysis with RHRV

59

R listing 4.3.15
hrv.data <- CreateHRVData() hrv.data <- SetVerbose(hrv.data, FALSE) hrv.data <- LoadBeatAscii(hrv.data, "sampleData/example.beats") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) hrv.data <- InterpolateNIHR (hrv.data) hrv.data <- CreateFreqAnalysis(hrv.data) hrv.data <- CalculatePowerBand(hrv.data, size = 600,
shift = 30) spectrogram <- CalculateSpectrogram(hrv.data,
size = 600, shift = 30)

A graphical representation of the spectrogram can be obtained with the R function image, or with the RHRV PlotSpectrogram function (see Fig. 4.13). In addition to the usual size, shift, and sizesp parameters, the user can specify the following ones:
• scale: The scale used to plot spectrogram. The possible values are “linear” (linear axis) or “logarithmic” (logarithmic axis).
• freqRange: It speciﬁes the minimum and maximum frequency values to represent on the y-axis. It permits obtaining a more detailed representation of a spectral band.
R listing 4.3.16
spectrogram <- PlotSpectrogram(HRVData = hrv.data, size = 600, shift = 60, scale = "logaritmic", freqRange = c(0, 0.4))
## Plotting spectrogram ## Calculating spectrogram ## Window: 2400 samples (shift: 240 samples) ## Window size for calculation: 4096 samples (zero padding: 1696 samples) ## Signal size: 29592 samples ## Windowing signal with 114 windows ## Spectrogram calculated ## Spectrogram plotted

Figure 4.13 shows the plot produced by Listing 4.3.16. Note that most of the energy is concentrated in the low frequencies. We can also see how these low frequencies, which correspond to the ULF band, decrease about a half hour into the recording, and then increase again, following the patient’s blood pressure.
Since the energy is concentrated in the ULF band, the spectrogram representation may be hiding interesting information on the other bands (because its energy is negligible compared to the energy in the ULF band). Listing 4.3.17 plots the spectrogram ignoring the energy in the lowest frequencies. Figure 4.14 shows the resulting plot.

60
0.3 0.2 0.1

Frequency (Hz.)

4 Frequency Domain Analysis Spectrogram of the HR series
8
6
4
2

0.0

0

0 1000 2000 3000 4000 5000 6000 7000

Time (sec.)

Fig. 4.13 Spectrogram of the RR time series

R listing 4.3.17
spectrogram <- PlotSpectrogram(HRVData = hrv.data, size = 600, shift = 60, scale = "logaritmic", freqRange = c(0.04, 0.4))

4.3.2.3 Frequency Domain Analysis Using wavelets
The CalculatePowerBand function can compute the spectral power in the ULF, VLF, LF, and HF bands using the WT. In this case, the type parameter must take the value “wavelet” (the default value is “fourier”). When wavelets are used for the computation of the spectral power, the following parameters can be speciﬁed:
• indexFreqAnalysis: indicates in which spectral analysis data structure the results will be stored. By default, the results are stored in the last spectral structure that has been created.
• The values of the band boundaries: ULFmin, ULFmax, VLFmin, VLFmax, LFmin, LFmax, HFmin, and HFmax.

4.3 Frequency Domain Analysis with RHRV Spectrogram of the HR series
0.35

61
0.8

Frequency (Hz.)

0.30

0.6

0.25 0.4
0.20

0.15 0.2
0.10

0.05 0.0
0 1000 2000 3000 4000 5000 6000 7000
Time (sec.)
Fig. 4.14 Spectrogram ignoring the ULF band. The presence of harmonic components is apparent

• wavelet: the mother wavelet used to calculate the spectrogram. Some of the most widely used wavelets are available: Haar (“haar”), extremal phase (“d4,” “d6,” “d8,” and “d16”), the least asymmetric Daubechies (“la8,” “la16,” and “la20”), and the best localized Daubechies (“bl14” and “bl20”) wavelets among others. The default value is “d4.”
• bandtolerance: maximum error allowed for the band boundaries when the waveletbased analysis is performed (see more details in [21, 22]). It can be speciﬁed as either an absolute or a relative error. The default value is 0.01.
• relative: a logic value specifying which type of band tolerance error shall be used: relative (in percentage) or absolute (this is the default value).
In the wavelet parameter, the name of the wavelet speciﬁes the family (the family determines the shape of the wavelet and its properties) and the length of the wavelet. For example, “la8” belongs to the least asymmetric family and has a length of 8 samples. Shorter wavelets usually have better temporal resolution, but they will tend to fail when discriminating close frequencies. On the other hand, longer wavelets usually have worse temporal resolution, but they provide better frequency resolution. Better temporal resolution means that we can study shorter-time intervals. Depending on the goal of the analysis, we can choose longer or shorter wavelets within a wavelet family.

62

4 Frequency Domain Analysis

Let [fl, fu] be any frequency band speciﬁed by the user, and let [f1, f2] be a fre-

quency interval associated with some node in the Maximal Overlap Discrete Wavelet

Packet Transform (MODWPT) tree [41]. The relative error εr of fl over the [f1, f2]

interval is computed as:

εr =

fl − f1 fu − fl

· 100%.

Similarly, the relative error εr of the upper frequency fu is:

εr =

fu − f2 fu − fl

· 100%.

The use of a relative error (relative=TRUE) has the advantage of avoiding large errors in the lower frequency bands (ULF and VLF bands). The absolute value ε is deﬁned as usual: ε = |f2 − fu| for the upper frequency and ε = |f1 − fl| for the lower frequency. For implementation details of how the spectral power in each band is estimated from the coefﬁcients of the MODWPT tree, we refer the reader to [21].
We will repeat the analysis of Listing 4.3.18 using wavelets. We will use an absolute tolerance of 0.01 Hz, and the least asymmetric Daubechies of width 4 (“d4,” the default value):

R listing 4.3.18

hrv.data <- CreateHRVData() hrv.data <- SetVerbose(hrv.data, FALSE) hrv.data <- LoadBeatAscii(hrv.data, "example.beats") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) hrv.data <- InterpolateNIHR (hrv.data) hrv.data <- CreateFreqAnalysis(hrv.data) hrv.data <- SetVerbose(hrv.data, TRUE) hrv.data <- CalculatePowerBand(hrv.data,
size = 600, shift = 30) hrv.data <- CalculatePowerBand(hrv.data,
type = "wavelet", bandtolerance = 0.01, relative = FALSE)

In Listing 4.3.18, the function CalculatePowerBand is using default values for all parameters for which it is possible to use a default value. The call to the function CalculatePowerBand in Listing 4.3.19 is equivalent to the function call shown in Listing 4.3.19.

4.3 Frequency Domain Analysis with RHRV

63

R listing 4.3.19

hrv.data <CalculatePowerBand(hrv.data, indexFreqAnalysis= 1, type = "wavelet", wavelet = "d4", bandtolerance = 0.01, relative = FALSE, ULFmin = 0, ULFmax = 0.03, VLFmin = 0.03, VLFmax = 0.05, LFmin = 0.05, LFmax = 0.15, HFmin = 0.15, HFmax = 0.4)

4.3.2.4 Creating Several Frequency Analysis
As shown in Sect. 4.3.1.4, we can create multiple analyses with the CreateFreqAnalysis function and store them in the same HRVData structure. To perform this task, we shall call the function CreateFreqAnalysis as many times as necessary, as shown in Listing 4.3.20.
R listing 4.3.20
hrv.data <- CreateHRVData() hrv.data <- LoadBeatAscii(hrv.data, "sampleData/example.beats") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) hrv.data <- InterpolateNIHR(hrv.data, freqhr = 4) hrv.data <- CreateFreqAnalysis(hrv.data) # use freqAnalysis number 1 with Fourier analysis hrv.data <- CalculatePowerBand(hrv.data,
indexFreqAnalysis = 1, size = 600, shift = 30, type = "fourier") PlotPowerBand(hrv.data, indexFreqAnalysis = 1, ymax = 200, ymaxratio = 1.7) # use freqAnalysis number 2 with wavelet analysis hrv.data <- CreateFreqAnalysis(hrv.data) hrv.data <- CalculatePowerBand(hrv.data, indexFreqAnalysis = 2, type = "wavelet", wavelet = "la8", bandtolerance = 0.01, relative = FALSE) PlotPowerBand(hrv.data, indexFreqAnalysis = 2, ymax = 800, ymaxratio = 50)
Figure 4.15a and b show the plots produced by Listing 4.3.20. They illustrate important differences between Fourier and wavelet-based frequency analyses. The

64

4 Frequency Domain Analysis

Power bands of HRV

LF/HF
0.0 1.0

1000

2000

3000

4000

5000

6000

7000

ULF
0 100 200

VLF
0 100 200

1000

2000

3000

4000

5000

6000

7000

1000

2000

3000

4000

5000

6000

7000

1000

2000

3000

4000

5000

6000

7000

LF
0 100 200

HF
0 100 200

LF/HF
0 20 40

1000

2000

3000

4000

Time (seconds)

5000

6000

7000

(a) Fourier analysis

Power bands of HRV

0

2000

4000

6000

0

2000

4000

6000

0

2000

4000

6000

ULF
0 400 800

VLF
0 400 800

LF
0 400 800

0

2000

4000

6000

HF
0 400 800

0

2000

4000

6000

Time (seconds)

(b) Wavelet analysis

Fig. 4.15 Analysis of the RR series using both Fourier and the wavelet transform

4.3 Frequency Domain Analysis with RHRV

65

power range in both plots is not the same due to the windowing used in both techniques. Thus, we should avoid direct comparisons between the numerical results obtained with Fourier with those obtained using wavelets. The Fourier’s power spectrum is smoother than the wavelet’s power spectrum. This is a consequence of the higher temporal resolution that the wavelet-based analysis provides. The Fourier power spectrum has a smaller number of samples than the original signal as a consequence of the use of windows. Conversely, the wavelet power spectrum has the same number of samples as the original RR time series. We could try to increase Fourier’s temporal resolution by decreasing the window’ size used in the analysis: The shorter window we use, the sharper spectrum we get. However, when using smaller windows, spectral resolution decreases.

4.4 Changes in HRV Frequency-Based Statistics Under Pathological Conditions
HRV power spectrum follows the general rule that the more healthy a heart is, the more variability it has. Typically, under pathological conditions, there often is a decrease on the spectral power in all bands. This decrease tends to affect more often the HF band. It is also common that under pathological conditions, there is increased sympathetic activity either in absolute terms (and therefore, it is associated with an increase in total power in the LF band) or in relative terms (and therefore, it is associated with an increase in the ratio LF/HF). In the following paragraphs, we summarize some of the changes in HRV power spectrum under pathological conditions for which there is considerable evidence in the literature, although this section is far from being an exhaustive list.
After myocardial infarction, patients present reduced overall spectral power and a reduced power in each frequency band [16, 29], although there is a relative increase in the power in the LF band compared to the HF band. These patients also have an increased LF/HF pointing to a change in the sympathetic-vagal balance toward the predominance of sympathetic tone. Spectral HRV is a predictor of mortality and of arrhythmic complications in patients following acute myocardial infarction and can be used for risk stratiﬁcation [47].
Patients suffering from cardiomyopathies [17] and from supraventricular arrhythmias [30] have total spectral power and power in the HF band reduced. Patients suffering from ventricular arrhythmias present a reduction in total spectral power before the onset of sustained ventricular tachycardia when compared with the onset of a nonsustained ventricular tachycardia [26]. Patients suffering from mitral valve prolapse present a decrease in power in the HF band [46].
Right after a heart transplant, patients have very reduced power in all spectral bands [2, 44]. As re-innervation progresses after the transplant, the spectral power increases, although it still remains reduced compared with healthy patients.

66

4 Frequency Domain Analysis

Patients suffering from congestive heart failure present reduced spectral power in all frequencies, especially below 0.04 Hz [14, 25]. They also present an increased LF/HF pointing to a predominance of sympathetic tone [13].
Patients at risk of suffering sudden death or cardiac arrest present a increase in power in the LF band and a decrease in power in the HF band [5, 18], pointing to an increased sympathetic activity compared to control patients, and a decreased vagal activity. Similar ﬁndings appear in patients with hypertension [24, 33].
Patients with diabetic neuropathy present a reduction in the absolute power in the bands LF and HF [38] although the ratio LF/HF is not altered.
Obstructive sleep apnea syndrome produces an increase in total spectral power, and in the VLF and LF bands. The LF/HF ratio is also increased [28, 39].

References
1. Exaggerated heart rate oscillations during two meditation techniques: http://physionet.org/ physiobank/database/meditation/data/. Last accessed: 27-05-2016
2. Acharya UR, Joseph KP, Kannathal N, Lim CM, Suri JS (2006) Heart rate variability: a review. Med Biol Eng Comput 44(12):1031–1051
3. Akaike H (1998) Information theory and an extension of the maximum likelihood principle. In: Selected papers of Hirotugu Akaike. Springer, pp 199–213
4. Akselrod S, Gordon D, Ubel FA, Shannon DC, Berger A, Cohen RJ (1981) Power spectrum analysis of heart rate ﬂuctuation: a quantitative probe of beat-to-beat cardiovascular control. Science 213(4504):220–222
5. Algra A, Tijssen J, Roelandt J, Pool J, Lubsen J (1993) Heart rate variability from 24-hour electrocardiography and the 2-year risk for sudden death. Circulation 88(1):180–185
6. Appel ML, Berger RD, Saul JP, Smith JM, Cohen RJ (1989) Beat to beat variability in cardiovascular variables: noise or music? J Am Coll Cardiol 14(5):1139–1148
7. Arai Y, Saul JP, Albrecht P, Hartley LH, Lilly LS, Cohen RJ, Colucci WS (1989) Modulation of cardiac autonomic activity during and immediately after exercise. Am J Physiol 256(1):H132– H141
8. Babaeizadeh S, Zhou S, Liu X, Hu W, Feild D, Helfenbein E, Gregg R, Lindauer J (2007) A novel heart rate variability index for evaluation of left ventricular function using ﬁve-minute electrocardiogram. In: IEEE computers in cardiology, pp 473–476
9. Bailón R, Mateo J, Olmos S, Serrano P, García J, Del Río A, Ferreira I, Laguna P (2003) Coronary artery disease diagnosis based on exercise electrocardiogram indexes from repolarisation, depolarisation and heart rate variability. Medi Biol Eng Comput 41(5):561–571
10. Berntson GG, Cacioppo JT (2004) Heart rate variability: Stress and psychiatric conditions. In: Dynamic electrocardiography, pp 57–64
11. Bickel A, Yahalom M, Roguin N, Frankel R, Breslava J, Ivry S, Eitan A (2002) Power spectral analysis of heart rate variability during positive pressure pneumoperitoneum. Surg Endosc Interv Tech 16(9):1341–1344
12. Bickel A, Yahalom M, Roguin N, Ivry S, Breslava J, Frankel R, Eitan A (2004) Improving the adverse changes in cardiac autonomic nervous control during laparoscopic surgery, using an intermittent sequential pneumatic compression device. Am J Surg 187(1):124–127
13. Binkley PF, Haas GJ, Starling RC, Nunziata E, Hatton PA, Leier CV, Cody RJ (1993) Sustained augmentation of parasympathetic tone with angiotensin-converting enzyme inhibition in patients with congestive heart failure. J Am Coll Cardiol 21(3):655–661

References

67

14. Binkley PF, Nunziata E, Haas GJ, Nelson SD, Cody RJ (1991) Parasympathetic withdrawal is an integral component of autonomic imbalance in congestive heart failure: demonstration in human subjects and veriﬁcation in a paced canine model of ventricular failure. J Am Coll Cardiol 18(2):464–472
15. Boardman A, Schlindwein FS, Rocha AP (2002) A study on the optimum order of autoregressive models for heart rate variability. Physiol Meas 23(2):325–336
16. Carney RM, Blumenthal JA, Freedland KE, Stein PK, Howells WB, Berkman LF, Watkins LL, Czajkowski SM, Hayano J, Domitrovich PP et al (2005) Low heart rate variability and the effect of depression on post-myocardial infarction mortality. Arch Intern Med 165(13):1486–1491
17. Counihan PJ, Fei L, Bashir Y, Farrell TG, Haywood GA, McKenna WJ (1993) Assessment of heart rate variability in hypertrophic cardiomyopathy. association with clinical and prognostic features. Circulation 88(4):1682–1690
18. Dougherty CM, Burr RL (1992) Comparison of heart rate variability in survivors and nonsurvivors of sudden cardiac arrest. Am Cardiol 70(4):441–448
19. Gabor D (1946) Theory of communication. part 1: the analysis of information. J Inst Electr Eng Part III Radio Commun Eng 93(26):429–441
20. García CA, Otero A, Lado M, Méndez A, Rodríguez-Linares L, Vila X. The RHRV project homepage: http://rhrv.r-forge.r-project.org/. Last accessed: 27-05-2016
21. García CA, Otero A, Vila X, Márquez DG (2013) A new algorithm for wavelet-based heart rate variability analysis. Biomed Signal Process Control 8(6):542–550
22. García CA, Otero A, Vila XA, Lado MJ (2012) An open source tool for heart rate variability wavelet-based spectral analysis. In: BIOSIGNALS 2012-proceedings of the international conference on bio-inspired systems and signal processing, vol 2012. Vilamoura, Algarve, Portugal, pp 206–211, 1–4 February 2012
23. Gordon D, Herrera VL, McAlpine L, Cohen RJ, Akselrod S, Lang P, Norwood WI (1988) Heart-rate spectral analysis: a noninvasive probe of cardiovascular regulation in critically ill children with heart disease. Pediatr Cardiol 9(2):69–77
24. Guzzetti S, Dassi S, Pecis M, Casat R, Masu AM, Longoni P, Tinelli M, Cerutti S, Pagani M, Malliani A (1991) Altered pattern of circadian neural control of heart period in mild hypertension. J Hypertens 9(9):831–838
25. Guzzetti S, La Rovere MT, Pinna GD, Maestri R, Borroni E, Porta A, Mortara A, Malliani A (2005) Different spectral components of 24 h heart rate variability are related to different modes of death in chronic heart failure. Eur Heart J 26(4):357–362
26. Huikuri H, Valkama J, Airaksinen K, Seppänen T, Kessler K, Takkunen J, Myerburg R (1993) Frequency domain measures of heart rate variability before the onset of nonsustained and sustained ventricular tachycardia in patients with coronary artery disease. Circulation 87(4):1220– 1228
27. Kamath MV, Fallen EL (1992) Power spectral analysis of heart rate variability: a noninvasive signature of cardiac autonomic function. Crit Rev Biomed Eng 21(3):245–311
28. Kesek M, Franklin KA, Sahlin C, Lindberg E (2009) Heart rate variability during sleep and sleep apnoea in a population based study of 387 women. Clin Physiol Funct Imaging 29(4):309–315
29. Kleiger RE, Miller JP, Bigger JT Jr, Moss AJ (1987) Decreased heart rate variability and its association with increased mortality after acute myocardial infarction. Am Cardiol 59(4):256– 262
30. Kocovic DZ, Harada T, Shea JB, Soroff D, Friedman PL (1993) Alterations of heart rate and of heart rate variability after radiofrequency catheter ablation of supraventricular tachycardia. Delineation of parasympathetic pathways in the human heart. Circulation 88(4):1671–1681
31. Kuwahara M, Yayou K-I, Ishii K, Hashimoto S-I, Tsubone H, Sugano S (1994) Power spectral analysis of heart rate variability as a new method for assessing autonomic activity in the rat. Electrocardiology 27(4):333–337
32. Laguna P, Moody GB, Mark RG (1998) Power spectral density of unevenly sampled data by least-square analysis: performance and application to heart rate signals. IEEE Trans Biomed Eng 45(6):698–715

68

4 Frequency Domain Analysis

33. Langewitz W, Rüddel H, Schächinger H (1994) Reduced parasympathetic cardiac control in patients with hypertension at rest and under mental stress. Am Heart J 127(1):122–128
34. Lomb NR (1976) Least-squares frequency analysis of unequally spaced data. Astrophys Space Sci 39(2):447–462
35. Malliani A, Pagani M, Lombardi F, Cerutti S (1991) Cardiovascular neural regulation explored in the frequency domain. Circulation 84(2):482–492
36. Metcalfe AV, Cowpertwait PS (2009) Introductory time series with R. Springer 37. Nishikino M, Matsunaga T, Yasuda K, Adachi T, Moritani T, Tsujimoto G, Tsuda K, Aoki
N (2006) Genetic variation in the renin-angiotensin system and autonomic nervous system function in young healthy japanese subjects. J Clin Endocrinol Metab 91(11):4676–4681 38. Pagkalos M, Koutlianos N, Kouidi E, Pagkalos E, Mandroukas K, Deligiannis A (2008) Heart rate variability modiﬁcations following exercise training in type 2 diabetic patients with deﬁnite cardiac autonomic neuropathy. British Sports Med 42(1):47–54 39. Park D-H, Shin C-J, Hong S-C, Yu J, Ryu S-H, Kim E-J, Shin H-B, Shin B-H (2008) Correlation between the severity of obstructive sleep apnea and heart rate variability indices. Korean Med Sci 23(2):226–231 40. Peng C-K, Mietus JE, Liu Y, Khalsa G, Douglas PS, Benson H, Goldberger AL (1999) Exaggerated heart rate oscillations during two meditation techniques. Int J Cardiol 70(2):101–107 41. Percival DB, Walden AT (2006) Wavelet methods for time series analysis. Cambridge University Press 42. Pereira-Junior PP, Chaves EA, Costa-e Sousa RH, Masuda MO, de Carvalho ACC, Nascimento JH (2006) Cardiac autonomic dysfunction in rats chronically treated with anabolic steroid. Eur J Appl Physiol 96(5):487–494 43. Proakis JG, Manolakis DG (1988) Introduction to digital signal processing. Prentice Hall Professional Technical Reference 44. Sands K, Appel ML, Lilly LS, Schoen FJ, Mudge G, Cohen RJ (1989) Power spectrum analysis of heart rate variability in human cardiac transplant recipients. Circulation 79(1):76–82 45. Scargle JD (1982) Studies in astronomical time series analysis. II-statistical aspects of spectral analysis of unevenly spaced data. Astrophys J 263:835–853 46. Stein KM, Borer JS, Hochreiter C, Okin PM, Herrold EM, Devereux RB, Kligﬁeld P (1993) Prognostic value and physiological correlates of heart rate variability in chronic severe mitral regurgitation. Circulation 88(1):127–135 47. Task Force of the European Society of Cardiology and the North American Society of Pacing and Electrophysiology (1996) Heart rate variability: Standards of measurement, physiological interpretation and clinical use. Eur Heart J 17:354–381 48. Thomson D (1990) Time series analysis of holocene climate data. Philos Trans R Soc Lond Ser A Math Phys Sci 330(1615): 601–616 49. Yasuma F, Hayano J-I (2004) Respiratory sinus arrhythmia: why does the heartbeat synchronize with respiratory rhythm? Chest J 125(2):683–690

Chapter 5
Nonlinear and Fractal Analysis

Abstract There are many complex systems in nature that can be explained by nonlinear interactions of its main components. The heart rate regulation is one of the most complex systems in the human body. Heart rhythm is innervated by both the parasympathetic and sympathetic branches of the ANS. At the same time, the autonomic nervous system is inﬂuenced by humoral effects, hemodynamic variables, respiratory rhythm, and stroke volume, among others. Furthermore, there exist feedback loops among these mechanisms inﬂuencing each other in a nonlinear way. A consequence of these nonlinear interactions is that heart rate modulation cannot be fully understood by studying its components in isolation. However, the study of the heart rhythm modulation as a whole is a formidable task. A more common approach in the literature, more modest than the full comprehension of the heart rate regulation system, is trying to quantify the complexity of heart rate using nonlinear statistics derived from the chaos theory or from fractal processes. In this chapter, we summarize the most widely used statistics based on nonlinear and fractal dynamics, and we show how to compute them with RHRV.

5.1 An Overview of Nonlinear Dynamics

Most nonlinear time series analysis techniques used in the HRV literature are motivated by the theory of dynamical systems. A dynamical system is represented by a set of n state variables (that can be represented as coordinates in Rn) that fully describe the state of the system at any time, and a dynamical rule that speciﬁes the future values of all the state variables. The collection of coordinates is usually referred to as the state space or phase space if these coordinates form a smooth manifold. There can be multiple spaces of states representing a dynamical system; i.e., the system representation is not unique. Dynamical systems can be deterministic (the future state is fully determined by the dynamical rule), or stochastic/random (there is a probability distribution deﬁned over the future states).
In the context of HRV analysis, many successful approaches assume that the RR series is a deterministic nonlinear process (with possibly a small linear random perturbation). In this chapter, when applying techniques derived from deterministic

© Springer International Publishing AG 2017

69

C.A. García Martínez et al., Heart Rate Variability Analysis

with the R package RHRV, Use R!, DOI 10.1007/978-3-319-65355-6_5

70

5 Nonlinear and Fractal Analysis

nonlinear dynamics to the RR series, we shall assume that the HR regulation system is dissipative, and thus, the system will be attracted, after some transient, to a subset in the phase space called attractor. Furthermore, we will focus on discrete deterministic dynamical systems, given that the major approach in HRV literature focuses on studying how the current RR interval, RRi, determines the next one, RRi+1.
Nonlinear stochastic systems can be viewed as a combination of deterministic systems and stochastic models. There is a low use of nonlinear stochastic models in HRV due to the success in the application of a particular type of stochastic processes to the RR series: fractal models. In Sect. 5.3, we give a brief overview of the main theoretical concepts of fractal models. The reader interested in the application of nonlinear stochastic processes to time series analysis is referred to [1].

5.2 Chaotic Nonlinear Statistics
5.2.1 Nonlinearity Tests
Before studying a system using nonlinear analysis techniques, we must check that the data shows some degree of nonlinearity.
The main idea for testing for nonlinearity is the following. A statistic μ quantifying some nonlinear feature of the data is computed. Does the value found for μ (μdata) suggest nonlinearity or can we explain this value with a simpler hypothesis? E.g., a comparable linear model (this is usually the null hypothesis to test against). If we know the distribution of μ for a linear process, we can test if μdata gives enough evidence for assuming a nonlinear model. However, we do not usually know the distribution of μ under the null hypothesis. The preferred approach in the literature is estimating this distribution by using an ensemble of surrogate data [2, 3].
This ensemble is generated in such a way that each realization shares the linear properties of the original time series. For a two-sided test and a level of signiﬁcance α, 2K/α − 1 surrogates are usually generated (K is an integer, K ≥ 1, controlling the ﬁnal number of surrogates). Under the null hypothesis, there are 2K/α samples following the same distribution. Thus, each of this samples has a probability of α/2 of yielding one of the smallest K values of μ, and a probability of α/2 of yielding one of the largest values of μ. The null hypothesis is then rejected when the observed time series yields either one of the K smallest or largest values. For a one-sided test, only K/α − 1 surrogates are needed, and we reject the null hypothesis when the time series yields one of the K smallest/largest value of μ (depending on the particular hypothesis).

5.2 Chaotic Nonlinear Statistics

71

5.2.2 Phase Space Reconstruction

When observing a highly complex system (such as the HR modulation system), typically we are only able to measure a few of the dynamical variables governing the evolution of the system. In the case of HRV analysis, we usually only measure the RR intervals instead of the (unknown) set of state variables. We need a mechanism to derive the state space from the RR intervals. This problem receives the name of phase space reconstruction, and it is formally solved by using the embedding theorem [4, 5]. This theorem states that a phase space can be reconstructed from the single measured discrete series xi by using the vectors:

xi = xi, xi+τ , ..., xi+(m−1)·τ ,

(5.1)

where m and τ will be referred to as the embedding dimension and the time-lag parameter. The vectors xi constructed using Eq. 5.1 will be denominated Takens’ vectors.
Great effort has been made to clarify under which circumstances Eq. 5.1 leads to proper phase space reconstruction. This is guaranteed if m is larger than twice the dimension of the true phase space [1, 6]. However, the true embedding dimension of the attractor is usually unknown in practical applications. The most widely used method for selecting the embedding dimension is based on the concept of false neighbour. Let us suppose that we have built a state space reconstruction using an embedding dimension m and a time lag τ (proper time lag selection will be exposed below). Given a speciﬁc vector xi, we shall denote its nearest neighbor in the phase space by xinn. If xinn is a true neighbor of xi, then it should have arrived to a neighborhood of xi through the dynamical rules of the system. On the other hand, if xinn is a false neighbor, then it may have arrived to a neighborhood of xi because during the phase space reconstruction process we have projected the d-dimensional attractor into an m-dimensional space, d > m. If we have false neighbors in a given reconstruction, by increasing the dimension of the reconstructed phase space, we should decrease the number of false neighbors. When we reach the real dimension, only the real neighbors should remain in the neighborhood of the point, while false neighbors should disappear. Henceforth, increasing the size of the reconstructed space should not decrease the number of neighbors. Thus, the key idea behind the most widely used algorithms for selecting a proper phase space dimension is searching for the minimum dimension in which most of the false neighbors have been eliminated. RHRV implements one of the best-known algorithm based on false neighbors [7] (see Sect. 5.4.2).
Selecting a proper time lag parameter τ is also important when embedding the vectors in an m-dimensional phase space. If τ is small compared to the time scale that the system needs to manifest noticeable changes, successive elements of the phase space will be highly correlated. Thus, they will tend to cluster around the diagonal of Rm. On the other hand, if τ is too large, the phase space elements will be independent; thus, the resulting embedding will tend to spread in Rm. The ﬁrst zero in

72

5 Nonlinear and Fractal Analysis

the autocorrelation function of the signal is often selected as a compromise between these extreme situations. The ﬁrst minimum or the 1/e value of the autocorrelation function is also used as selection criterion for τ .
This procedure is sometimes criticized because the selection of τ relies on a linear statistic (the autocorrelation), and thus, it does not take into account the nonlinear correlations of the process. Fraser et al. suggested the use of the average mutual information (AMI) between the time series and a delayed version of itself for selecting the time lag parameter [8]. The AMI function, AMI[τ ], quantiﬁes the amount of knowledge gained about the value of xi+k when observing xi by studying the probability distribution of (xi, xi+τ ). The ﬁrst minimum or the ﬁrst 1/e decay of AMI[τ ] is commonly used for selecting the time lag parameter τ . The CalculateTimeLag function of RHRV permits the user to compute a proper time lag using either the autocorrelation function or the average mutual information (see Sect. 5.4.2).
In the next sections, a brief theoretical discussion of the nonlinear deterministic techniques implemented in RHRV is presented. For further details, the interested reader is referred to [1, 6].

5.2.3 Correlation Dimension

Some systems with highly complicated dynamics in time also show its complexity in phase space, generating attractors with complicated geometry: the so-called strange attractors. These attractors are often fractal sets, and they are generated by chaotic systems; i.e., systems that despite being completely deterministic are unpredictable in the long term. This has led researchers to try to characterize the dynamical system by measuring the fractal dimension of its attractor. The fractal dimension is a generalization of the Euclidean dimension (they coincide in nonfractal sets) that measures the auto-similarity of the fractal.
There are several techniques that approximate the concept of fractal dimension: the box-counting dimension, the information dimension, the correlation dimension, the Rényi dimension and the Higuchi dimension. It should be noted that these fractal dimensions are not equivalent to each other. The correlation dimension is the most common measure in the context of dynamical systems [9].
The estimation of the correlation dimension requires the computation of the socalled correlation sum C(r). The correlation sum is deﬁned over the N points from the phase space as follows:

C(r) = 2

NN
Θ(r −

N (N − 1) i=1 j=i+1

xi − xj

∞),

(5.2)

where Θ(·) is the Heaviside step function (which is 0 for negative arguments and 1 for positive arguments), and r is a radius in the phase space. The summation in Eq. 5.2 just counts the pairs of points (xi, xj) whose distance in the phase space is

5.2 Chaotic Nonlinear Statistics

73

smaller than r. Usually, the L∞ norm is selected in practical implementations; this norm computes the distance between two points as the maximum of the absolute value of the differences between the coordinates of the points. In the remainder of the chapter, distances and neighborhoods should be understood under the L∞ metric.
The correlation sum given by Eq. 5.2 is an estimator of the mean probability of two states (at different times) being close. This estimator is biased when the pairs in the sum are not statistically independent, usually because there is some temporal correlation between the Takens’ vectors. This issue is usually solved by using the so-called Theiler window: Two Takens’ vectors must be separated by, at least, the time steps speciﬁed by this window in order to be considered neighbors. By using a Theiler window, we exclude temporally correlated vectors from our estimations.
Fractal attractors are expected to fulﬁl
C(r) ∝ rD,

being D the correlation dimension. Thus, the correlation dimension can be estimated using a log-log regression of C(r) on r.
The correlation dimension of a fractal attractor is an invariant of the dynamical system. Thus, it should not depend on the dimension of the Takens’ vectors employed to estimate it (provided that we are using an embedding dimension large enough to reconstruct the phase space). In practical applications, researchers often plot log(C(r)) versus log(r) using several embedding dimensions. To obtain a reliable estimation of the correlation dimension, there must exist a range of r over which log(C(r)) is linear in log(r) for all embedding dimensions larger than some mmin, being mmin the minimum embedding dimension that permits proper phase space reconstruction.

5.2.4 Generalized Correlation Dimension and Information Dimension
As we have previously stated, the correlation sum C(r) can be interpreted as the mean probability of ﬁnding a neighbor in a ball of radius r surrounding a point in the phase space: C(r) = p(r) . The average operation is necessary since the number of points in a neighborhood of a fractal attractor is not homogeneous. Furthermore, the average time that the system spends in a region of the phase space is not homogeneous either. The Renyi dimension (or generalized dimension) takes into account the frequency with which the different regions are visited. The strength of the weighting is controlled by a numeric value q > 0 (the larger the q, the stronger the importance of the most visited regions). After ﬁxing a nmin Theiler window, the generalized correlation dimension is deﬁned:

74

5 Nonlinear and Fractal Analysis

1

N −nmin

Cq(r) = (N − 2nmin)(N − 2nmin − 1) i=nmin

N

q−1

Θ(r − xi − xj ∞) ,

|j−i|<nmin

which is an estimation of p(r)(q−1) . For small radius, it is assumed that p(r)(q−1) ∝ r(q−1)Dq , which deﬁnes the generalized dimension of order q. An esti-

mation of the generalized dimension of order q is then obtained by ﬁtting a log-log regression of Cq(r) on r(q−1). Note that the correlation sum presented in the previous section is just a particular case of the generalized dimension when q = 2. The case

q = 1 leads to the information dimension. The information dimension D1 can be

deﬁned as:

D1

=

lim
r→0

log p(r) . log(r)

(5.3)

Since log p(r) is the average Shannon information needed to specify a point in phase with precision r, the information dimension speciﬁes how the average Shannon information scales with the radius r.
In order to estimate D1 in practical applications, a different approach than the one suggested by Eq. 5.3 is used. Instead of exploring the scaling behavior of log p(r) when r changes, the scaling behavior of the average radius r(p) that contains a given portion of the total points in the phase space (a “ﬁxed-mass” p) is explored:

D1

=

lim
p→0

log p log r(p)

,

an estimate of D1 is usually obtained by performing a linear regression of log p on log r .
The considerations discussed in Sect. 5.2.3 for obtaining a reliable correlation dimension estimate are also valid for the generalized dimension and the information dimension. That is, we should compute Cq(r) (or log r(p) for information dimension estimates) for several m starting at a reasonable embedding dimension. Only if a clear scaling regions are found for all embedding dimensions larger than some mmin, we can be conﬁdent about the estimations.

5.2.5 Kolmogorov-Sinai Entropy
In 1948, C. Shannon introduced the concept of information entropy to measure the average amount of information present in a message. Intuitively, high entropy means that each character provides new information, whereas low entropy implies that new characters repeat something that is already known. The Kolmogorov-Sinai entropy (or KS-entropy) is a generalization of the Shannon entropy that arises when considering an observed time series as a transmitted message. The KS-entropy measures the unpredictability of a time series. The larger the entropy is, the higher the unpre-

5.2 Chaotic Nonlinear Statistics

75

dictability of the system. Note that this is consistent with the intuitive interpretation of the Shannon entropy: If a time series is predictable from the observation of past samples, new values (new characters) will not provide new information.
KS-entropy is not suitable for practical applications since it requires large amounts of data and it is sensitive to the presence of noise. The approximate entropy [10] and the (closely related) sample entropy [11] methods were developed to overcome the limitations of the KS-entropy when working with real data. Although RHRV implements both algorithms, the approximate entropy method is now deprecated, and thus, we will focus on the sample entropy. The sample entropy of order order q can be computed by using correlation sums of order q. We ﬁrst deﬁne the function:

hq(m, r) = log

Cq(m, r) Cq(m + 1, r)

,

(5.4)

where m is the embedding dimension and q the order of the correlation sum. For sufﬁciently large m, hq(m, r) should converge toward a constant Hq, which is deﬁned as the sample entropy of order q. If sample entropy is properly estimated, the hq(m, r) function should be approximately constant for all embedding dimensions larger than
some mmin in some range of r.

5.2.6 Maximal Lyapunov Exponent

The best well-known characteristic of a chaotic system is its sensitivity to initial

conditions. This means that any two trajectories starting out very close to each other

will separate exponentially fast in time. This sensitivity to initial conditions is usually

quantiﬁed as:

δ(t) ≈ δ(0) · exp(λt),

(5.5)

where δ(0) is the initial distance between two close points in phase space (thus,

we assume that δ(0) is small), δ(t) is their distance at time t, and λ is the average

divergence rate of close trajectories in the system. λ is called the maximal Lyapunov

exponent.

From Eq. 5.5,

λt ≈ log δ(t)/δ(0) .

(5.6)

Thus, to estimate the Lyapunov exponent of a system, a linear regression of S(t) = log δ(t)/δ(0) on t is usually performed. In practical applications, one should check for the existence of a linear region when representing S(t) against t. If for some temporal range this plot shows a linear behavior, its slope is an estimate of the maximal Lyapunov exponent per unit of time. If such a region does not exist, the estimation should be discarded.
Under some general restrictions, the Lyapunov exponent becomes a well-deﬁned invariant quantity of the dynamical system [1]. Thus, just like for the generalized

76

5 Nonlinear and Fractal Analysis

dimension estimates, the maximal Lyapunov exponent should be computed for several embedding dimensions in order to check that it does not depend on the embedding dimension and that the quantity is, indeed, invariant.

5.2.7 Recurrence Quantiﬁcation Analysis (RQA)

The recurrence quantiﬁcation analysis (RQA) quantiﬁes the number and duration of the recurrences in the phase space. A recurrence is the return of the trajectory in phase space to a neighborhood of a region that was visited before. RQA requires the computation of the recurrence matrix:

Mi,j(r) = Θ(r − xi − xj ∞),

where xi and xj are the phase space vectors, r is a small radius that deﬁnes the size of the neighborhood, and Θ(·) is the Heaviside function. Thus, if a point (i, j) is marked

as recurrent, this means that the state of the system at time i has some similarity with

the state of the system at time j. The degree of similarity is measured through the

radius r.

The graphical representation of the recurrence matrix is usually referred to as

recurrence plot (RP). The appearance of a RP provides evidence about the dynamical

properties of the system. For example, a homogeneous RP indicates stationarity.

Furthermore, if the RP is homogeneous in a small block of the plot, a stationary

behavior can be assumed for the corresponding time period.

Vertical and horizontal lines indicate a time segment in which a state does not

change or changes very slowly. Diagonal lines occur when a segment of a trajectory

visits the same region of the phase space at different times. Therefore, parallel and

perpendicular lines to the main diagonal are a strong sign of periodicity or deter-

minism. For periodic or almost-periodic signals, the distance between parallel lines

corresponds to the period.

The presence of white bands in the RP is usually due to abrupt changes in the

dynamics that lead to rare events. This is a strong sign of nonstationarity. Rare events

and strong ﬂuctuations may also appear as single isolated points in the RPs.

To quantify the presence of these visual patterns in RPs, Zbilut et al. proposed

the use of some simple statistics that can be extracted from the recurrence matrix

[12]. The characterization of the recurrence matrix through these statistics is what

receives the name of recurrence quantiﬁcation analysis (RQA).

The simplest measure that can be extracted from the recurrence matrix is the

recurrence rate REC:

REC

=

1 N2

N

Mi,j (r ),

i,j=1

5.2 Chaotic Nonlinear Statistics

77

where N is the number of points on the phase space trajectory. The recurrence rate is a measure of the density of the recurrent points in the RP. RQA is usually applied to sparse recurrence matrices, and therefore, the recurrence rate must be kept low (e.g., from 0.1 to 2.0%).
The recurrence rate can also be computed separately for each diagonal parallel to the main diagonal of the recurrence matrix at a given distance τ . The resulting statistic is referred to as the t-recurrence rate:

RECt

=

N

1 −

t

N −t i=1

Mi,i+t (r).

The t-recurrence rate may be interpreted as the probability that a state returns to its neighborhood after τ steps.
The trend statistic is an useful RQA measure based on the t-recurrence rate. The trend is a linear regression coefﬁcient obtained when considering a linear relation between RECt and t:

TREND =

N˜ t=1

(t

−

N˜ /2)(RECt −

N˜ t=1

(t

−

N˜ /2)2

RECt

)

,

where RECt is the mean RECT value and N˜ deﬁnes the maximal number of diagonals parallel to the main diagonal which will be used for computing the trend. The trend provides information about the stationarity of the process. In a stationary system, the recurrent points are homogeneously distributed across the RP. Hence, the trend will be near zero.
Weakly correlated processes, with stochastic or chaotic dynamics, generate RPs with small diagonal lines and isolated recurrent points, whereas deterministic processes usually generate longer diagonal lines. Thus, the ratio of recurrence points that form diagonals to all the recurrent points is a good measure of determinism. Thus, the determinism parameter is deﬁned as:

DET =

N l=lmin
N i,j=1

l · P(l) Mi,j (r )

,

where P(l) is the number of diagonal segments of length l. The diagonal segments must have a minimum length lmin, otherwise they are excluded.
Another statistic related to diagonal lines is the ratio, deﬁned as the ratio between DET and REC. The ratio has proved useful for detecting transitions between physiological states [13]. During transitions, the number of recurrent points usually decreases, whereas the proportion of points in diagonal lines is less affected. Hence, the ratio increases during dynamical transitions.
A diagonal line with length l implies that a segment of a trajectory is close to another segment (occurring at a different time) during l time steps. Thus, the length

78

5 Nonlinear and Fractal Analysis

of the diagonal lines depends on the rate of divergence of close trajectories in phase space. The average diagonal line length

L=

N l=lmin

l

·

P(l)

N l=lmin

P(l)

may be interpreted as the mean time that two segments of the trajectory are closed

to each other.

Other RQA measures related with diagonal lines are the length of the longest

diagonal

line

Lmax ,

and

its

inverse,

the

divergence

DI V

=

. 1
Lmax

Since

the

lengths

of

the diagonal lines are related to the divergence time of close trajectories, Lmax and

DIV are related to the maximal Lyapunov exponent. DIV scales proportionally with

the maximal Lyapunov exponent, whereas Lmax scales inversely. The Shannon entropy of the probability p(l) to ﬁnd a diagonal line of length l,

N
ENTR = − p(l) log p(l),
l=lmin

is a measure of the signal’s complexity. A large entropy is typical of chaotic systems, whereas a low entropy indicates either a periodic signal (since all its diagonal lines are long) or a uncorrelated noise (all its diagonal lines are small).
It is possible to deﬁne analogous statistics to quantify the presence of vertical lines. The ratio between the recurrent points forming vertical lines and the entire set of recurrent points is called laminarity:

LAM =

N v=vmin
N i,j=1

v · P(v) Mi,j (r )

.

The average length of the vertical lines is referred to as the trapping time:

TT =

v N
v=vmin
N v=vmin

· P(v) P(v)

,

and it is related with the mean time that the system spends trapped in some state. Finally, the length of the longest vertical line, Vmax may be interpreted as the
maximum time that the system spends trapped in a state. Table 5.1 summarizes the interpretation of most of the RQA statistics previously
discussed, and the name that received in RHRV (see Sect. 5.4.7). For a more detailed revision of the RQA, the interested reader may consult [12, 14].

5.2 Chaotic Nonlinear Statistics

79

Table 5.1 Most important RQA statistics

Statistic

RHRV name

Recurrence

REC

Determinism

DET

Ratio

RATIO

Laminarity

LAM

Longest diagonal Lmax line

Divergence

DIV

Averaged diagonal Lmean and

line length

LmeanWithoutMain

Trapping time

Vmean

Longest line
Entropy

vertical Vmax ENTR

t-recurrence Rate recurrenceRate

Trend

TREND

Interpretation
Percentage of recurrent points in a recurrence plot
Percentage of recurrent points that form diagonal lines. The presence of long diagonal lines is a sign of determinism
Ratio between DET and REC. That is, the ratio between the number of recurrent points in diagonal lines and the total number of points of the recurrence matrix
Percentage of recurrent points that form vertical lines. A large value of laminarity indicates the existence of laminar states, in which the system is trapped for some time
Length of the longest diagonal line. This quantity inversely scales with the maximal Lyapunov exponent.
Inverse of Lmax. This quantity scales with the maximal Lyapunov exponent, and thus, it measures the rate of divergence of the system
Mean length of the diagonal lines. This quantity is related to the mean time that two close states in the phase space need to diverge. Lmean takes into account the main diagonal, whereas LmeanWithoutMain does not.
Average length of the vertical lines. This quantity is related with the mean time that the system spends trapped in some state
Longest vertical line, which is the maximum time that the system spends trapped in a state.
Shannon entropy of the diagonal line lengths distribution
Percentage of recurrent points in a diagonal line separated τ steps from the main diagonal line
Trend of the number of recurrent points depending on the distance to the main diagonal

5.2.8 Poincaré Plot
The Poincaré plot is a graphical representation of the dependence between successive RR intervals obtained by plotting the RRj+τ as a function of RRj, being τ a positive integer. This dependence is often quantiﬁed by ﬁtting an ellipse to the plot, which results in two parameters characterizing the ellipse: SD1 and SD2. SD1 is usually calculated as the standard deviation of the points perpendicular to the line of identity, and SD2 is calculated as the standard deviation along the line of identity. Although

80

5 Nonlinear and Fractal Analysis

Poincaré plots have its origin in nonlinear theory, Brennan et al. demonstrated that

SD1 and SD2 are incapable of identifying the nonlinear beat-to-beat structure [15]. Indeed, for τ = 1, it can be demonstrated that SD1 and SD2 can be related to linear

time-domain measures [15]:

SD12

=

1 SDSD2, 2

(5.7)

SD22

=

2

·

SDNN 2

−

1 SDSD2 2

(5.8)

Thus, SD1 characterizes short-term variability, whereas SD2 characterizes longterm variability.

5.3 An Overview of Fractal Dynamics

Fractal time series model some fundamental features present in RR intervals: self-

afﬁnity, power law scaling, and scale invariance. Small segments of self-afﬁne objects

when enlarged (with different scaling factors in each direction) are statistically similar

to larger pieces, as illustrated in Fig. 5.1. As a consequence of this scale invariance,

when measuring a quantity Q that depends on the scale s, self-afﬁne objects manifest

a remarkable property: Q does not converge to a single value, but instead it exhibits

a power law scaling relationship:

Q ∝ sH ,

(5.9)

and thus, Q depends on the scale of measurement (this property is discussed in the

ﬁrst Mandelbrot’s paper about fractals [16]). As a consequence of Eq. 5.9, scale

invariance emerges: The ratio of two estimates at different scales only depends on

the ratio of the scales

Q(s1) Q(s2)

=

s1

H
.

s2

Eke et al. proposed a dichotomous model in which physiological signals are seen as realizations of one of two temporal processes: fractional Brownian motion (fBm) and fractional Gaussian noise(fGn) [17]. The self-afﬁnity and the appearance of both fBm and fGn are controlled by a single parameter, the Hurst exponent 0 < H < 1. fBmsignals are nonstationary. A fBm-signal with a H close to 1 describes a smooth signal, whereas a fBm-signal with H close to 0 describes a rough signal. The increments of a nonstationary fBm yield a stationary fGn. Thus, we can transform a fBm-signal in a fGn-signal by differencing, and we can transform a fGn-signal in a fBm-signal by cumulative summation. The H exponent of a fGn can be easily interpreted:

5.3 An Overview of Fractal Dynamics

RR time series

0

13107

26214

39321

52428

81
65535

RR interval 450 909 1368

0

3276

6553

9829

13106

16383

RR interval 708 1038 1368

0

819

1638

2457

3276

4095

RR interval 708 917 1126

Time
Fig. 5.1 Self-afﬁnity of a simulated RR series following a fractional brownian motion
• If H < 1/2, the process is anti-correlated (negatively correlated). • If H = 1/2, the process is uncorrelated (white noise). The cumulative summation
of white noise yields Brownian motion (fBm with H = 1/2). • If H > 1/2, the process is positively correlated.
The next sections provide a brief overview of the most important tools for estimating the Hurst exponent, included in RHRV. Note that the Hurst exponent is between 0 and 1 regardless of the model. Thus, to avoid possible mistakes, when reporting values of H, the class of the signal should always be speciﬁed (as HfBm or Hf Gn) [17].
Note that this section focuses on monofractal models. However, there exist evidence supporting the application of multifractal models to HRV [18, 19].

5.3.1 Detrended Fluctuation Analysis

Due to its self-afﬁne nature, the standard deviation of a fBm-signal in a window of size n, σn, fulﬁls the power law:

E[σn] ∝ nH .

(5.10)

82

5 Nonlinear and Fractal Analysis

Based on Eq. 5.10, Mandelbrot introduced a Hurst estimation technique, named scaled windowed variance analysis (SWV) [20]. Peng et al. further developed SWV to improve the analysis of nonstationary data [21]. This method is now referred to as detrended ﬂuctuation analysis (DFA). The DFA algorithm proceeds as follows:
1. The signal to be analyzed x is summed (the mean is substracted to avoid obtaining a monotonic signal):
i
yi = xk − μ.
k=1
The resulting time series y is usually referred to as the proﬁle. 2. The proﬁle is divided into nonoverlapping segments of length n. Then, the local
trend yi,n in each of the segments is estimated using least-square regression. 3. The average ﬂuctuation of the data relative to the local trend is computed:

Fn =

1 N

N
(yj − yj,n)2

j=1

4. Repeat steps 1–3 for different window sizes to obtain the so-called ﬂuctuation function Fn.
5. If the data is self-afﬁne Fn ∝ nα, and the scaling exponent α is estimated using regression.
The estimated scaling exponent, αˆ , can be used for discriminating the signal nature. If αˆ < 1, then the signal is fGn and αˆ = Hˆ f Gn, whereas if αˆ > 1, the signal is fBm with αˆ = Hˆ fBm + 1. If αˆ ≈ 1, there is uncertainty about the nature of the signal.

5.3.2 Power Spectral Density Analysis

The power spectrum of a fractal signal fulﬁls the power law relationship S(ω) = Cω−β ,

(5.11)

where β is the spectral index. Signals with this type of power spectrum are referred to as 1/f noises. 1/f noises with −1 < β < 1 and 1 < β < 3 can be approximated by
fGn and fBm-signals, respectively [17]. From Eq. 5.11, it is clear that we may estimate β using regression. The high
frequency part of the spectrum is usually discarded before ﬁtting the regression line,
since in practical applications the power law behavior holds only for frequencies close to zero [22]. The resulting estimation, βˆ, can be used for discriminating the signal class. If βˆ < 1, then the signal is a fGn, whereas if βˆ > 1, the signal is a fBm.

5.3 An Overview of Fractal Dynamics

83

If βˆ ≈ 1, there is uncertainty about the nature of the signal. Once the signal has been classiﬁed, we may obtain the Hurst exponent using

βˆ = 2Hˆ fBm + 1 or βˆ = 2Hˆ f Gn − 1.

5.4 Chaotic Nonlinear Analysis with RHRV
To illustrate the nonlinear and fractal analysis techniques introduced in Sects. 5.2 and 5.3, we shall study two segments of a recording from a patient suffering from obstructive sleep apnea (OSA). Obstructive sleep apnea is a sleep disorder characterized by breathing cessation during the nocturnal rest. As a consequence of breathing interruption, the patient’s sleep can be severely disrupted. Apnea patients do not usually remember the breathing cessations, but they feel fatigued and sleepy during daytime. If apnea is not properly treated, it can result in several cardiovascular diseases, such as hypertension, type II diabetes, cardiovascular disease, and stroke [23]. The recording we shall work with is the “a05” ﬁle from the PhysioNet Apnea-ECG database. This database is described in [24], and the recording can be downloaded from [25]. Since this recording contains both apnea and normal-resting episodes, we will focus on two small segments in which the time series looks stationary: a segment in which the patient is suffering from apnea, and another one in which the patient is breathing normally. To extract a subset of the RR time series from a HRVData structure, the ExtractTimeSegment function can be used. There also exist an alias for this function named Window. In addition to the HRVData structure, the ExtractTimeSegment function takes as input parameters:
• starttime and endtime: which indicate the start and end times of the period of interest. ExtractTimeSegment extracts the RR intervals observed between the times starttime and endtime. If the HRVData contains the interpolated HR series, ExtractTimeSegment also returns an interpolated HR series within the interval of interest. However, all analyses of the original HRVData will not be part of the extracted data.
Listing 5.4.1 makes use of the ExtractTimeSegment function to extract the segments of interest from the “a05” recording. Listing 5.4.1 also plots a small detail of the resulting series (see Fig. 5.2). During the apnea episode (top of Fig. 5.2), the RR series exhibits a complex oscillatory pattern in which several frequencies are present. The deterministic nonlinear dynamic is apparent from the deformed wave proﬁle with pointed peaks. These cyclic patterns in HR often appear during prolonged OSA episodes and the resumption of breathing. The blood oxygen desaturation level plays a fundamental role in the mechanism that produces these oscillations [26].

84

5 Nonlinear and Fractal Analysis

Apnea episode

HR (beats/min.)
50 60 70 80

10500

10600

10700

10800

time (sec.)

Normal breathing

10900

11000

70

60

HR (beats/min.)

50

22000

22500

23000

23500

time (sec.)

24000

24500

Fig. 5.2 RR time series while the patient is suffering from obstructive apnea (top) and during normal breathing (bottom)

R listing 5.4.1
hrv.data <- CreateHRVData() hrv.data <- LoadBeatWFDB(hrv.data, RecordName = "a05",
RecordPath = "./sampleData/", annotator = "qrs") hrv.data <- BuildNIHR(hrv.data) hrv.data <- FilterNIHR(hrv.data) hrv.data <- SetVerbose(hrv.data, T) hrv.apn <- ExtractTimeSegment(hrv.data, 10500, 12300) hrv.norm <- ExtractTimeSegment(hrv.data, 22000, 24500) par(mfrow = c(2, 1)) PlotNIHR(hrv.apn, xlim = c(10500, 11000), main = "Apnea episode")
## Plotting non-interpolated instantaneous heart rate ## Number of points: 1976
PlotNIHR(hrv.norm, main = "Normal breathing")
## Plotting non-interpolated instantaneous heart rate ## Number of points: 2640
While during long periods of OSA, heart rate shows cyclic oscillations, during normal respiration, heart rate dynamics exhibit a broadband, inverse power law spec-

