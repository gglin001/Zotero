硕士学位论文
题 目: 基于心率变异性的睡眠分期研究

研究生 专业 指导教师

朱彬 电子科学与技术
董林玺 教授

完成日期 2018 年 6 月

杭州电子科技大学硕士学位论文
基于心率变异性的睡眠分期研究
研 究 生：朱彬 指导教师：董林玺 教授
2018 年 6 月

Dissertation Submitted to Hangzhou Dianzi University for the Degree of Master
Sleep stage analysis based on heart rate variability
Candidate: Zhu Bin Supervisor: Prof. Dong Linxi
June，2018

杭 州 电子科技大学 学位论文 原 创性声 明 和 使用 授权说 明

原 创 性声 明  

本 人 郑 重 声 明 ： 所 呈 交 的 学 位 论 文 ， 是 本 人 在 导 师 的 指 导 下 ， 独 立 进 行 研 究 工作 所 取 得  

的 成果 。

除文 中 已 经注 明 引 用 的 内 容外 ，

本论 文 不含 任 何其 他 个 人或 集体 已 经 发表或 撰 写过  

的 作 品 或成 果 。 对 本 文 的 研 宄 做 出 重 要 贡 献 的 个 人 和 集体 ， 均 己在 文 中 以 明 确 方 式 标 明 。  

申 请 学 位 论 文 与 资料 若 有 不 实 之 处 ， 本人 承 担 一 切 相 关 责 任 。  

论

文

作者

签

名

 ：

曰

期

：

年 ６ 月 ｆ 日  

学位 论文使用 授权说 明

本 人 完 全 了 解 杭 州 电 子 科 技 大 学 关 于保 留 和 使 用 学 位 论 文 的 规 定 ， 即 ： 研 究生 在 校攻 读

学 位期 间 论 文工 作 的知 识产权 单位属 杭 州 电 子科技大学 。

本 人保证毕业 离 校后 ，

发 表 论 文 或

使 用 论 文 工 作 成果 时 署 名 单 位 仍 然 为 杭州 电 子 科技 大 学 。 学校 有 权 保 留 送 交 论 文 的 复 印 件 ，  

允许查阅 和借 阅论文 ；

学 校可 以 公布 论 文 的 全部或 部 分 内 容 ，

可以 允许采用 影 印 、

缩 印 或 其

它 复 制 手 段 保 存 论 文 。 （ 保 密 论 文 在 解 密 后遵 守 此 规 定 ）

论文作者签名 ：

＾ 期 年 曰

：

２力 ｒ

丨

５
（ 月 Ｖ 日  

指

导

教师

签名

 ：

Ｓ

期

年 丨 月 怍

杭州电子科技大学硕士学位论文
摘要
睡眠是人体进行机体自我修复的重要环节。良好的睡眠使人精力充沛，糟糕 的睡眠使人萎靡不振，还会诱发疾病。对睡眠质量进行分析可以作为生理健康监 测的手段，睡眠分期又是睡眠质量分析中较为基础的环节。基于心率变异性进行 睡眠分期相较于传统的基于脑电信号进行睡眠分期能够克服受试者传感器佩戴的 束缚、实验费用昂贵等一些局限性，使便携式睡眠监测设备的开发成为可能。本 文使用心率变异性相关指标构建睡眠分期模型。本文主要进行了以下工作：
第一，实验数据获取。本文使用 MIT-BIH 数据库获取相关数据，通过计算选 择合适的数据作为数据源。从实验数据源中提取 RR 间期信号并对其进行样条插值 和重采样，得到时间间隔均匀的 RR 间期信号，同时从实验数据源中提取出睡眠分 期标签。
第二，对心率变异性相关特征进行提取。使用统计方法对时域特征 RR 间期均 值 MEAN、RR 间期标准差 SDNN、相邻 RR 间期差值的均方根 RMSSD 进行提取； 使用小波变换、经验模态分解等方法对频域特征指标 VLF、LF、HF、LF/HF、TP 进行提取；使用混沌和分形方法相结合对非线性指标盒维数进行提取，使用 Wolf 方法对最大李雅普诺夫指数进行提取。将提取得到的 3 类 10 种心率变异性特征组 合为特征向量，对特征向量进行数据预处理操作，并进行 PCA 降维以降低数据冗 余度。
第三，对睡眠分期模型进行建模。建模中使用一对一的多分类支持向量机解 决方案，选取径向基核函数作为支持向量机核函数，同时将遗传算法和网格搜索 算法相结合对超参数进行寻优，将提取出来的时频域以及非线性特征作为特征向 量，使用 SMO 算法训练得到睡眠分期模型。
第四，进行实验验证。首先通过实验选取交叉验证的折数 k 以及遗传算法中 的一些参数项 ga_option 的值。其次使用遗传算法和网格搜索算法相结合对超参数 进行寻优，寻优结果对应的模型最佳准确率为 80.5195%，而单独使用网格搜索算 法进行参数寻优对应的模型最佳准确率为 79.8701%。相比较而言，前者具有更好 的参数寻优结果。然后对支持向量机进行训练，使用训练出来的模型对测试数据 集进行分类预测，并用混淆矩阵对睡眠分期模型的性能进行评估。评估结果显示， 睡眠分期模型在测试集上的平均分类准确率为 63.10%，模型对 NREM 期的 LIGHT、 DEEP 两个阶段的分类准确率较高，可高达 93%，但是对 WAKE 和 REM 两个阶段 的分期效果不是很好。同时设计不包含盒维数、最大李雅普诺夫指数两个非线性 特征的模型作为实验对照组，对其性能进行评估。实验结果显示，不包含非线性
I

杭州电子科技大学硕士学位论文
特征的模型的平均分类准确率为 60.21%，与包含非线性指标的模型准确率 63.10% 相比要低。该结果表明使用盒维数、最大李雅普诺夫指数这两个非线性特征的睡 眠分期模型的分期结果更为理想。 关键词：多分类支持向量机，遗传算法，混沌，分形，盒维数，最大李雅普诺夫 指数
II

杭州电子科技大学硕士学位论文
Abstract
Sleep is an important part of the body's self-repair. Good sleep can make people energetic, improve learning and working efficiency. Bad sleep can cause mental decline, malaise, accidents, even illness. The analysis of sleep quality can be used as a means of physiological health monitoring. Sleep stage classification is a relatively basic link in the analysis of sleep quality. Sleep stage classification based on heart rate variability compared with the traditional sleep stage classification based on EEG signals can overcome the limitations of the wearing of subject's sensor, the high experimental cost and others, making the development of portable sleep monitoring equipment possible. This article uses the relevant indicators of heart rate variability to build a sleep stage classification model, and the main work is as follows:
Firstly, experimental data acquisition. The suitable data is selected as the data source by calculating the relevant data obtained from the MIT-BIH database in this thesis. The RR interval signals are extracted from experimental data sources and spline interpolation and re-sampling are performed to obtain RR interval signals with uniform time intervals. At the same time, sleep staging labels are extracted from experimental data sources.
Secondly, the heart rate variability related features are extracted. Statistical methods are used to extract the time-domain characteristic RR interval mean MEAN, RR interval standard deviation SDNN, and the root mean square RMSSD of the difference between adjacent RR intervals; the wavelet transform, empirical mode decomposition and other methods are used to extracte the frequency-domain characteristics VLF, LF, HF, LF/HF, and TP; chaos and fractal methods are used to extract the nonlinear index box dimensions, and the Wolf method is used to extract the maximum Lyapunov exponent. The three types of the 10 kinds of heart rate variability features were combined into a feature vector, and then the feature vector is preprocessed and PCA dimension was reduced to reduce the data redundancy.
Thirdly, the sleep stage classification model is set up. A one-to-one multi-class support vector machine solution is used in modeling, and a radial basis kernel function is selected as a kernel function of the support vector machine. At the same time, a combination of genetic algorithm and grid search algorithm is used to optimize the hyperparameters. The extracted time-frequency domain and nonlinear features are used
III

杭州电子科技大学硕士学位论文
as a feature vector. The SMO algorithm is used to train the sleep stage classification model.
Fourthly, verify the experiment. First of all , the number of cross-validation k and the value of some parameter items ga_option in the genetic algorithm are selected through experiments. Second, the combination of genetic algorithm and grid search algorithm are used to optimize the hyperparameters, the best accuracy of the model corresponding to the optimization result is 80.5195% while the best accuracy of the model is obtained by using the grid search algorithm is 79.8701%. In comparison, the former has a better parameter optimization result. Then the support vector machine is trained, the trained model is used to classify the test data set, and the performance of the sleep stage classification model is evaluated using the confusion matrix. The evaluation results show that the average classification accuracy rate of the sleep stage classification model on the test set is 63.10%. The model has high classification accuracy which is as high as 93% for the LIGHT and DEEP stages, but it is not very good for two stages of WAKE and REM. At the same time, a model that does not include the two nonlinear features of box dimension and maximum Lyapunov exponent is designed as an experimental control group to evaluate its’ performance. The experimental results show that the average classification accuracy rate of the model that do not include nonlinear features is 60.21%, which is lower than the accuracy rate of the model that contain nonlinear indicators. This result indicates that the classification accuracy of the sleep stage classification model using the two nonlinear features of box dimension and maximum Lyapunov exponent is more ideal.
key words: multi-classification support vector machine，genetic algorithm，chaos， fractal，box dimension，maximum Lyapunov exponent
IV

杭州电子科技大学硕士学位论文
目录
摘 要 ............................................................................................................................... I Abstract ......................................................................................................................... III 目 录 ..............................................................................................................................V 第一章 绪论 .................................................................................................................... 1
1.1 睡眠分期的研究背景和意义 ............................................................................ 1 1.2 国内外研究现状 ................................................................................................ 2
1.2.1 国外研究现状 ......................................................................................... 2 1.2.2 国内研究现状 ......................................................................................... 2 1.3 本文组织结构 .................................................................................................... 3 第二章 实验数据获取 .................................................................................................... 5 2.1 从心电数据库中获取仿真数据 ........................................................................ 5 2.1.1 MIT-BIH 心电数据库介绍 ..................................................................... 5 2.1.2 仿真数据获取 ........................................................................................ 5 2.2 本章小结 ............................................................................................................ 9 第三章 心率变异性特征提取及数据预处理 .............................................................. 10 3.1 心率变异性简介 .............................................................................................. 10 3.2 心率变异性特征提取 ...................................................................................... 12 3.2.1 心率变异性时域指标提取 ................................................................... 13 3.2.2 心率变异性频域指标提取 ................................................................... 14 3.2.3 心率变异性非线性指标提取 ............................................................... 21 3.3 数据预处理 ...................................................................................................... 29 3.3.1 数据清洗 ............................................................................................... 29 3.3.2 数据标准化和归一化 ........................................................................... 29 3.4 数据特征降维 .................................................................................................. 30 3.5 数据集划分 ...................................................................................................... 31 3.6 本章小结 .......................................................................................................... 31 第四章 使用多分类支持向量机进行睡眠分期 .......................................................... 32 4.1 机器学习简介 .................................................................................................. 32 4.2 支持向量机简介 .............................................................................................. 33 4.2.1 线性可分支持向量机 ........................................................................... 33 4.2.2 线性支持向量机 ................................................................................... 35 4.2.3 非线性支持向量机 ............................................................................... 36 4.3 支持向量机中超参数的优化 .......................................................................... 37 4.3.1 支持向量机超参数介绍 ....................................................................... 37 4.3.2 支持向量机超参数寻优 ....................................................................... 38 4.4 支持向量机之 SMO 算法 ............................................................................... 40 4.5 多分类支持向量机 .......................................................................................... 41 4.5.1 一对多方案 ........................................................................................... 42 4.5.2 一对一方案 ........................................................................................... 42
V

杭州电子科技大学硕士学位论文
4.5.3 层次二叉树方案 ................................................................................... 43 4.5.4 有向无环图方案 ................................................................................... 44 4.6 本章小结 .......................................................................................................... 45 第五章 睡眠分期仿真结果分析 .................................................................................. 46 5.1 支持向量机模型中的超参数调优 .................................................................. 46 5.2 多分类支持向量机模型的训练 ...................................................................... 49 5.3 多分类支持向量机性能评估 .......................................................................... 49 5.4 模型性能之间的比对 ...................................................................................... 51 5.5 本章小结 .......................................................................................................... 51 第六章 总结与展望 ...................................................................................................... 53 6.1 本文工作总结 .................................................................................................. 53 6.2 不足与展望 ...................................................................................................... 54 致 谢 ............................................................................................................................ 56 参考文献 ........................................................................................................................ 57 附 录 ............................................................................................................................ 62
VI

杭州电子科技大学硕士学位论文
第一章 绪论
1.1 睡眠分期的研究背景和意义
睡眠是人体进行机体自我修复的过程，良好的睡眠能够促进青少年正常的生 长发育、能够提升成年人学习和工作效率、能够保持老年人机体的稳定性，良好 的睡眠对不同年龄层次的人来说都是身心健康的基础。随着现代生活节奏的加快， 工作压力变大，人们需要一定方式来缓解压力。抽烟酗酒、暴饮暴食、熬夜上网 等都是现在常见的缓解压力的方式，这些方式虽然能够一定程度上缓解人们的压 力，但是同时也打破了人体生理平衡，造成睡眠质量严重下降，导致出现各种疾 病。短期的睡眠质量下降会造成第二天工作学习状态不佳，长期低质量的睡眠会 诱发各种生理疾病，许多事故的发生有很大原因是睡眠问题造成的。因此睡眠质 量[1]的评估不仅能够使人们了解自身的状态，同时对诸如睡眠呼吸暂停综合症[2][3] 等疾病的诊断也具有非常重要的意义。不管是对身体状态的评估还是对一些疾病 的诊断，睡眠质量分析都是非常重要且普遍的手段。对睡眠质量分析来说，睡眠 分期又是其基本环节。
睡眠过程不是一个单一不变的状态，而是一个相对复杂的生理过程[4][5]，睡眠 时相会进行周期性转换。1953 年，N.kleitman 和 Aserinasky 将睡眠简单划分为快 速眼动期（Rapidly Eye Movement，REM）和非快速眼动期（Non-Rapidly Eye Movement，NREM）两个状态[6]，这两种状态的区别在于眼球有没有进行快速转 动。在睡眠期间两种状态不断切换，睡眠周期为 90 分钟。睡眠阶段的两种状态的 简单划分是睡眠研究史上的里程碑，推动了睡眠分期研究的热潮。之后，加州大 学提出了依据脑电、眼电、颏肌电等多路生理信号进行睡眠分期的标准，将睡眠 大致分为 6 个阶段：觉醒期（WAKE）、快速眼动期（REM）和非快速眼动期（NREM） 中的四个状态（S1,S2,S3,S4）[7]。这就是之后建立的睡眠分期的金标准—多导睡眠 监测[8]（polysomnography,PSG）的基础。PSG 主要是依靠人工专家对脑电、眼电、 颏肌电并辅助以心电等多路生理信号进行解读，将睡眠分为六个阶段，每一个睡 眠阶段对应的时间页面为 30 秒。虽然这种睡眠分期方法是国际上对睡眠分期的金 标准，但是仍然具有相当多的局限性：受试者身上需要绑缚多路传感器进行生理 数据信息的采集，此情况下受试者的束缚感比较强烈，会使监测得到的数据具有 一定的偏差，不能较为准确的反应受试者在无约束条件下的睡眠情况；该方法极 度依赖专业人员对传感器设备的连接和专家对睡眠相关数据解读的经验水平，专 家对睡眠分期具有较多的解读经验则结果比较可信，否则不然；使用 PSG 方法进 行睡眠分期需要在专用实验室环境条件中进行，实验室采集设备费用比较昂贵，
1

杭州电子科技大学硕士学位论文
而且花费大量人力时间得到的结果却不一定十分可靠。在研究后期学者希望构建 一套计算机专家系统，使用计算机来替代专家进行睡眠分期工作。专家系统能够 对睡眠相关生理数据进行自动解读，自动分期，用以替代经验丰富的专家，对睡 眠的各个阶段实现较为准确的分类。专家系统涉及到两个方面：对睡眠相关生理 数据信息的特征提取和对睡眠各个阶段的模式识别。目前主流的睡眠分期模型是 基于脑电信号[9-11]的，因为脑电信号在睡眠的时候不受主观因素的干扰，能够更加 客观的反映出睡眠各个阶段具有的特性。鉴于使用 PSG 方法在进行睡眠分期时传 感器设备对受试者的束缚、连接人员的专业性、专家的经验、费用等方面的局限 性，使用其他生理信号譬如心电信号[12][13]对睡眠进行分期也成为目前进行睡眠分 期的研究方向。相关研究表明睡眠和自主神经系统调节之间具有密切关系，而且 心率变异性也和自主神经系统调节之间具有密切联系，这为使用心率变异性特征 进行睡眠分期提供了相关依据。使用心电信号进行睡眠分期的效果虽然不如使用 PSG 方法进行睡眠分期的效果好，但是对受试者采集数据的便携性、无束缚性以 及费用等方面综合考虑，该方案也较为合理。本文使用心率变异性信号相关特征 来进行睡眠分期模型的构建。
1.2 国内外研究现状 1.2.1 国外研究现状
MouradAdnan[14] 等 提 取 心 率 变 异 性 特 征 ， 采 用 支 持 向 量 机 方 法 ， 对 SLEEP-WAKE 进行分类，得 78.5％的准确度。
Gih Sung Chung[15]等基于呼吸信号对睡眠进行分期，结果表明 REM 与呼吸频 率之间具有较高的相关性。
Frideh Ebrahimi[16]等用离散小波变换和离散傅里叶分析提取心率变异性特征， 结果表明离散傅里叶分析对 REM 提取 α 波可用于识别 REM。
Emad Malaekah[17]等提取眼电信号的时域和频域特征，使用人工神经网络进行 分类，得到的灵敏度为 84.6％。
M.O.Mendez[18]等基于时域自回归模型对特征进行提取并使用马尔科夫模型， 对心率变异性进行分析得到三个时相总时长监测准确度为 72％。
L.Tarassenk 和 S.Roberts 最先将人工神经网络用于睡眠分期模型的构建，之后 出现大量使用神经网络模型[19-21]以及支持向量机[22][23]、马尔科夫模型[24][25]、贝叶 斯网络[26][27]等不同机器学习模对睡眠分期模型进行构建的研究方法。
1.2.2 国内研究现状
高群霞[28]等使用能量特征与最小二乘支持向量机结合的方法对脑电信号进行 睡眠分期，准确率达到 89.6%。
2

杭州电子科技大学硕士学位论文
唐其彪[29]基于脑电信号的能量特征、模糊熵等使用支持向量机进行睡眠自动 分期，得到的结果为 91.4%。
贾花萍[30]等使用神经网络对睡眠进行自动分期，其创新点是将脑电信号的近 似熵作为特征提取出来构建特征向量，同时提出使用 AR 谱对脑电信号进行特征提 取，使用 Bagging 算法进行优化，得到了比较好的睡眠分期效果。
张泾周[31]等使用神经网络作为睡眠分期模型，其使用的神经网络模型是两层 反向传播神经网络，使用了改进的 BP 算法对模型中的参数进行训练。在特征提取 方面，该团队使用脑电信号的复杂度作为输入特征向量，同时将具有脑电信号复 杂度特征的模型的性能和不具有脑电信号复杂度特征的模型的性能作比对，结果 显示使用了脑电信号复杂度特征的模型对睡眠分期来说具有更加好的效果，准确 率能够达到 97.62%。
江朝晖[32]等使用了马尔科夫模型来进行系统构建，经过测试,W 期、REM 期 和 S2 期的正确识别率分别为 92%,100%和 94%。
宁艳[33]等对心电、脑电等相关生理信号使用去趋势波动分析方法提取睡眠相 关特征指标。实验结果表明使用去趋势波动分析提取的心电和脑电特征构建出的 睡眠分期模型具有比较好的分类性能。
郑慧君[34]等人研制出微动敏感式睡眠监护床垫系统，将睡眠分期系统实现了 产品落地。该床垫系统能够采集受试者的呼吸、体动、心率等参数作为特征，进 而构建睡眠分期模型。
1.3 本文组织结构
本文主要是从心率变异性信号中提取出时域、频域和非线性特征构成特征向 量作为支持向量机的输入，使用多分类支持向量机对睡眠进行自动分期。
第一章主要叙述睡眠分期的研究背景、意义和国内外研究现状。对睡眠分期 课题研究的必要性给出了依据，对国内外睡眠分期的研究现状进行综述，最后给 出本文的组织架构。
第二章主要介绍实验数据的获取。由于实验室条件限制，需要依托数据库中 数据来进行实验仿真建模。对国际上主流心电数据库进行简单介绍，同时对本文 使用的 MIT-BIH 数据库进行详细介绍。对 MIT-BIH 数据库中的数据进行分析处理， 选取合适的实验数据源，并将 RR 间期序列进行时间均匀化处理，得到心率变异性 时域信号和相关睡眠标签。
第三章主要进行心率变异性的特征提取以及数据预处理。首先对心率变异性 以及其对应的时频域、非线性特征指标进行简单介绍，接着分别对心率变异性的 时域、频域以及非线性特征指标使用相关方法进行提取。然后将提取出来的特征 进行数据预处理，处理其中的异常数据并将数据进行标准化等操作，方便作为特
3

杭州电子科技大学硕士学位论文
征向量输入到支持向量机模型进行训练。同时进行了数据降维以及将数据集划分 为训练集和测试集。
第四章主要研究了支持向量机的基本理论。首先简要叙述了机器学习，接着 对支持向量机这种机器学习模型进行介绍，从线性可分支持向量机、线性支持向 量机、非线性支持向量机进行逐级过渡介绍。其次研究了支持向量机中超参数的 寻优算法：搜索算法和群体智能算法。接着对支持向量机的模型训练的 SMO 算法 进行研究。最后对多分类支持向量机中的几种多分类方案进行了叙述说明。
第五章主要是进行了实验验证。对 k 折交叉验证中的 k 值和遗传算法中相关 参数进行选取确定，使用遗传算法和网格遍历搜索算法对超参数进行寻优，比对 了联合算法和单一网格遍历搜索算法进行参数寻优的优劣。使用第三章提取的特 征向量对多分类支持向量机模型进行训练，并对训练出来的多分类支持向量机睡 眠分期模型进行性能评估。同时对比了是否包含非线性特征盒维数和最大李雅普 诺夫指数的不同模型之间的性能差异，结果表明非线性特征的提取确实有助于睡 眠分期模型的分类准确率的提升。
第六章为总结和展望。对本文进行了全面总结：简要概述了本文所做的工作， 对本文建立的模型需要改进的地方进行了分析讨论，同时对该研究问题的未来进 行了展望。
4

杭州电子科技大学硕士学位论文
第二章 实验数据获取
2.1 从心电数据库中获取仿真数据
由于实验室条件的限制，无法通过实验获得受试者的心电信号以及睡眠分期 的结果。本文通过使用心电数据库中的心电信号相关数据对睡眠分期模型进行构 建。目前国际上公认的心电数据库主要有如下几种：
（1）美国麻省理工学院提供的 MIT-BIH 心电数据库； （2）美国心脏协会提供的 AHA 心电数据库； （3）欧洲 ST-T 心电数据库。 心电数据库中主要记录的是受试者的心电信号（ECG）以及对心电信号的注 释。这些注释是由专家对心电信号进行解读得到的相关信息，具有一定权威性。 本文使用美国麻省理工学院提供的 MIT-BIH 心电数据库中的相关数据对睡眠分期 模型进行构建。
2.1.1 MIT-BIH 心电数据库介绍
MIT-BIH 心电数据库是由麻省理工学院提供的心电信号相关数据库。该数据 库不仅提供了受试者的心电信号，同时也提供了受试者的多导睡眠监测的相关数 据信息。MIT-BIH 心电数据库中的心电信号以及相关的睡眠分期注释可以作为构 建睡眠分期模型的数据来源。
MIT-BIH 数据库[35-41]中总共记录了 18 个受试者的相关数据。每一例受试者相 关数据使用三类文件格式进行存储：.h 格式的头文件；.data 格式的信号数据记录 文件；.atr 格式的相关注释文件。其中.h 头文件记录的是受试者的相关信息以及心 电信号的采样率等信息，在所有样例中心电信号的采样率为 250Hz。.data 文件是 受试者在睡眠阶段心电信号的记录。在注释文件中有.ecg 后缀格式的心电注释文件 和.st 格式的睡眠注释文件：.ecg 注释文件记录的是 ECG 心电信号中 R 峰所在的位 置；st 注释文件记录的是睡眠分期的注释以及睡眠中一些情况如睡眠呼吸、体动等。
2.1.2 仿真数据获取
本文基于心率变异性相关特征构建睡眠分期模型，需要得到心率变异性信号 和相关睡眠分期注释标签。使用.ecg 心电信号注释文件获得 R 峰所在的位置，并 用该信息计算得到 RR 间期序列，可以获得心率变异性 HRV 信号的时域表达形式。 使用.st 睡眠注释文件得到相关睡眠分期标签信息。本文使用 matlab 平台上相应的 工具包 WFDB for matlab 对 MIT-BIH 心电数据库中的数据进行获取，得到的数据 在 matlab 中以元胞数组的形式存在。
5

杭州电子科技大学硕士学位论文

在.st 睡眠注释文件中专家对睡眠分期的注释是字符串形式的，而且在注释文

件中不仅有睡眠分期的注释，还有其他相关睡眠情况注释。我们研究的是睡眠分

期问题，需要在 matlab 平台上编写脚本程序对.st 睡眠注释文件进行睡眠分期信息

的分割提取同时将字符串形式的睡眠分期信息转化为数据标签形式。

通过对MIT-BIH心电数据库中的18例记录计算发现一些数据记录存在一定问

题：受试者心电数据记录.data文件中数据表示为数组形式，数组的长度使用length

（data）表示，头文件.h中已经注明心电数据的采样率为250Hz，通过计算可以得

到心电数据的时间长度为（length（data）/250）秒。.st睡眠相关注释文件睡眠分期

是对每一个30秒睡眠页面进行分析的，使用matlab脚本程序将该文件转换为一个数

值型的睡眠标签向量，这个向量的长度使用length（st）表示，依据30秒时间间隔，

对应的心电数据的时间长度是（length（st）*30）秒。（length（data）/250）和（length

（st）*30）两者均表示采集到的心电信号时间长度，理论上两者的值应该是相同

的，但是通过对18个测试者实例相关数据的计算发现并非所有实例对应的两个时

间值都相同。这两个值的不同表明记录的数据存在一定问题，具体情况数据库并

未提供说明。谨慎起见，这种情况对应的实例将不会作为本文中模型使用的数据。

经过对18个实例的时间长度的计算，发现有7组数据出现时间长度不匹配的情况，

将这7组数据进行剔除，最终使用slp01a，slp01b，slp02a，slp02b，slp03，slp04，

slp32，slp41，slp48，slp60，slp67x这11例数据作为本文的实验数据源。

在matlab平台上编写脚本程序从.st睡眠注释文件中得到受试者睡眠相关注释

信息，将注释信息中的睡眠分期信息进行提取并进行数值转换得到数值类型的睡

眠分期标签，其中将WAKE期标记为-1，REM期标记为0，NREM期中的S1和S2合

并为LIGHT期标记为1，NREM期中的S3和S4合并为DEEP期标记为3。表2.1对11

例数据睡眠标签进行了统计，表2.2为受试者不同睡眠分期比例，图2.1展示了受试

者slp67x的相关睡眠标签。

slp01a slp01b slp02a slp02b slp03 slp04 slp32 slp41 slp48 slp60 slp67x

表2.1 11例数据相关睡眠标签统计

WAKE

REM

LIGHT

DEEP

Total

8

13

106

113

240

180

25

155

0

360

52

77

224

7

360

108

29

133

0

270

151

74

417

78

720

162

23

502

33

720

394

0

186

60

640

229

90

448

13

780

214

31

513

2

760

286

31

393

0

710

72

0

81

1

154

6

slp01a slp01b slp02a slp02b slp03 slp04 slp32 slp41 slp48 slp60 slp67x Average

杭州电子科技大学硕士学位论文

表 2.2 受试者不同睡眠分期比例

WAKE

REM

LIGHT

0.03

0.05

0.44

0.50

0.07

0.43

0.14

0.21

0.62

0.40

0.11

0.49

0.21

0.10

0.58

0.23

0.03

0.70

0.62

0.00

0.29

0.29

0.12

0.57

0.28

0.04

0.68

0.40

0.04

0.55

0.47

0.00

0.53

0.32

0.07

0.55

DEEP 0.47 0.00 0.02 0.00 0.11 0.05 0.09 0.02 0.00 0.00 0.00 0.05

图2.1 睡眠标签示意图 同时需要编写matlab脚本程序对.ecg心电注释文件进行读取，将相关信息进行 转换，得到R峰所在位置。将两个相邻注释记录的时间进行差分计算得到等心拍（非 等时间间隔）RR间期序列，如图2.2所示：

图2.2 未经插值和重采样的RR间期序列
7

杭州电子科技大学硕士学位论文
便于后期对心率变异性指标进行提取，需要使用插值拟合将等心跳拍数/非等 时间间隔RR间期序列转换为等时间间隔RR间期序列，常见的插值拟合方法有线性 插值、拉格朗日插值、牛顿差值、样条插值等。心率变异性信号是具有一定随机 性的离散序列，对非等时间间隔RR间期离散信号进行插值时不考虑线性插值，方 便起见，使用matlab平台自带的样条插值函数对非等时间间隔RR间期序列进行插 值。插值之后得到等时间间隔RR间期序列，对等时间间隔RR间期序列进行重采样， 信号进行重采样的采样频率为2.5Hz。经过插值和重采样后等时间间隔RR间期序列 的时域信号如图2.3所示。
图2.3 插值和重采样后RR间期序列 数据库中实验仿真数据获取流程图如图2.4所示：
MIT-BIH数据库
MATLAB平台脚本程序
.st文件中获取睡眠标签
时间长度匹配计算
筛选出合适的实例作为数据源
MATLAB平台脚本程序
.ecg文件中提取R峰位 置
相邻记录进行差分计算
等心拍/非等时间间隔RR间期序列
样条插值拟合，2.5Hz重采样
等时间间隔RR间期序列
图2.4 实验仿真数据获取流程图
8

杭州电子科技大学硕士学位论文
2.2 本章小结
本章针对实验室实验条件的限制问题，使用数据库获取实验仿真数据。对国 际上主流心电数据库进行介绍并着重介绍本文使用的 MIT-BIH 数据库，同时对相 关数据库中的数据进行分析筛选，选取合适数据作为本文中实验数据源。将 RR 间 期序列进行时间均匀化处理，得到心率变异性时域信号以及睡眠分期相关标签。
9

杭州电子科技大学硕士学位论文
第三章 心率变异性特征提取及数据预处理
3.1 心率变异性简介
心率变异性 HRV（heart rate variability）[42][43]是两次相邻的心脏搏动周期之间 的微小差异。心率变异性反映了神经系统对心脏的调节能力，是评价自主神经调 节功能的重要指标。同时研究表明睡眠和自主神经调节功能之间具有密切关系， 这为使用心率变异性相关指标进行睡眠分期提供了相关依据。通常使用时域方法、 频域方法和非线性方法对心率变异性进行分析。
心率变异性时域分析方法是对 RR 间期时域信号使用统计学指标进行描述分 析，或者是使用统计图表的方式对心率变异性相关信息进行统计展示。常见心率 变异性时域统计学指标有：5minRR 间期均值 MEAN、RR 间期标准差 SDNN、相 邻 RR 间期差值均方根 RMSSD、相邻 RR 间期差值大于 50ms 的百分数 pNN50 等。
心率变异性频域分析方法是对 RR 间期信号进行时频转换，使用时频变换公式 将时域信号转换为对应时间段内信号的频域能量分布状况，得到信号频域的相关 信息。通常使用的时频变换方法有短时/加窗傅里叶变换、小波变换、希尔伯特黄 变换等。心率变异性的频域指标是 RR 间期信号在相应时间段内的不同频段的能量 分布情况。按照生理意义，将心率变异性功率谱的频段粗略分为三个部分：极低 频段 VLF（0.003~0.04Hz）、低频段 LF（0.04~0.15Hz）和高频段 HF（0.15~0.40Hz）。 LF/HF 表示低频段能量和高频段能量的比值，TP 表示 VLF、LF、HF 三个频段能 量的总和。
心率变异性的时域和频域分析方法对原始 RR 间期信号进行线性分析，反映心 率变异性总体变化情况，不能揭示瞬时心率变化情况。心率变异性非线性分析[44-46] 能够对瞬时心率进行解读，反映瞬时的心率变化，得到更多关于心率变异性的信 息，但是相较于线性方法更加复杂。自从 80 年代中期以来，心率变异性的非线性 分析得到了广泛发展，混沌和分形相结合对非线性系统进行分析逐渐成为了研究 趋势。心率变异性这种非线性信号可以使用混沌相关理论进行研究，混沌是对非 线性系统进行研究的有力工具。混沌总体上看是无序的，但是其却是确定性非线 性动力系统，只不过系统对初始状态极度敏感而表现出类似随机的现象。非线性 动力系统的混沌性可以通过一些相关指标进行表示，这些指标可以是定性指标也 可以是定量指标。混沌系统的分析主要是分析混沌信号在时频域的相关特征，观 察时频域上混沌信号的功率谱，相图等用以和其他非混沌的确定性状态进行区分。 分形[47][48]和混沌[49][50]联系是十分紧密的，分形同样是对非线性信号进行分析的有
10

杭州电子科技大学硕士学位论文
力工具，将非线性非平稳的心率变异性信号看做分形。分形对应的信号从整体上 看是非平稳的随机信号，没有什么规则可言，但是从某些局部细节看，信号的规 则性又是相同的。分形的一个性质是从局部到整体的自相似性：其中规则分形是 局部与整体在总体上具有自相似性，这种分形常见于雪花等规则迭代图形；不规 则的分形也具有自相似性，不规则的分形的自相似性表现在统计意义上。单看局 部和整体没什么自相似性，但是将局部进行统计分析，可以得到局部和整体之间 的统计自相似性。在现实世界中，更加常见的是统计意义上的自相似分形。分形 具有如下性质：1）分形在任意尺度上都能够有精细的结构；2）分形是很不规则 的，很难使用欧式几何空间对其进行描述度量；3）分形在局部和整体上具有自相 似性，自相似性可以表现为规则的自相似性和统计意义上的自相似性，在现实世 界中更加常见的是统计意义上的自相似性，这种分形表现为不规则性；4）分形的 自相似豪斯多夫维数一般大于对应的拓扑维数；5）分形有着简单的递归定义，分 形基于自相似性具有递归定义。对心率变异性这种非规则的分形，常常使用分形 维数作为分形的指标来对分形的进行解析。分形维数是对分形占据空间维度的一 种度量特征指标，反映了分形占据空间的复杂度，同时也说明了分形自身的复杂 度。混沌系统通常使用的定量指标有混沌信号的相关熵指标、信号分形维数、李 雅普诺夫指数等。
心率变异性分析方法如图 3.1 所示：
心率变异性分析

时域分析

频域分析

非线性分析

统

统

计

计

指

图

标

表

表

展

征

示

加

希

窗 傅 里 叶 变

小 波 变 换

尔 伯 特 黄 变

换

换

混

分

沌

形

图 3.1 心率变异性分析方法

心率变异性常用指标如图 3.2 所示：

11

杭州电子科技大学硕士学位论文
心率变异性指标

时域指标

频域指标

非线性指标

MEAN SDNN RMSSD TP VLF LF HF LF/HF

分形 李亚普诺 维数 夫指数

图 3.2 心率变异性指标
3.2 心率变异性特征提取
3.1 节中对心率变异性的分析方法、时频域指标和一些非线性指标进行了简单 介绍。下面对心率变异性的各项指标进行提取，用以构建心率变异性的特征向量。 使用 MIT-BIH 数据库中的 11 例数据作为数据源对心率变异性的特征指标进行计算 提取。心率变异性分析依据时间长短可以分为长程分析和短程分析，长程分析中 心率信号的时间长度大于 24 小时。由于长程分析中时间长度的限制，通常对心率 变异性进行短程分析。在短程分析中，选择合适的时间长短十分关键。选取的时 间比较短得到的相关指标不能对心率变异情况有比较好的说明。通过调研发现， 可以选取 5 分钟的心率信号对应的指标作为心率变异性的短程指标。睡眠分期标 签对应的时间页面是 30 秒，需要使用 30 秒时间段内心率变异性的相关指标作为 相应特征。但是相关特征对应的短程指标时间选取 5 分钟，这里需要使用 5 分钟 的心率变异性时域指标去替代 30 秒睡眠页面对应的心率变异性时域指标。对心率 变异性特征的提取的步骤如下：
（1）将原始数据源中得到的 RR 间期序列进行插值并重采样，得到等时间间 隔的 RR 间期序列；
（2）将等时间间隔的 RR 间期序列进行时间片段切分，切分的时间间隔为 30 秒；
（3）对每一个 30 秒时间段进行循环操作： a）以这 30 秒时间段为首，在其后对信号进行 4 分 30 秒的延伸，构建出以
这 30 秒时间段为首的 5 分钟 RR 间期信号，使用这 5 分钟 RR 间期信号对应的 心率变异性时域指标去替代 30 秒睡眠页面内的心率变异性的相关时域指标；
b）使用 30 秒时间段进行频域转换，得到 30 秒睡眠页面内的频域指标；

12

杭州电子科技大学硕士学位论文
c）使用 30 秒时间段进行非线性分析，得到 30 秒睡眠页面内的非线性指标。 心率变异性特征提取框图如图 3.3 所示：
等时间间隔 RR间期序列

30S等间隔时间切 片的RR间期序列

以30S时间为首向 后延伸构建5MIN 等间隔时间切片
的RR间期序列

计算每一个 30S频域指标

计算每一个30S 非线性指标

计算每一个5MIN 的时域指标用以 替代每一个其前 端30S时域指标

图 3.3 心率变异性特征提取框图

3.2.1 心率变异性时域指标提取

本文中使用的心率变异性时域指标为 RR 间期均值 MEAN、RR 间期标准差

SDNN、相邻 RR 间期差值的均方根 RMSSD，时域指标对应的计算公式如公式(3.1)、

(3.2)、(3.3)所示：

 MEAN



1 n

n i1

RRi

(3.1)

 SDNN 

1 n 1

n i 1

(RRi



MEAN )2

(3.2)

 RMSSD 

1 n 1

n i2

(RRi



RRi 1 )2

(3.3)

其中 RRi 为对应时间段内第 i 个 RR 间期，n 为对应时间段内 RR 间期个数。统 计学中，均值和方差、标准差能够反应一个统计样本中最基本的信息。心率变异
性的均值 MEAN 反映了相关时间段内的平均心率；RR 间期标准差 SDNN 反映了 相关时间段内各个心拍 RRi 和平均心拍 MEAN 之间的差异；相邻 RR 间期差值的 均方根 RMSSD 则反映了相关时间段内相邻心拍 RRi 和 RRi-1 之间的变异程度的均 值。这三个统计学指标都能一定程度反映心率变异性的信息。上述特征提取步骤
在 MATLAB 中编写脚本程序求得相应的时域特征并如图 3.4、3.5、3.6 所示。

13

杭州电子科技大学硕士学位论文
图 3.4 心率变异性时域指标 MEAN
图 3.5 心率变异性时域指标 SDNN
图 3.6 心率变异性时域指标 RMSSD
3.2.2 心率变异性频域指标提取
在本文中心率变异性的频域指标为各个频段能量分布情况，分别表示为 VLF、 LF、HF、LF/HF、TP。本文使用小波变换和经验模态分解对信号频谱进行构建。 下面分别介绍小波变换和经验模态分解。
14

杭州电子科技大学硕士学位论文

3.2.2.1 小波变换进行频域分析

在介绍小波变换[51]之前，首先要介绍傅里叶变换。傅里叶变换在整个信号时

间域上对能量有限信号进行分解，将其表示为不同频率的正弦三角波线性叠加的

和形式。

连续信号 f(t)的傅里叶变换：



 F( jw)  f t   e jtdt

(3.4)



连续信号 f(t)的傅里叶逆变换：

 f t 

1


F ( j)  e jtd

2 

(3.5)

离散信号 x(n)的傅里叶变换：



 X (e j )  x(n)  e jn

(3.6)

n

离散信号 x(n)的傅里叶逆变换：

 x(n)  1 X (e j )  e jnd
2 2

(3.7)

通常情况下信号为时域采样的离散信号，如果采样率足够高，可将信号看作

为连续信号。傅里叶变换的局限性在于只能使用三角波作为基函数对信号进行分

解，而且傅里叶变换只能够对信号在整个时间轴上进行分解，傅里叶变换只能得

到频域上的信息，不能够将信号的时域信息和频域信息联合得到时频信息。将原

始信号使用时间窗进行分割，对该时间窗内的信号做傅里叶变换，得到的就是这

个时间窗内的频域信息，获得信号的时频表示。这种方法称作短时/加窗傅里叶变

换，能够在一定程度上对信号进行时频分析。假设 f (t) 为被分析的连续时间信号，

时间窗函数为 g(t) ，时间窗函数的共轭为 g(t) 。则连续时间信号 f (t) 的短时傅里叶

变换可以表示为：



 STFT (t,)  ( f ( )  g(  t))  e j d

(3.8)



在 t 时刻进行短时傅里叶变换的步骤如下：

（1）将时间窗 g( ) 进行 t 时间的平移，平移后的表达式为 g(  t) ；

（2）将平移后的时间窗的共轭和信号做乘积，利用时间窗函数取出对应时间 段内的信号；

（3）将取出的对应时间段内的信号做傅里叶变换。

15

杭州电子科技大学硕士学位论文
原始信号f(t)
时间窗函数g(t) 使用时间窗函数对原始 信号进行时间窗分割得
到对应时间段的信号
将该时间段内的信号做傅里叶变换 对应时间段
的频谱
图 3.7 短时/加窗傅里叶变换
信号时频变换概念的一般化是使用一系列基函数组成的集合对某个指定时间 段内的信号进行扫描，将基函数集合中的各个基函数分别和该时间段上的信号做 内积运算，计算得到的结果叫做系数，系数的个数是基函数集合中基函数的个数。 这些系数以及各个基函数对应的频率就构建出指定时间段内信号的频谱。系数是 内积运算的结果，内积运算表示两个向量之间的关系，内积运算得到的系数越大 表明在指定时间段内原始信号和该频率对应的基函数之间相关性越大，原始信号 在该时间区域内和这个基函数越相似。但是短时/加窗傅里叶变换的缺陷在于变换 使用的基函数是一成不变的，只能是三角波类型的基函数。短时傅里叶变换只能 使用一组三角波基函数的集合去扫描各个时间段的原始信号，得到原始信号的时 频谱。试想，假如使用不同类型基函数构建的集合在各个时间段去扫描原始信号， 和原始信号做内积运算，相应得到的频谱也会是不一样的，得到不同尺度下原始 信号的信息。在指定时间段内基函数的形状和原始信号的形状越相似，两者之间 的关联就越大，相应信号之间内积运算的结果就会越大。这样看来扫描基函数集 合的选取对变换的影响是非常大的。如果原始信号在某个时间点处发生了阶跃， 由于三角波和阶跃信号的相似性很低，该处的阶跃信号进行傅里叶变换时就需要 使用大量的三角波去拟合，而且拟合得到的效果比较差。如果选取合适的小波基 函数时，选取的小波基函数和该处阶跃信号非常形状非常相近，那么只需要有限 个小波基函数去拟合该阶跃，使得对应时间段内的频谱系数稀疏化。
信号的主要信息集中于信号的低频包络部分，而细节储存于高频部分。小波 变换就是将原始信号分解为包含主要信息的低频近似部分和包含细节分量的高频 部分，根据需要将低频近似部分再进行分解直到满足分解停止条件为止。对信号 进行 N 层小波分解的最终结果是将原始信号分解为一个第 N 层的低频近似部分和 N 个高频细节部分，在这 N 个高频细节部分中又当属第一层的高频细节部分对应 的频率最高。小波分解的示意图如图 3.8 所示：
16

杭州电子科技大学硕士学位论文

S

CA1

CD1

CA2

CD2

CA3

CD3

图 3.8 小波分解示意图
上述就是关于信号时频变换的演进史，从傅里叶变换到短时/加窗傅里叶变换， 再到之后的小波变换，实现了获取信号单一频率信息到获取信号时频联合信息的 转换。小波变换的效果源于对小波基的选取，小波基选取合适，就能够使用一系 列小波函数及其对应的系数将原始信号拟合的非常好。小波变换的实质就是对原 始信号进行特征频率分解，得到各个特征频率分量的线性组合，可以将这些小波 基进行线性组合重构出原始信号来检验小波分解的好坏。基于小波分解的本质是 对信号进行特征分解，可以将小波变换应用到许多问题中如机械故障检测，ECG 心电信号中 R 峰提取等。
3.2.2.2 经验模态分解进行频域分析 小波变换首先要对小波基进行人工选取，之后将原始信号使用小波基进行分
解，小波基函数选取的好坏是小波分解质量好坏的关键。小波基选取的好，将小 波分解的各频率组件进行信号重构后得到的信号和原始信号之间的差异很小；小 波基选取不好，小波分解的各频率组件重构后的信号和原始信号之间的差异就会 比较大。小波变换是一种非自适应性变换，小波变换的非自适应性指的是原始信 号需要去适应小波基函数而并非是基函数去适应需要进行分解的原始信号。对于 小波变换的非自适应性，NASA 的黄锷院士提出了经验模态分解[52]法。经验模态 分解法是将原始信号根据经验自适应的分解为一系列各个尺度下的本征模态函数 与残余分量的和的形式。下面对本征模态函数和经验模态分解进行介绍：
本征模态函数是原始信号固有的一种特征属性，这种属性表明了原始信号的 内在振动模式。本征模态函数具有单一的频率分量，其任意一点的瞬时频率都是 有物理意义的。黄锷院士提出关于本征模态函数必须满足两个条件：
（1）本征模态函数在其对应的时间范围内，过零点和局部极值点的数目是相 等的或者两者的个数最多相差一个；
（2）在本征模态函数上，局部最大值对应的上包络线和局部最小值对应的下 包络线之间的均值必须为零。

17

杭州电子科技大学硕士学位论文
条件（1）类似于传统的平稳正态高斯信号窄带的条件；条件（2）是黄锷院 士提出的创新，他将传统的全局要求改变为局部限制，使得本征信号的波形是局 部对称的。黄院士的研究表明，这种局部对称的要求来替代全局对称的要求是符 合系统物理意义的。本征模态信号的每一个振动周期只有一个固有的振动模态， 没有其它模态。
本征模态函数仅仅具有单一的频率模态，而现实中的信号是非平稳非线性信 号，这种信号蕴藏着非常丰富的频率信息，通常使用经验模态分解将信号自适应 分解为一系列不同尺度的本征模态函数与剩余分量的和的形式。经验模态分解相 较于小波分解的优势在于其是一种自适应分解，分解得到的每一个频率组件是一 个本征模态函数，更加具有实际的物理意义，分解情况更好。使用经验模态分解 的步骤如下：
（1）将待分解的原始信号的所有极大值找出来，在极大值之间使用三次样条 插值对原始信号的上包络线进行拟合；
（2）将待分解的原始信号的所有极小值找出来，在极小值之间使用三次样条 插值对原始信号的下包络线进行拟合；
（3）原始信号存在于拟合出来的上包络线和下包络线之间，将原始信号的上 下包络线进行相应平均信号的求取；
（4）将原始信号和相应平均信号相减得到信号 h； （5）对信号 h 进行分析，如果信号 h 满足本征模态函数的条件，则该信号就 是原始信号对应的第一个本征模态函数； （6）如果信号 h 并不满足本征模态信号的条件，则将该信号作为更新后的原 始信号重复上述步骤直到得到满足条件的本征模态函数； （7）对原始信号进行更新，将原始信号减去第一个本征模态函数作为原始信 号的更新，重复上述步骤得到各个不同尺度的本征模态函数分量； （8）根据分解停止条件，得到关于原始信号的各个尺度下本征模态函数分量 和剩余分量。

3.2.2.3 频域指标提取

本文在 matlab 中使用小波变换工具箱中 wavelets tool 对原始信号进行分解，

由于进行重采样的 RR 间期等间隔时间序列采样率为 2.5Hz，使用 db4 小波对该信

号进行 10 层分解，得到各个频率的基函数对应的系数，小波分解示意图如图 3.9

所示。将频率依照 VLF、LF、HF 进行分段，将各个频段中的小波系数进行相加，

得到对应频段的小波系数 X。则该频段对应的功率为：

P 1 X2

(3.9)

2

18

杭州电子科技大学硕士学位论文
分别计算出各个频段对应的功率 VLF、LF、HF，再使用计算得到的 VLF、LF、 HF 计算出 LF/HF，TP。上述的频域指标计算过程是针对 30 秒睡眠页面时间段的， 在整个睡眠时间段内进行 30 秒睡眠时间页面对应频域指标的循环计算,得到心率 变异性频域指标如图 3.10、3.11、3.12、3.13、3.14 所示。
图 3.9 小波分解示意图 图中 s 是原始信号，a10 是第 10 层的低频近似分量，di(i=1,2,…,10)为第 i 层的 高频细节分量，其中当属第 1 层的高频细节分量 d1 的频率最高。原始信号 s 可以 使用 a10 和其他高频细节分量 di(i=1,2,…,10)进行重构。
19

杭州电子科技大学硕士学位论文
图 3.10 心率变异性频域指标 VLF 图 3.11 心率变异性频域指标 LF 图 3.12 心率变异性频域指标 HF
20

杭州电子科技大学硕士学位论文
图 3.13 心率变异性频域指标 LF/HF
图 3.14 心率变异性频域指标 TP
3.2.3 心率变异性非线性指标提取
本文中使用盒维数、最大李亚普诺夫指数作为心率变异性的非线性指标。下 面先进行非线性分析方法—混沌理论和分形理论的介绍，再对非线性指标进行提 取。 3.2.3.1 分形理论和混沌理论
心率变异性是一种非线性非平稳的时间序列，对这种非线性信号使用时频域 分析进行信息提取得到的特征并不能够完全反映时间序列的信息。使用混沌理论 和分形理论相结合的非线性分析方法对非线性时间序列进行特征提取，使用提取
21

杭州电子科技大学硕士学位论文
出来的特征信息对非线性时间序列进行描述。首先对分形理论和混沌理论进行介 绍。
分形理论是关于空间几何学的研究。在现实世界中，有很多规则的几何图形， 但更加常见的是不规则的形状。对这些不规则的形状使用传统的欧几里德几何空 间去研究具有非常大的局限性，使用整数维数去度量不规则的几何图形意义不大， 只有使用分数维数去度量才能对不规则的几何图形进行比较准确的描述。分形这 种不规则几何图形的生成在数学上是一个不断迭代的过程，这个迭代过程指代分 形的自相似性。分形看上去是不规则的几何图形，但不规则中其实也蕴含着规则： 分形局部和整体之间具有自相似性。这种自相似性表现在完全意义的自相似性和 统计意义上的自相似性。完全自相似性指的是分形的局部和整体是完全自相似的， 局部进行不断迭代生成整体，这种分形常见于规则的几何图形如雪花等；统计意 义上的自相似性指的是局部和整体看上去没有相似性，但是对局部进行统计之后 和整体进行分析对比之后相似性就得到了体现，这种分形在现实中表现为不规则 图形如生物生理信号等。分形具有如下性质：
（1）分形结构的自相似性：局部和整体具有自相似性； （2）分形的标度不变性：在分形上任意选取一个局部进行缩放，缩放的结果 和原来局部图形保持一致，标度不变性又称作伸缩对称性。 对分形这种不规则几何图形进行表征的指标是分形维数，分形维数是对分形 在几何空间中占据的维数大小的一种度量，这种度量的维数通常是分数形式而非 整数形式。有多种分形维数对分形进行表征，常见的分形维数有自相似分形维数、 盒维数、点态维数和关联维数等。 混沌理论的研究对象是确定性的非线性动力系统。这种非线性动力系统实质 上是确定的，但是由于该动力系统十分依赖初始条件，初始条件的不同会产生不 同的结果。对初始条件极度敏感使得确定性系统的输出在不同初始条件下是不可 预测的，表现出结果的随机性。但是这种随机性又不是真正意义上的随机，是位 于混沌吸引子中的随机，是一种具有统计意义的随机。混沌理论在 20 世纪 60 年 代之后得到了逐步完善，Lorenz 在建立三阶微分方程组模型对天气进行预报的时 候发现，当对模型给予不同的初始值，模型的输出也会呈现出极大的差异，表现 出一种随机性，但是这种随机性又是位于特定空间中的，这个特定空间就是其提 出的 Lorenz 吸引子。1975 年，美籍华人学者李天岩和美国数学家 Yorke 在期刊上 发表了一篇振动学术界的论文，对混沌给出了数学定义。虽然目前对混沌并没有 公认的定义，各个领域对混沌有各自的理解，但是对混沌的一些性质具有共同的 见解：
22

杭州电子科技大学硕士学位论文
（1）内在随机性：混沌信号看起来是随机信号，但是不同于随机信号。混沌 系统是确定性动力系统。不需要附加任何因素，系统仍然会表现出类似随机性的 行为；
（2）分形性质：混沌吸引子是分形，分形具有自相似性。这种自相似性表现 为局部和整体在统计意义上的自相似性；
（3）初始值敏感性：对不同的初始值，混沌系统表现为输出的不可预测性。 使用混沌理论和分形理论对非线性时间序列进行非线性分析，一些非线性特 征指标能够比较好的展示非线性时间序列的信息。常见的非线性指标有分形维数、 关联维数、李雅普诺夫指数等。

3.2.3.2 非线性特征提取

本文对非线性时间序列这种分形的盒维数[53][54]进行提取。分形的盒维数又称

作计盒维数，是在实际中使用最广泛的一种分形维数。盒维数使用的广泛性是因

为其计算和经验估计相对于其他分形维数的计算更加简单。盒维数具有不同的名

称：Kolmogorov 熵、熵维度、度量维数等。假设 F 是欧式空间 Rn 中的一个有界的 子集， N (F) 是直径最大为 δ，可以覆盖 F 的集的最少个数，则 F 的下、上盒维数 分别定义为：

lim DimBF 

 0

log N (F)  log

(3.10)

lim DimBF 

log N (F)

 0  log

(3.11)

如果下、上盒维数对应的值相等，就把这个共同的值称作是 F 的盒维数，记

为：

lim DimBF 

 0

log N (F)  log

(3.12)

在实际应用中，对于覆盖 F 的集的最少个数 N (F) 可以进行不同的选取，可

取下列 5 个数中的任意一个：

（1）大于 F 长度的半径为 δ 的最小闭球的数目；

（2）大于 F 长度的边长为 δ 的最少立方体的数目；

（3）和 F 相交的 δ-网状立方体的数目；

（4）大于 F 长度的直径最大是 δ 的集的最少数目；

（5）球心在集 F 上，半径为 δ 的互不相交的球的最多数目。

本文基于盒维数的非线性特征指标提取结果如图 3.15 所示：

23

杭州电子科技大学硕士学位论文

图 3.15 非线性指标-盒维数

非线性系统通常以时间序列的形式呈现，仅对时间序列进行分析不能够得到

对应的动力系统的完整信息，需要将非线性时间序列进行相空间重构[55-57]来得到

更加多关于非线性系统的信息。相空间是用来表示动力系统所有可能状态的空间，

动力系统中每一个状态都对应于相空间中的一个点，代表了系统该状态下的位置

以及动量，所以相空间中各个维度表征的是动力系统的位置以及动量。相空间重

构时使用非线性时间序列重新构建奇异吸引子，用以对非线性系统进行拟合。相

空间重构的基本思想是：非线性系统中任意一个维度分量的演化都和其他维度分

量有关，相关维度分量的信息蕴含在任意一个维度分量的发展过程之中，可以根

据非线性系统的一个观察量来重新构建出动力系统模型，对动力系统进行表征。

这里非线性时间序列就是系统的其中一个观察量，可以由此重构相空间。一个混

沌系统产生的轨迹经过一段时间的状态变化，最终会趋于在规则的轨迹中运动，

这个规则的轨迹就是系统的混沌吸引子。将相空间混沌吸引子经过拉伸和折叠变

换后展现出来的时间序列的特征是混乱复杂的。Packard 提出使用延迟坐标法来重

构相空间，延迟坐标法构建相空间的基本原理是将无限长的时间序列{xi} （i=1,2,…,n）进行不同时间因子 τ 上的平移，一个时刻进行 m 次平移，构建出一

个 m 维相空间，这个相空间可以使用矩阵形式进行表示：

 x(1) x(1 ) ... x(1 (m 1) ) 

 

x(2)

x(2  )

...

x(2



(m

1)

)

 

 ...

... ...

... 

 

x(

p)

x( p  )

...

x( p  (m 1) )

(3.13)

其中 τ 为延时因子，m 为需要构建的相空间的维度，p 满足条件 p  (m 1)  n ，

n 为时间序列的数据点数。Takens 在前人研究基础之上给出了相空间的嵌入维数的

数学证明，这个就是 Takens 定理。非线性动力系统是由非线性差分方程：

xn1  f (xn ) 表示的离散系统或者是由微分方程
dx(t)  f (x(t)) dt

(3.14) (3.15)

24

杭州电子科技大学硕士学位论文

表示的连续系统。依据 Takens 定理，观察到的时间序列{xi}依据延迟坐标法构建 m 维相空间，只需要满足 m  2d 1，非线性动力系统的几何结构完全被打开，d 是

非线性系统中的分形维数，时移因子 τ 为正整数。条件 m  2d 1是非线性动力系

统相空间重构的充分但是不必要条件，相空间的维数 m 称为重构的嵌入维数。重

构相空间中状态的演化反映了未知的非线性动态系统的状态的演化，并且相空间

中分形吸引子的几何特征和原始非线性动力系统中的几何特征是等价的，这就表

示原始非线性动力系统中的任何拓扑或者是微分不变量都可以转化到重构相空间

中进行计算。在相空间 Rm 中分别以 L2 范数和 L 范数定义两个状态（相空间中两个

点） x j 和 xi 之间的欧氏距离：

m1

 x i

 xj

2



(xil  x jl )2

l 0

(3.16)

x i

 xj



 max 0l m1

xil

 x jl

(3.17)

在不特别说明的情况下，将相空间 Rm 中的 L 范数记为  ，使用 L 范数计算 距离比较快。根据上述的重构相空间理论可知，使用非线性时间序列进行相空间

重构时需要确定合适的延迟时间 τ 和合适的嵌入维数 m，下面就对相空间重构中的

时移因子 τ 和嵌入维数 m 的选取进行介绍。

由 Takens 定理可知在没有噪声的无限长精确数据的情况下，可以选择任意的

延时因子 τ。但是实际情况是观察到的时间序列是有限的，而且观察到的时间序列

都带有一定的噪声干扰。因此在重构相空间时，延时因子 τ 的选取十分重要。一般

是根据经验来选取时移因子 τ，基本思想是使相隔时移因子 τ 的两个状态 x j 和 xj 之间具有一定程度的独立性但是两者之间又不是完全无关的，这样使得它们在重

构相空间时能够作为两个独立坐标进行处理。如果时移因子 τ 选取太小，那么两个

状态之间的值就非常接近，甚至不能够区分出这两个状态，不能提供两个相对独

立的坐标，导致分形吸引子的重构相空间非常接近于相空间中的对角线；如果时

移因子过大，两个相邻状态之间就会出现不相关的情形，分形吸引子的轨迹就会

投影在两个正交的不相关方向上，使重构的分形不能够真实反映系统在相空间中

的演化轨迹。对时移因子 τ 需要进行适合的选取来比较好的重构出原始动力系统对 应的相空间中的分形吸引子。目前对时移因子 τ[58][59]的选取的方法有很多，有高阶

关联法、重构展开法、平均互信息法、自相关函数法等方法。从便于计算的角度

看，最常见的方法是平均互信息法和自相关函数法。自相关函数法是比较简单的

搜寻时移因子 τ 的一种方法，但是这种方法仅仅对时间序列中的线性关系进行提取，

对非线性关系的提取具有局限性。如若需要对非线性关系进行提取，需要使用自

相关函数的推广—复自相关函数法进行计算。鉴于本文是对一维时间序列进行分

25

杭州电子科技大学硕士学位论文

析，直接使用自相关函数法对延时因子 τ 进行选择。对一维时间序列{xi（} i=1,2,…,n）

的自相关函数 C（τ）构建如下：

 C( ) 

1

n

( xi



x )( xi



x )

n  i1 s

s

(3.18)

其中 xi 是时间序列中的某个时刻的值， x 是时间序列的均值，s 是时间序列的

标准差：

 s 

1 n 1

n i 1

( xi



x )2

(3.19)

从前述可知，时移因子 τ 越小，则两个状态量之间的关联性就越大。同时自相

关函数 C（τ）越大，则说明两个相邻状态之间越相似。需要对于 C（τ）和 τ 之间

进行权衡来选择合适的值。通常依据经验，当自相关函数 C（τ）下降到（1-1/e）

时的 τ 为比较理想的时移因子。

对延迟时间的选择如图 3.16 所示：

图 3.16 各个睡眠页面对应的延迟时间 对于嵌入维数[60]，Takens 等已经从理论上证明了当混沌吸引子的分形维数为 d 时，可构建一个 m≥2d+1 维度的相空间。如果仅就是计算混沌吸引子分形的关联维 数，研究证明了对无限长的无噪声的时间序列，取嵌入维数 m 大于关联维数 d 的 最小整数就可以了，但是对有限长的带有噪声干扰的时间序列，嵌入维数 m 就比 关联维数 d 大很多。如果嵌入维数 m 选取的过小，会使得分形吸引子在某些地方 发生自相交，发生折叠现象。在一个小邻域内可能会有来自吸引子各个部分的点 相重叠；如果 m 选取过大，会大大增加吸引子分形的几何不变量的计算工作量， 同时会引入噪声和误差。计算嵌入维数的方法有很多，常见的有最大特征值不变 法、几何不变量法、虚假邻点法、最小香浓熵法等。本文使用几何不变量中的关 联维数来计算最小嵌入维数，使用 G-P 算法对关联维数进行计算。G-P 算法的主要 步骤如下： （1）对时间序列{xi}（i=1,2,…,n）先赋予一个比较小的数值 m 来重构一个相 空间。相空间中有 p 个 m 维向量 Xi：
26

杭州电子科技大学硕士学位论文
Xi  (xi , xi ,..., xi(m1) )  Rm, i [1,p];p=n-(m-1)

(3.20)

其中 i 表示的是时间序列的第 i 个时刻，m 是相空间维数，τ 是延迟时间因子，n

是时间序列长度，p 是构建出来的相空间中的向量的个数；

（2）进行关联积分的计算：

 C(R) 

1 p2

p i 1

p
H(R 
j 1

Xi  X j

)

(3.21)

其中 Xi  X j 是在重构的 m 维相空间中两个向量之间的 L∞距离，R 为一个阈值， 也称作相空间中的超球半径。这个阈值用于度量相空间中两个向量之间的距离。

当相空间中两个向量之间的距离小于阈值 R，表明这两个相空间中的向量是相关的；

当距离大于阈值 R 时，表明相空间中两个向量是不相关的。H () 是 Heavside 函数：

H

(

z)



1,  0,

z<0 z0

(3.22)

该函数是一个指示函数，当两个向量是关联向量时函数指示为 1，否则指示为 0。

关联积分实质上就是对两个向量是否相关进行统计，计算相空间中重构的关联向

量总的占比；

（3）当阈值 R 在合适的取值范围内，非线性系统吸引子的维数 d 和关联积分

函数 C(R)满足对数线性关系：

d (m)  ln C(R) ln(R)

(3.23)

用这个拟合式求出对应于较小的嵌入维数 m 对应的关联维数估计值 d(m)。

（4）增加嵌入维数，重复步骤（2）（3）直到相对应的关联维数的估计值在一

定范围收敛；

（5）使用关联维数来估计嵌入维数。

李亚普诺夫指数[61][62]是对非线性系统进行混沌性度量的重要指标，该指标度

量非线性系统在相空间中轨迹的发散率，这种发散率是以指数形式呈现出来的。

在一维动力系统 xn1  f (xn ) 中，假设 x0 时初始状态，这个初始状态的临近状态假 设为 x0   ，两个初始点进行迭代后是相互靠近还是互相分离取决于这个动力系统 的导数值 df dx 。如果这个导数值 df dx >1，表明经过迭代后两个点分离；反之

则表明两个点聚合。在不断迭代过程中， df dx 的数值也是在不断变化，出现时

而分离时而聚合的现象。将这个一维映射看做是在平面上，经过 n 次迭代后两个

状态之间的距离是：

 en(x0 )  f n (x0   )  f n (x0 )

(3.24)

将上式进行取极限得到：



(

x0

)



lim
n

lim
 0

1 n

ln

f n (x0   )  f n (x0 ) 

 lim 1 ln n n

df n (x) dx

x  x0

将上式进行化简：

(3.25)

27

杭州电子科技大学硕士学位论文

 



lim

1

n1
ln

df

(x)

n n i0

dx xxi

(3.26)

式中的 λ 和初始值 x0 的选取没有关系，这个值就是原始非线性系统的李雅普诺夫

指数，这个指数表示的是非线性系统在 n 次迭代中平均每次迭代中引起的指数分

离中的指数大小。从上述描述中可以看出：

（1）λ<0，表示相邻点最终是要聚合为一个点，对应于系统的稳定的不动点和

周期性运动；

（2）λ>0，表示相邻点最终要分散，对应于系统轨迹的局部不稳定，如若系统

轨迹还有整体的稳定性，系统轨迹会反复折叠形成混沌吸引子；

由李雅普诺夫指数的正负可以判断系统的稳定型以及混沌程度。将一维动力

系统进行高维度的推广可以得到多维动力系统，多维动力系统的维数和李雅普诺

夫指数的个数相对应。对应于一维情形使用距离来对指数发散率进行衡量，二维

系统使用面积来对于指数发散率进行衡量，三维情形使用体积来对于指数发散率

进行衡量，以此类推…。当推广到 n 维情形时，可以计算出 n 个李雅普诺夫指数，

构建成为李雅普诺夫指数谱。在李雅普诺夫指数谱中，对于各个李雅普诺夫指数

进行降序排列。在经过排序的李雅普诺夫指数谱中，最大的李雅普诺夫指数决定

了整个非线性系统的轨迹发散的快慢，也就是对应的整个混沌吸引子的快慢，如

若最大李亚普诺夫指数是正的，表明系统是混沌的，且指数越大，系统越混沌，

表现越混乱。对于最大李雅普诺夫指数的计算方法通常可以分为 Wolf 方法和

Jocobian 方法两大类，其余大多数都是在这两大类方法中进行改进。本文使用 Wolf

方法来计算最大李雅普诺夫指数：

（1）从一维时间序列中提取李亚普诺夫指数的方法仍然是基于对非线性时间

序列进行相空间重构。Wolf 等人提出了采用相空间中的轨迹等演化来进行李雅普

诺夫指数的估计。这种方法在混沌研究和混沌时间序列预测中被广泛使用。

（2）对于时间序列{xi}（i=1,2,…,n）重构一个相空间。相空间中有 p 个 m 维

向量 Xi：

X (ti )  (x(ti ), x(ti+ ),..., x(ti+(m-1) ))  Rm, i [1,p];p=n-(m-1)

(3.27)

（3）选择相空间中的一个初始点 X (t0 ) 以及其最邻近的点，这两个点之间的

初始距离为 L0，记录这两个点随着时间的变化直到时间 t1，给定一个阈值 δ>0，两

个点之间的距离 L0 '  X (t1)  X1(t1)   时，保留点 X (t1) 。在附近寻找点使得

L1  X (t1)  X1(t1)   。重复上述步骤直到时间序列结束。这时总的迭代次数为 M，

最大李亚普诺夫指数为：

 max



1 tM  t0

m
ln
i0

Li ' Li

(3.28)

28

杭州电子科技大学硕士学位论文

3.3 数据预处理

3.3.1 数据清洗
在使用机器学习模型解决实际问题的时候，原始数据很有可能不完整并且可 能会出现一些数据异常的情况。如果不对这些情况进行处理，模型会对非关键的 异常数据进行学习，没有对正常数据进行充分学习，导致训练得到的模型发生偏 差，不能对未知数据进行比较好的分析预测。为了避免这些情况发生，也就是为 了学习到合适的模型对未知数据的预测结果比较准确，需要对这些异常数据进行 处理，对数据缺失以及数据异常的处理过程叫做数据清洗。数据清洗包括处理缺 失值和无效值，检查数据的一致性。关于常见数据清洗的几种方法：
（1）解决数据缺失问题：对数据集中的数据进行遍历，发现某些属性项的数 据为缺失值时，可以使用该属性对应的统计指标（如最值，平均值等）进行填充；
（2）解决数据异常问题：一般使用统计学中的 3-西格玛规则进行异常数据的 搜索。对数据集中的数据进行遍历，当发现数据集中数据是在 3-西格玛范围之外 就认定该数据为异常数据，并对异常数据进行处理。对异常数据的处理可以使用 均值等属性相关的统计学指标进行替代。

3.3.2 数据标准化和归一化

当选择好特征并进行数据清洗后，需要对数据进一步处理用以构建数据矩阵

方便输入机器学习模型。在作为数据矩阵输入机器学习模型之前，需要对数据中

的特征进行标准化处理。需要对数据特征进行标准化处理的原因是各个特征分量

相对于模型都具有相应的不同权重。当特征之间进行比较时，特征单位量纲的不

同会造成非常大的影响：单位量纲大的特征相较于单位量纲小的特征对应的模型

权重更加大，对模型的影响也会更加大。因此，为了消除各个特征之间由于量纲

不同带来的影响，需要消除各个特征的量纲单位，将绝对数值转化为相对数值。

常见的特征标准化的方法有最值标准化和均值标准化。最值标准化的转化公式如

下：

x '  x  min(x) max(x)  min(x)

(3.29)

最值标准化是数据使用最值做线性转换，转换为（0,1）区间上的相对值。均

值标准化的转化公式如下：

x' x 

(3.30)

其中 μ 是数据特征对应的均值，σ 是数据特征对应的标准差，这种线性转换方

式的转换结果也是（0,1）区间上的相对值。在统计学上这种转换方法称为 Z-score，

通常用于将正态分布转化为标准正态分布。最值标准化和均值标准化是两种常见

的数据标准化方式，都是将数据通过线性变换转换为（0,1）区间上的相对值，消

29

杭州电子科技大学硕士学位论文
除量纲的影响。除此之外还可以使用自定义的方式将数据进行线性转换，消除量 纲的影响。本文采用均值标准化的方式对数据进行标准化处理，使用 matlab 平台 上自带的函数模块对数据进行自动标准化处理。
在一些机器学习模型当中需要进行内积运算得到两个向量之间的关系，常见 于支持向量机中的对偶问题和核函数问题。内积计算可以使用余弦公式进行表示， 向量之间的夹角大小表示两个向量之间的关系：夹角范围为（0,π），两个向量之间 相关性越大，它们之间的夹角的绝对值越大，内积越大；向量之间的关联性越小， 向量之间的夹角绝对值越小，内积越小。但是向量的长度也会对内积大小造成影 响，通常向量的长度越大，内积越大。这种大内积的情况并不能说明两个向量之 间相关性较大，需要先将向量进行单位化处理，然后将单位化处理的向量进行内 积运算，计算得到两个向量之间的关系。本文使用 matlab 中自带的函数对数据矩 阵中的特征向量进行单位化处理。
3.4 数据特征降维
高维数据相较于低维数据包含有更加多的原始数据信息。使用高维数据进行 学习训练会得到更加复杂的模型，当模型过于复杂的时候就会造成过拟合现象。 过拟合现象指的是机器在训练集上对数据的分析结果准确率很高，甚至达到 100%， 但是在训练集之外的数据上进行分析时效果就比较差。鉴于使用高维数据对模型 进行训练会出现过拟合现象，需要通过一定手段将高维数据转换为低维数据。使 用低维数据可以降低模型复杂度，有效减少模型的过拟合现象。
降维可以分为单纯的特征选择和数据降维两种情况。单纯的特征选择是在给 定的若干个特征维度的数据中，挑选出认为比较合适的特征，剔除掉不重要的特 征，最后剩下的特征就是特征选择的结果。特征选择只是减少了特征的数量，具 体的特征并没有改变。数据降维主要将高维特征数据通过映射转换为低维特征数 据，进行数据降维后，无论是特征的数量还是特征的类型都发生了改变。
数据降维的目的是为了减少特征数量，防止训练出的模型出现过拟合现象。 降维后的特征要能保留原始高维数据的信息，尽量少的发生信息冗余现象。减少 信息冗余就是使特征属性之间的相关性比较小，没有信息冗余表现为特征属性之 间两两正交。正是基于此目的，统计学发展出了主成分分析理论。
主成分分析的目的是找出原始数据中的最主要的而且没有相关性（表现为属 性之间的两两正交）的特征属性。使用协方差矩阵特征分解后的特征向量构建的 矩阵对原始数据进行空间线性变换，将原始数据进行降维并使得变换后的特征属 性两两正交（因为特征向量之间是两两正交的）。主成分分析的主要步骤如下：
（1）对原始数据中的各个特征属性进行标准化处理，消除属性之间的量纲影 响；
30

杭州电子科技大学硕士学位论文
（2）对标准化处理后的数据的各个特征属性构建协方差矩阵：协方差矩阵是 一个对称方阵，矩阵中的每一个元素表示的是特征之间的两两关系。协方差矩阵 的主对角线表示的是特征和自己的相关性，是特征对应的自方差，在数值上都为 1。 协方差矩阵的其他位置的元素就是不同特征之间的协方差（不同特征之间的关系）；
（3）将协方差矩阵进行矩阵特征分解，分解为特征值和特征向量； （4）将分解的特征值进行从大到小的排序，选取前几个数值，将这几个特征 值对应的特征向量进行组合，构造变换矩阵； （5）使用变换矩阵对原始数据矩阵进行线性变换，将原始数据矩阵映射为经 过主成分分析降维的新的数据矩阵。 需要注意的是，经过主成分分析之后的数据矩阵的特征属性是经过映射变换 的，特征属性已经发生了改变，并且特征属性之间是两两正交的，大大减少了数 据的冗余性而且表达了原始数据的主要信息。主成分分析是一种比较常用的数据 降维方法。
3.5 数据集划分
使用机器学习方法解决分类、回归等问题时，需要将已知数据集分为训练集 和测试集。训练集和模型假设空间、模型选择策略以及相应参数训练方法一起对 模型进行训练，最终得到能够解决问题的具体模型。测试集是对训练出来的具体 模型进行测试，用以评价模型的性能。评价模型性能的步骤如下：
（1）将测试集输入到训练出来的模型中； （2）使用模型对输入数据进行估计，得到估计结果； （3）将模型估计结果和测试集实际标签比对之后进行模型准确率的统计分析， 使用统计分析指标对训练得到模型的好坏进行评估。 在回归问题中通常是设立一个分割系数将已知数据集分割为训练集和测试集。 但是面对分类问题，特别是多分类问题时，需要对各个类别进行统计占比分析， 依据分割系数和各类别占比对各个类别进行分层抽样，得到类别占比同分布的训 练集和测试集。本文对数据集使用分割系数为 0.7 的分层抽样。
3.6 本章小结
本章主要是对从 MIT-BIH 心电数据库中提取出来的 RR 间期数据进行心率变 异性的特征提取。首先简单介绍了心率变异性以及其对应的时频域和非线性指标。 其次对心率变异性的 MEAN、SDNN、RMSSD 时域指标，VLF、LF、LH、LF/LH、 TP 频域指标，非线性指标 box-dimension 等使用对应方法进行提取。然后对提取出 来的特征进行数据预处理：将实验异常数据进行处理并将数据进行去量纲标准化 处理以及数据样本的归一化处理。最后将数据集划分为训练集和测试集用于对模 型进行训练和测试。
31

杭州电子科技大学硕士学位论文
第四章 使用多分类支持向量机进行睡眠分期
4.1 机器学习简介
近几年，人工智能、大数据、神经网络、深度学习等一些名词在各种媒体上 甚为常见。它们的共同目标可以归结为使机器智能化，让机器能够替代人去做一 些经验性的复杂任务。这些新名词和机器学习都具有很强的相关性，神经网络是 深度学习的一个研究方向，深度学习是机器学习的一个分支。在大数据分布式计 算平台上对机器学习模型进行训练，使训练出来的模型表现出类似于人类智能的 行为，称为人工智能。当然实现人工智能的途径不仅只有机器学习，还有其他方 法，但是从现阶段来看实现人工智能最有可能的途径就是机器学习。
机器学习是一门实用性很强的交叉学科，其交叉了概率统计、运筹学、优化 论等基础学科和计算机编程语言、操作系统等实践学科，是理论与实际的结合。 我们可以通过机器学习方法解决很多经验性的问题，这里的经验指代的就是数据， 机器学习使用大规模数据集进行训练就是学习经验以得到智能模型，产生的智能 模型对新数据进行预测分析，提供决策支持。目前可以看到很多使用机器学习方 法实现人工智能的产品：语音语义识别产品如各种输入法，其使用语音识别进行 文字编辑；图像识别中的无人驾驶智能车是现阶段研究热潮；垃圾邮件过滤器； 电商网站的广告推荐系统等。
机器学习根据不同方法可以进行不同的分类。依据有无数据集标签及标签的 多少可以将机器学习分为监督学习、半监督学习、无监督学习和强化学习，其中 最基本的就是监督学习。监督学习对机器进行训练时不仅包含数据集还包含数据 集对应的输出数据标签。监督学习根据需要解决问题的目的的不同又可以划分为 分类、预测和标注。当模型的输出是有限个离散数值的时候，监督学习问题称为 分类问题，如垃圾邮件分类问题。当模型的输出为连续型变量或者为无限个离散 数值的时候，监督学习问题称为预测分析问题，如金融上的一些时间序列分析。 当输出是一系列序列标注的时候称为标注问题，如语义分析问题。监督学习中又 以分类问题最为基本。常见监督式机器学习模型分为条件概率模型和非条件概率 决策模型，条件概率模型中比较常见的是贝叶斯模型和将贝叶斯模型进行扩展的 朴素贝叶斯模型、马尔科夫模型等，非条件概率决策模型有 K 近邻法、决策树、 随机森林、逻辑斯蒂回归、支持向量机等。机器学习的一个分支是深度学习。在 深度学习中，神经网络又是目前最为流行的。分布式云计算平台是用于处理大规 模数据的有力工具，神经网络的流行得益于近几年大规模计算能力的迅速提升。
32

杭州电子科技大学硕士学位论文

神经网络是基于脑神经科学发展而来的，但是其理论基础还不是特别完善。支持 向量机具有比较完善的理论支持，而且在监督学习模型中支持向量机具有比较好 的效果，对支持向量机训练时的计算开销不是很大，本文采取多分类支持向量机 来解决睡眠自动分期问题。

4.2 支持向量机简介

支持向量机[63-67]是一种用于二分类的监督式机器学习模型，其主要是在特征

空间中构建超平面将数据进行二分类操作。依据数据的空间分布情况可以将支持

向量机分为：线性可分支持向量机、线性支持向量机、非线性支持向量机。线性 可分支持向量机指的是在特征空间中完全可以找到一个超平面对数据进行完美划 分；线性支持向量机中的数据在特征空间中大体上是线性可分的，使用超平面进 行划分时偶尔有一些数据出现划分错误的情况；非线性支持向量机中的数据在特

征空间中的分布情况使得不可能找到一个超平面对数据进行线性二分类。现实问 题中的数据通常都是不可分的，需要使用非线性支持向量机来构建分类模型。非 线性支持向量机是基于线性可分支持向量机和线性支持向量机推广得到的，在这 里首先介绍线性可分支持向量机和线性支持向量机，再对非线性支持向量机进行

介绍。

4.2.1 线性可分支持向量机
线性可分支持向量机指的是鉴于其数据分布情况在特征空间中完全可以找到

一个超平面对数据进行完美的二分类。假设输入的数据是 n 维特征向量，表示为

x  (x1, x2,..., xn )T ，将输入数据表示为列向量形式。对数据进行划分的超平面需要

确定其法向量   (1,2,..,n )T 和截距 b。该超平面使用参数进行表达的形式为：

T  x  b  , x  b  0  1  x1  2  x2  ... n  xn  b

(4.1)

其中  , x  是两个向量的内积表达形式。线性可分支持向量机模型表示：

h(,b)  sign(T  x  b)

(4.2)

其中：

1, z  0;

sign(z)  1, z  0;

(4.3)

使用训练数据集对上述模型中的参数 (,b) 进行训练，得到支持向量机对应的

空间超平面。

在支持向量机中仅仅找到一个超平面将两类数据进行正确的线性划分是不够 的，如果仅仅是对两类数据进行正确的线性划分，支持向量机和感知机分类器之 间就没什么区别（区别也就局限于将分类数据标签设置为（-1,+1）还是（0,1））。 依据统计学思想，对使用超平面进行分类的结果还需要给出一个置信度指标来考 量分类结果的可信度，这个指标就是间隔。使用间隔作为支持向量机分类的置信 度指标是因为在感知机模型中仅仅将输入数据进行正确的分类，并没有其他约束

33

杭州电子科技大学硕士学位论文

条件限制，使用感知机模型对数据进行分类可能得到很多个模型，在这些看似都

正确的模型中如何进行抉择没有具体的方法。在抉择时选取不同的感知机，对未

知数据进行分类预测的结果也可能会出现不同，导致分类结果不是很可靠。针对

于感知机模型的不足，支持向量机模型引入间隔概念作为数据分类的置信度指标。

间隔分为函数间隔和几何间隔，下面分别对函数间隔和几何间隔予以介绍：

（1）函数间隔

支持向量机对数据集上样本点 (x(i) , y(i) ) 的函数间隔 ˆ(i) 的定义：

ˆ(i)  y(i)  (T  x(i)  b)

(4.4)

支持向量机对整个数据集{(x(i) , y(i) ) } 的函数间隔 ˆ 的定义：

ˆ  min(ˆ(i) )  min( y(i)  (T  x(i)  b))

(4.5)

支持向量机对整个数据集的函数间隔 ˆ 是支持向量机对数据集上样本点的函

数间隔 ˆ(i) 的最小值。上标 i 代表的是训练集中的第 i 个数据样本。函数间隔的正负

性表示支持向量机模型对数据分类的正确与否：当分类正确时，函数间隔是一个

正值；否则为负。函数间隔数值的大小决定了数据分类的置信度：在分类正确的

前提下，函数间隔越大表明数据点距分离超平面越远，分类越可信；函数间隔越

小表明数据点距分离超平面越近，分类置信度越小。支持向量机的核心思想是最

大化距分离超平面最近的数据点的函数间隔，也就是：

max(ˆ)  max(min(ˆ(i) ))

(4.6)

但是很容易发现，当分离超平面的参数 (,b) 进行成倍的放缩时，相应的函数

间隔也会成倍放缩。数据点和分离超平面之间的距离并未改变，置信度却成倍放

缩，需要对函数间隔置信度指标加以修正来改善这种状况。修正的方法是将函数

间隔进行归一化处理，归一化的结果产生了几何间隔。

（2）几何间隔

支持向量机对数据集上样本点 (x(i) , y(i) ) 的几何间隔  (i) 的定义：

 (i)  y(i)  (T  x (i)  b) 

(4.7)

支持向量机对整个数据集{(x(i) , y(i) ) } 的几何间隔 的定义：

  min( (i) )  min( y(i)  (T  x(i)  b))

(4.8)



基于几何间隔的对支持向量机参数的选择策略是最大化距分离超平面最近的

数据点的几何间隔，也就是：

max( )  max(min( (i) ))

(4.9)

将上式重新进行描述：

34

杭州电子科技大学硕士学位论文

max( 

ˆ 

)

s.t. (i)  

i=1,2,...,n

(4.10)

由于函数间隔可以根据超平面系数同时成倍放缩而改变，将函数间隔设置为 1，

并将目标优化函数进行转换，转换为最小值形式：

min . 1  2 2 s.t.y(i) (T  x(i)  b)  1 i=1,2,..,n

(4.11)

上述公式就是线性可分支持向量机的优化目标以及约束条件。优化问题使用常

规方法解决比较麻烦，通常使用拉格朗日乘子法将上述的目标优化函数和约束条

件构建为拉格朗日函数，将原始问题转换为对偶问题进行求解。将上述带约束的

原始优化问题转换为对偶形式的问题：

  min

1 2

n i 1

n
i j y(i) y( j)
j 1

 x(i), x( j)

n
  i
i 1

 
s.t.

i

n 1

i

y

(i

)



0,

i  0;

i=1,2,...,n

(4.12)

其中i 为拉格朗日乘子，每一个拉格朗日乘子对应一个训练数据样本 (x(i), y(i) ) 。

拉格朗日乘子参数i 和原始问题的参数 (,b) 之间具有如下关系：

 




n
i y(i) x(i)
i 1
n

 b



y( j)



i y(i)
i 1



x(i) , x( j)



(4.13)

4.2.2 线性支持向量机

线性可分支持向量机和线性支持向量机之间的区别是数据在空间的分布情况。

线性支持向量机中的数据在特征空间中是近似线性可分的，在特征空间中可以找

到超平面对数据大体进行线性二分类，但是偶尔会出现一些分类结果错误的情况。

线性支持向量机需要在函数间隔中加入松弛变量 (i) 进行修正，修正后的原始问题

的表达式为：

 min


1 2



2

C

n i 1

 (i)

s.t. y(i) (T  x (i)  b)   (i)  

i=1,2,..,n

(4.14)

其中 C 是惩罚因子，是用于调节模型复杂度和经验风险的超参数。使用 KKT 条件

对原始问题进行转换，将原始问题转换为对偶问题的形式：

  min

1 2

n i 1

n
i j y(i) y( j)
j 1

 x(i), x( j)

n
  i
i 1

 
s.t.

n
i y(i)  0,i  0; 0  i  C
i 1

i=1,2,...,n

(4.15)

35

杭州电子科技大学硕士学位论文

拉格朗日乘子参数和原始问题的参数 (,b) 之间的关系：

 



n
i y(i) x(i)
i 1



n

 b



y( j)



i y(i)
i 1



x(i) , x( j)



(4.16)

4.2.3 非线性支持向量机

现实当中最常见的是数据线性不可分的情况，从前面的对偶形式中看出最后都

将原始问题表示为对偶参数i 不为零的数据向量的内积形式  x(i) , x( j)  ，这些数 据向量称为支持向量。支持向量的内积形式引入了核函数的概念。

非线性支持向量机首先将输入空间中的非线性数据通过映射转换为高维特征

空间中的近似线性可分数据，转换为线性支持向量机问题，然后在高维特征空间

中学习线性支持向量机。假设有一个函数映射 能够将输入空间中的非线性可分数

据 x 映射为特征空间中近似线性可分数据(x) ，在特征空间中学习线性支持向量机，

使用对偶形式进行表示：

  min

1 2

n i 1

n
i j y(i) y( j)
j 1

n
 (x(i) ),(x( j) )   i
i 1

 
s.t.

n
i y(i)  0,
i 1

i  0;

0  i  C

i=1,2,...,n

(4.17)

将映射后的特征空间中数据向量的内积形式  (x(i) ),(x( j) )  表示为核函数形式：

k(x(i) , x( j) )  (x(i) ),(x( j) ) 

(4.18)

省去中间函数映射的步骤直接使用核函数对非线性支持向量机进行建模：

  min

1 2

n i 1

n

n

i j y(i) y( j)k (x (i) , x ( j) )   i

j 1

i 1

 
s.t.

n
i y(i)  0, i  0; 0  i  C
i 1

i=1,2,...,n

(4.19)

常见的核函数主要有多项式核函数，径向基核函数，sigmoid 核函数等，通常

都是根据经验来对核函数进行选择。基于实际经验：当数据近似线性可分使用多

项式核函数中的线性核函数，线性核函数参数少，训练速度快，使用线性核函数

支持向量机对近似线性可分数据的分类效果比较理想。当数据线性不可分时，如

果特征数量比较多，样本数量也比较多的话，通常使用线性核函数；当特征数量

比较少，样本数量适中的时候，使用径向基核函数效果比较好。

本文考虑到对睡眠阶段进行分类，数据样本量并不是很大，特征数量也比较少，

使用径向基核函数作为支持向量机的核函数。径向基核函数表示为：

xz 2

k(x, z)  exp(

)

2 2

(4.20)

径向基核函数的核参数是 ，在支持向量机训练之前先要对该超参数进行调优。

36

杭州电子科技大学硕士学位论文
4.3 支持向量机中超参数的优化
在一般的机器学习问题当中，需要对模型超参数进行调优。机器学习中超参 数指的是模型系统本身自带的参数，超参数是对模型的约束条件。超参数并不是 使用数据集对相应模型训练得到的模型参数，而是在使用数据集训练模型之前人 工对其进行优化，得到的最优超参数。得到超参数之后就可以确定模型的类型， 使用训练数据集对确定类别的模型进行参数训练。对超参数进行优化的过程称为 参数寻优。对模型超参数进行优化，使用训练数据集对模型参数进行学习训练， 得到具体的模型并使用测试数据集对训练出来的模型进行性能评估。
4.3.1 支持向量机超参数介绍
从 4.2.3 节支持向量机的优化目标函数中可以看出，支持向量机模型对应的超 参数有两个：惩罚因子 C 以及选取的核函数中的核参数。本文中选取径向基核函 数 RBF（也称为高斯核函数）作为支持向量机的核函数，该核函数对应的核参数 是 gamma。下面分别对超参数 C 和 gamma 进行介绍。
惩罚因子 C 是支持向量机中关于惩罚项的系数。在支持向量机中惩罚项表示
n
 为松弛变量的和  (i) 的形式。惩罚因子 C 是对支持向量机模型的经验风险和模
型复杂度两者权衡i1的系数，经验风险指的是模型在训练数据集上的误差，在支持 向量机中模型的复杂度使用松弛变量的和来表征。惩罚因子用于防止支持向量机 模型的过拟合。机器学习模型的过拟合指的是使用训练集训练出来的模型在训练 数据集上表现的很好，误差很小甚至是零误差；但是使用模型对未知数据进行估 计就会出现较大偏差。模型复杂度较大，训练得到的模型就会复杂，复杂模型对 训练数据集上的样本数据拟合的很好，得到的模型经验风险也比较小。但是由于 模型复杂性过高，会出现对训练数据的过学习，有可能学习到一些噪声数据的特 征，而噪声数据的特征是我们不希望被学习到的。这就会导致模型在训练集上具 有相当不错的拟合效果，但是对训练集外的未知数据的分类预测效果比较差。我 们训练模型的目的是对未知数据进行分类预测，关注的是测试误差或者是模型的 结构风险，使得模型对训练集之外的数据具有较好的分类预测能力，这种能力称 为泛化能力。惩罚因子 C 就是用来调控支持向量机的经验风险和复杂度的一个超 参数，使得支持向量机在比较简单的模型下面能够拥有较好的经验风险和泛化能 力。当惩罚因子 C 比较大时，表示模型比较复杂，可能会出现过拟合；当惩罚因 子 C 比较小的时候，模型过于简单，预测能力也不会很好。可以从一定角度将惩 罚因子 C 看做是对模型的分类预测结果好坏的容忍度。支持向量机模型中的超参 数 C 的默认取值为 1。
支持向量机中每一个训练数据样本对应一个径向基核函数的取值。径向基核 函数中的核参数 gamma 1 (2 2) 表示径向基核函数的宽度参数，该参数控制了径
37

杭州电子科技大学硕士学位论文
向基核函数的控制范围。当 gamma 取较大值时，径向基核函数的效果和多项式核 函效果相类似，模型较复杂；当 gamma 取较小值时，径向基核函数效果和线性核 函数效果类似，模型较简单。在支持向量机中径向基核函数的核参数 gamma 被默 认为 1。
支持向量机需要选取合适的超参数组合(C，gamma)来确定一个合理的模型类 型。当 C 和 gamma 同时比较大时，模型会趋于复杂化，这样就会造成过拟合；当 C 和 gamma 同时较小时，模型会简单化，这时模型分类预测效果也会下降。这就 要求需要找到合适的超参数组合（C，gamma）来建立一个合适的模型对未知数据 进行分类预测。这种合适的分类模型既不会过于简单使得分类预测结果很粗糙， 也不会使得模型复杂化，对于未知数据的预测不准确，出现过拟合现象。
4.3.2 支持向量机超参数寻优
寻找合适的超参数组合（C，gamma）的过程称为支持向量机的参数寻优。参 数寻优的过程主要分为两个部分：对可能是最优超参数组合情况的遍历搜索以及 对特定超参数组合下的模型相关性能指标的分析。
对特定超参数组合下的模型相关性能指标分析通常使用交叉验证。交叉验证 有三种方式：
（1）留出法（hold cross validation）：将训练集分为训练子集和验证子集，使 用训练子集对特定超参数组合下的模型进行训练，并用测试子集对训练出来的模 型进行性能评估。该方法具有比较大的局限性，不能完全使用训练集对模型进行 训练，对模型的评价不是很客观。
（2）k 折交叉验证（k-fold cross validation）：将训练集分为 k 个子集，理想状 况这 k 个子集的数据同分布，可以通过分层随机抽样对同分布约束条件问题进行 解决。将这 k 个子集中的一个子集作为测试子集，剩余的 k-1 个子集作为训练子集。 使用训练子集对当下超参数组合下的模型进行训练，并用测试子集对训练出来的 模型进行性能评估。分别将 k 个子集作为测试子集，循环上述过程，得到 k 个特 定超参数组合下的模型，并且得到 k 个模型的性能评估指标。将这 k 个性能评估 指标求平均值，使用平均指标来替代当前超参数组合下的模型的性能评估，作为 对超参数组合选取的依据，该方法能够完全使用训练集中的数据。
（3）留一交叉验证（leave-one-out cross validation）：是 k 折交叉验证的一种特 殊情况，当 k 折交叉验证中的每一个子集都是一个数据样本的时候，该 k 折交叉 验证称为留一交叉验证。该方法是针对数据样本不多的情形下的一种数据替代方 案，能够充分利用数据。作为 k 折交叉验证的特例，留一交叉验证需要训练的模 型数量比较庞大，因此其计算开销也比较可观。
对超参数组合的搜索算法主要有：
38

杭州电子科技大学硕士学位论文
（1）遍历搜索：遍历搜索算法就是对所有可能的超参数组合进行遍历，如网 格搜索法和模拟退火随机搜索算法。网格搜索算法简单直接，但是计算开销太大； 使用随机搜索算法进行参数寻优时具有一定随机性，但是业界普遍使用随机搜索 来减少计算开销。依据经验随机搜索和网格遍历搜索两者的结果比较相似。
网格搜索法就是将需要进行优化的超参数组合在其给定范围内依据指定的步 进值将各种超参数组合情况列举出来，表示为网格形式，随后将各种排列方式顺 序遍历出来。遍历每一个超参数组合时，使用 k 折交叉验证将该超参数组合下的 模型的评价指标使用 k 个当下超参组合对应的模型的平均指标来表示，最后依据 平均指标来选择超参数组合。
梯度下降法对最优参数的搜索是一种类似于爬山算法的贪心算法，每次参数 的优化更新方向都是朝着梯度变化最快的地方，这种贪心的搜索算法容易将参数 优化为局部最优解而忽略全局最优解。这种参数寻优算法不仅可能使得参数陷入 局部最优解，当目标优化函数是黑盒模型或者不可以使用函数解析式进行表示， 亦或是可以使用函数解析式表示但是不能够对函数解析式进行梯度求解等情况下 是不能使用梯度下降法进行参数寻优的。梯度下降法对参数寻优的局限性相对来 说比较大，一般只是局限在对模型参数的训练中使用。
（2）启发式搜索：基于一定的约束条件对最优参数位置进行搜索的方法。使 用特定性能指标对状态空间中的参数位置进行评估，依据评估结果找到下一个位 置，不断重复执行这个过程直到寻找到最优参数组合。常见的启发式搜索算法比 如一些群体智能算法[68]：1）遗传算法；2）粒子群算法；3）蚁群算法。
遗传算法[69][70]是参数寻优中的一种元启发式算法，元启发式算法是一种在很 多场合都通用的算法。遗传算法是一种仿生学的群体智能算法，用于对群体参数 的智能寻优。遗传算法的思想借鉴了达尔文的优胜劣汰的生物自然进化论以及孟 德尔的遗传学定律。在遗传算法中一般将待优化参数进行二进制编码，使得参数 表现为基因的组合形式，一个参数称为一个染色体个体。由多个染色体个体组合 构成了种群，种群相当于最优参数解的寻优范围。使用适应度函数来表征染色体 个体的适应度，也就是参数对目标优化函数的优化情况，使用染色体对应的适应 度函数的函数值来判断该染色体是不是一个优秀的染色体，从而将其筛选出来用 于进化。使用适应度函数值选择染色体，然后将选择出来的染色体进行交叉、变 异进化出下一代种群。不断迭代，最后在指定范围内获得最优染色体即为最优化 目标函数对应的参数，完成了参数优化。基于遗传算法的步骤如下：
（1）设定参数的编码方式，种群中染色体个数的上限，根据适应度函数值进 行选择的时候是不是使用精英选择方式（精英选择方式就是将适应度函数值最大 的染色体作为最佳染色体选择出来用于接下来的工作），父母染色体的交叉概率， 父母染色体的变异概率以及迭代进化的代数（停止规则）；
39

杭州电子科技大学硕士学位论文

（2）初始化种群（对于参数的初始化）； （3）使用适应度函数计算种群中各个染色体的适应度函数值，将计算所得各 个染色体对应的适应度函数值进行排序；

（4）对经过排序的染色体进行选择（一般使用精英选择法，选择当前情况下 的最优染色体，是一种贪心算法），将选择出来的染色体组合形成父母染色体；

（5）根据交叉概率对于选择出来的优秀的父母染色体进行交叉操作，交叉操 作就是将父母染色体中的部分编码基因进行交换得到子代染色体；

（6）根据变异概率对于父母染色体中的部分基因进行变异操作，得到子代染 色体；

（7）不断重复（3）~（6）的步骤进行迭代，直到满足停止条件。 遗传算法对参数寻优的全局搜索能力较强，但是局部搜索能力一般；而网格

搜索法是对参数的遍历搜索，是一种比较精确的搜索，但是该种参数寻优方法的

计算消耗比较大。在本文中将两种算法相结合用于改进两种参数寻优方法各自的

不足：首先使用遗传算法对全局最优解进行大范围的搜寻，当使用遗传算法将参

数的寻优范围缩减之后，再使用网格搜索法和 k 折交叉验证对参数进行小范围的 精确寻优。

4.4 支持向量机之 SMO 算法

支持向量机使用 KKT 条件将原始问题转换为对偶问题进行求解，对偶问题中

向量的内积形式很自然的引入核函数，从而解决了数据非线性可分的问题。将对

偶问题中的对偶参数进行求解，通过对偶参数和原始问题参数的关系将原始参数

的解求出来，从而计算出支持向量机模型中的参数。对偶问题的目标优化函数和

约束条件为：

  min

1 2

n i 1

n

n

i j y(i) y( j)k (x (i) , x ( j) )   i

j 1

i 1

 
s.t.

n
αiy(i) =0,αi  0; 0  αi  C ; i=1,2,...,n
i=1

(4.21)

上述目标函数和约束条件表明，对偶问题中具有样本数据个数的参数需要求

解出来。这么庞大的解集如果使用传统方法进行计算，需要消耗的计算资源和相

对应的计算时间是十分可观的。虽然大部分的对偶参数i 为0，这些对偶参数i 对 应于位于分离间隔面之外的非支持向量，小部分的对偶参数 0<i  C 对应于位于 分离间隔面上的支持向量，对偶参数i  C 对应于位于分离间隔面之间的支持向量。 但是总体来说对偶参数的数目还是比较客观的。鉴于此，Microsoft Research的John C.Platt在1998年提出了SMO（Sequential Minimal Optimization，序列最小最优化） 算法。

40

杭州电子科技大学硕士学位论文

SMO 算法[71]是将原来的具有很多个解的解序列问题分解为若干个只有两个变

量的二次规划子问题，对分解的子问题进行求解，不断迭代直到将所有解求出来。

使用 SMO 算法对对偶问题中的对偶参数进行求解的步骤如下： （1）从对偶参数序列中选取最不符合 KKT 条件的两个参数i , j ；

（2）将其它对偶参数固定，原来的对偶问题的目标函数和约束条件改为只包

含选定出来的两个参数的目标函数和约束条件；

（3）将只含有两个参数的目标函数使用约束条件转化为只含有一个参数的目

标函数，对该目标函数进行优化求解；

（4）重复上述（1）（2）（3）的步骤直到所有参数都被求解出来； 在支持向量机中的 KKT 条件是：当参数i  0 时，参数 i  C ，相应的松弛 变量 (i)  0 ，使用松弛变量修正后的函数间隔的对应关系

y(i) (T  x(i)  b)   (i) 1  0 ；当参数i  C 时，参数 i  0 ，相应的松弛变量 (i)  0 ， 对应于分离间隔面之间的支持向量，使用松弛变量修正后的函数间隔的对应关系

y(i) (T  x(i)  b)   (i) 1=0 ；当参数 0  i  C 时，参数 i  0 ，相应的松弛变量  (i)  0 ，对应与分离间隔面上的支持向量，使用松弛变量修正后的函数间隔的对

应关系 y(i) (T  x(i)  b) 1=0 。将上述表述进行数学表达式简化：

ii

 0,  C,

y(i) (T  x(i) +b)  1; y(i) (T  x(i) +b)  1;

0  i  C, y(i) (T  x(i) +b)  1;

(4.22)

步骤（1）中从对偶参数序列中选取含有两个参数的参数对时，选取参数对中

第一个参数i 首先对非边界参数进行遍历，查看参数是否满足 KKT 条件，将最不 符合 KKT 条件的参数选取出来作为参数对的第一个参数。如果找不到就在整个训

练及上进行遍历；选取第二个参数可以使用简化版本进行随机选取，也可以通过

启发式方法进行选取。Platt 的完整版本的 SMO 算法使用启发式方法进行选取，选

取第一个参数i ，计算这个参数对应的数据向量在当前参数环境下的误差 Ei ，寻 找第二个参数时，使得变化量 Ei  Ej 变化最大的样本对应的参数 j ，作为第二个 参数变量。首先从分边界样本中找寻，如果不能找到，就对非边界样本进行遍历

找寻。

4.5 多分类支持向量机

支持向量机常用于解决二分类问题和回归预测问题。但是现实中存在大量多 分类问题，因此需要对支持向量机进行组合优化来构建多分类支持向量机[72][73]。 目前支持向量机已经具有较多的多分类解决方案。

41

杭州电子科技大学硕士学位论文
4.5.1 一对多方案
一对多方案在支持向量机的多分类方案中出现较早，又称为 one-against-rest。 一对多方案多分类支持向量机模型是一个二分类支持向量机模型集群。在一对多 方案多分类支持向量机模型中，基本元件是二分类支持向量机。该方案模型针对 M 分类问题构建 M 个二分类支持向量机基本元件，每个二分类支持向量机元件的 正类是对应的目标类，剩余 M-1 个类别对应二分类支持向量机的负类。在该多分 类支持向量机模型的训练中，需要使用整个样本数据训练集对模型集群中的每个 基本元件进行训练，单个二分类支持向量机基本元件的训练速度较慢。特别是当 训练数据量比较大时，基本元件的训练时间就会显著变长。虽然需要进行训练的 二分类支持向量机模型基本元件个数 M 不是很多，但是由于单个元件的训练时间 比较长，多分类模型整体训练时间也会比较长。对 M 分类问题，一对多方案多分 类支持向量机只需要构建 M 个二分类支持向量机基本元件。使用该方案多分类模 型对未知数据进行分类时，只需将未知数据用模型集群中的 M 个决策函数元件进 行计算就可以得到结果，对未知数据能够进行较快的预测。但是由于基本元件二 分类支持向量机中的正负类对应目标不同，正类训练数据和负类训练数据之间的 数量差距可能比较悬殊，很容易造成支持向量机中训练数据集不平衡问题。训练 数据集不平衡会导致训练出来的支持向量机模型对应的超平面发生偏移，使模型 出现偏差。同时，该方案的多分类支持向量机模型可能存在对数据重叠分类和不 分类的情况。重叠分类指的是输入未知数据时，多分类支持向量机模型的输出可 能出现多个正类分类，无法判别需要进行预测的数据到底属于哪一个类别。不分 类现象指的是该方案的多分类支持向量机模型的输出结果中的所有基本组件都没 有正类输出，导致最终结果无法判明属于哪一个类。同时该方案还存在对基本元 件二分类支持向量机进行训练时需要重新制作类别标签，相对来说也增加了一定 的工作量。
4.5.2 一对一方案
一对一多分类支持向量机模型同样是二分类支持向量机模型集群。一对一多 分类模型中的基本元件是二分类支持向量机，但是相对一对多方案不同的是，一 对一方案中的基本元件的二分类对象不管是正类还是负类都仅仅是所有M个类别 中的两类。M个类别进行两两组合，总共有 M (M 1) 2 种组合方式，对于这么多 种组合方式构建相应个数的二分类器元件。多分类模型群组中的二分类器元件的 正负类别就是类别的组合方式。使用训练数据集中各个不同类别的数据对多分类 器模型中基本元件二分类支持向量机进行训练，最终得到一对一方案下的多分类 支持向量机模型。当需要使用该方案下的多分类模型去对新数据进行分类的时候， 将新数据输入多分类模型，查看模型中各个二分类器组件的输出结果，对各个组
42

杭州电子科技大学硕士学位论文
件结果进行统计，哪个类别的统计票数最多新数据就被判为该类别。该方案相对 于一对多方案来说，对模型组件二分类支持向量机的训练只需要所有类别中的两 个类别进行训练，单个组件训练时间短，最后使用统计投票的思想易于理解。而 且组件中的正负类别是一对一的，不太会产生数据倾斜的情况。该方案相对于一 对多方案的多分类支持向量机来说，所需要训练的模型的二分类组件比较多，特 别是当需要进行分类的类别M比较大的时候，组件的个数是呈现出平方形式的增长 的，一对多方案的组件个数只是线性增长。当需要进行分类的数目M比较大的时候， 该模型需要的训练时间也会比较久。 相对来说，当分类数目 M 不是很大的时候，通常采用一对一方案进行多分类支持 向量机模型的构建，总体来说需要构建的组件个数不是很大，对于每个组件的训 练时间也不是很久，数据倾斜的情况发生的几率也较小，是一种比较理想的多分 类模型的设计方案。
4.5.3 层次二叉树方案
多分类支持向量机中的一对一方案和一对多方案中的组件（二分类支持向量 机）都是并行排列的，各个二分类器组件之间没有什么关联，这样容易造成多分 类器的误分。对并行结构进行改进就得到层次二叉树结构的多分类器。其实质也 是一对多方案，只不过是将一对多方案进行不断迭代，最后得到精细分类。二叉 树的根节点二分类支持向量机组件对于第一类和其余类别进行分类，其中第一类 为正类，其余各类的和为负类；接着将根节点二分类组件的负类使用一对多二分 类组件进行分类，正类为第二类，负类为排除掉第一类和第二类的剩余类的总和； 以此类推，直到将 M 个类别全部鉴别出来。该多分类模型对 M 分类问题总共构建 M-1 个二分类器组件。这个方案有点类似于小波分解，将小波分解为低频近似部 分（相对于二分类组件中的负例，是剩余类总和）和高频细节部分（相当于二分 类组件中的正例，对应的目标类），不断将低频近似部分（组件负例中的剩余类别） 进行迭代分解直到足够精细为止（将各个类都鉴别出来）。
43

杭州电子科技大学硕士学位论文 SVM_1

class_1

SVM_2

class_2

SVM_i

class_i

SVM_(M-1)

class_(M-1)

class_M

图 4.1 层次二叉树示意图 层次二叉树多分类支持向量机具有如下特点：根节点的二分类支持向量机组 件需要在整个训练集上进行训练，第二个二分类组件的训练集是排除掉第一类的 所有类的总和，到最后一个二分类器组件是在两个类别的数据集上进行训练；整 个 M 分类多分类支持向量机组件共有 M-1 个；消除了在组件为并行结构的多分类 支持向量机的重复分类和漏分类的缺陷。该方案的多分类支持向量机组件个数少， 对每个组件进行需要使用的训练集规模也比较适中，分类结果较为可靠。
4.5.4 有向无环图方案
有向无环图多分类支持向量机模型是由二分类支持向量机模型组件组合得到 的。有向无环图多分类支持向量机的组件是“一对一”的二分类支持向量机，这 里的“一对一”指的是二分类支持向量机取非值作为目标类，不断将类别使用二 分类支持向量机进行缩减交叉，最后将各个类别鉴别出来。

SMV

(1,2,3,4)

NOT 1

NOT 4

SMV

SVM

(2,3,4)

(1,2,3)

NOT 2

NOT 4 NOT 1

NOT 3

SVM

SVM

SVM

(3,4)

(2,3)

(1,2)

NOT 2

NOT 3

NOT 2 NOT 4

4

3

2

1

图 4.2 有向无环图示意图

44

NOT 3 NOT 1

杭州电子科技大学硕士学位论文
有向无环图多分类支持向量机的特点：对一个 M 分类问题，每个未知数据需 要 M-1 个二分类器组件进行决策，决策组件较少，该方案的决策时间比较短，同 时该方案不存在重叠分类和漏分类现象。
4.6 本章小结
本章主要是对支持向量机模型进行介绍。首先简单介绍了机器学习，接着对 机器学习中的支持向量机模型进行了介绍。从线性可分支持向量机、线性支持向 量机到非线性支持向量机进行了过渡介绍，从对偶问题中自然引入核函数进而解 决数据非线性可分问题，对本文中使用的径向基核函数进行了简单介绍。在使用 训练集对于支持向量机模型进行训练之前先要确定模型的超参数，对于支持向量 机中超参数进行了介绍并对参数寻优方法遍历搜索和群体智能算法进行了简单介 绍，并针对两种算法的优缺点进行了改进，将两种算法相结合来实现支持向量机 的超参数寻优。对支持向量机进行超参数寻优过程后，使用 SMO 算法对模型参数 进行训练得到训练模型。最后针对睡眠分阶是多分类问题对支持向量机的多分类 方案进行简介和特点分析。
45

杭州电子科技大学硕士学位论文
第五章 睡眠分期仿真结果分析
5.1 支持向量机模型中的超参数调优
本文使用林智仁教授编写的libsvm工具箱在matlab实验平台上进行径向基核 函数多分类支持向量机超参数C和gamma的调优。将遗传算法和网格遍历搜索算法 相结合对支持向量机超参数进行寻优：首先使用遗传算法对超参数进行全局寻优 确定大致位置，再使用网格搜索算法对超参数进行局部遍历精准寻优。使用遗传 算法对参数进行全局寻优，工具箱中的函数模块的形式为： [BestCVaccuracy,Bestc,Bestg,ga_option]=gaSVMcgForClass(train_label,train_data,ga_ option)
函数模块的输入参数是训练数据集train_data，训练集相对应的标签train_label， 以及遗传寻优算法中的一些参数选项ga_option。函数模块的输出是径向基核函数 支持向量机的最佳准确率BestCVaccuracy，支持向量机对应的最佳参数C（Bestc） 和最佳核参数gamma（Bestg）以及遗传算法中的一些选项ga_option。遗传算法中 的选项ga_option是一个以结构体形式定义的变量，该选项中包含了遗传算法的一 些设定参数：最大进化代数，种群最大数量，参数C的搜索范围，参数gamma的搜 索范围，k折交叉验证的k值等。
接着使用网格搜索法对超参数进行小范围的精准遍历搜索，网格搜索法使用 工具箱中的函数模块的形式为： [bestacc,bestc,bestg]=SVMcgForClass(train_label,train,cmin,cmax,gmin,gmax,v,cstep,g step,accstep)
该函数模块的输入参数是训练数据集train，训练集对应的标签train_label，参 数C的相关搜索范围cmin、cmax以及步进cstep，参数gamma的相关搜索范围gmin、 gmax以及步进gstep，k折交叉验证中的k值，准确率的步进accstep。函数模块的输 出参数为最佳准确率bestacc，最佳的参数C（Bestc）和最佳核参数gamma（Bestg）。
从上述参数寻优模块中可以看出，不管是网格搜索算法还是遗传算法都需要 确定k折交叉验证的k值。因此，首先就要选取合适的k值：k的取值过小则交叉验 证没有意义，不能使用交叉验证的平均性能作为模型的整体性能；k的取值过大则 计算时间就会相应大幅度增加，增加计算消耗。将k的取值范围定为4到8之间进行 实验仿真选取，从表5.1中实验结果可以看出k在取值为4到8之间的准确率差异不大， 综合考虑计算耗时成本，取交叉验证的k值为5。
46

杭州电子科技大学硕士学位论文

表 5.1 k 折交叉验证实验结果

K值

最优参数组合（c,g）

分类准确率 %

4

（63.5424，0.0067）

79.2208

5

（21.0090，0.0391）

80.5195

6

（31.3252，0.0235）

81.4478

7

（16.3312，0.0353）

81.8182

8

（135.928，0.0153）

80.5195

分别选取最大遗传代数为 30、50、80、100、150、200 进行实验，分析最大

遗传代数对遗传算法的影响。实验结果如表 5.2 所示：

表 5.2 最大遗传代数对遗传算法的影响

最大遗传代数 ga_option.maxgen

最优参数组合（c,g） 分类准确率 %

30

（75.2106，429.7232）

72.0779

50

（46.7623，541.0648）

72.7273

80

（55.8852，507.8082）

72.6843

100

（36.9561，596.6173）

72.4879

150

（45.6250，543.1915）

72.6897

200

（35.9400,609.9325）

72.8479

从表 5.2 中可以看出，遗传算法中最大遗传代数设置为上述不同值时，最优超

参数组合对应的分类准确率比较接近，遗传代数越大，使用遗传算法进行参数寻

优的时间越久，综合考虑分类准确率和参数寻优消耗的时间，本文选取最大遗传

代数为 50。

分别取种群数量为 5、10、15、20、25、30 进行实验，分析种群数量对遗传

算法的影响。实验结果如表 5.3 所示：

表 5.3 种群数量对遗传算法的影响

种群数量 ga_option.sizepop

最优参数组合（c,g）

分类准确率 %

5

（56.8015，503.1266）

72.7273

10

（59.9474，454.5922）

72.0269

15

（63.5833，441.7929 ）

72.0158

20

（50.4377，525.9366）

72.7874

25

（50.8121，554.0500）

72.0187

30

（50.9223，536.7675）

72.7862

从表 5.3 中可以看出，遗传算法中种群数量设置为上述不同值时，最优超参数

组合对应的分类准确率没有显著变化。但是种群数量越大，使用遗传算法进行参

47

杭州电子科技大学硕士学位论文

数寻优的时间越长，综合考虑分类准确率和参数寻优消耗的时间，本文选取种群

数量为 20。 在函数模块中，ggap 的默认值为 0.9，选取 ggap 分别为 0.85、0.88、0.90、0.93、
0.95 进行实验，分析不同的 ggap 值对遗传算法的影响。实验结果如表 5.4 所示： 表 5.4 ggap 对遗传算法的影响

ga_option.ggap

最优参数组合（c,g）

分类准确率 %

0.85

（60.8209，492.2643）

72.0779

0.88

（35.7162，587.3304）

72.0819

0.90

（37.5292，593.4740 ）

72.4873

0.93

（40.6819，579.9223）

72.7225

0.95

（48.4868，534.3128）

72.7547

从表 5.4 中可以看出，对遗传算法中 ggap 选项分别设置为上述不同值时，最 优超参数组合对应的分类准确率之间的差异比较小，综合考虑仍取 ggap 选项值为 默认的 0.9。
从上述分析可知，设置交叉验证的 k 值为 5，最大遗传代数为 50 代，种群数

量为 20，ggap 选项为默认的 0.9，使用遗传算法和网格遍历搜索算法相结合对超 参数组合进行寻优，得到的参数寻优结果如表 5.5 所示：

表 5.5 遗传算法和网格遍历搜索算法相结合的参数寻优结果

Best_c

22.4844

Best_g

0.0408

Best_accuracy

80.5195

从表 5.5 中可以看出使用遗传算法和网格遍历搜索算法相结合的联合算法的 参数寻优结果为 C（Best_c）=22.4844，gamma（Best_g）=0.0408，相应的最佳准 确率 Best_accuracy 为 80.5159%。
为了证明遗传算法和网格遍历搜索算法相结合对超参数寻优具有较好的效果，

设计单独使用网格遍历搜索算法作为对照组，其进行参数寻优的结果如表 5.6 所示： 表 5.6 单独使用网格遍历搜索算法进行参数寻优的结果

Best_c

25.8576

Best_g

0.00359

Best_accuracy

79.8701

表 5.6 中可以看出单独使用网格遍历搜索算法的参数寻优结果为 C（Best_c） =25.8576，gamm（a Best_g）=0.00359，相应的最佳准确率 Best_accuracy 为 79.8701%。
由上述表 5.5 和表 5.6 中结果对比可知，单独使用网格遍历搜索算法的寻优结

果对应的模型的最佳准确率为 79.8701%，使用联合算法进行超参数寻优结果对应

48

杭州电子科技大学硕士学位论文
的模型的最佳准确率为 80.5195%。相比较之下，使用联合算法对超参数的寻优结 果更加令人满意，表明本文对参数寻优算法的改进起到了一定的作用。同时可以 看出使用两种不同方法来进行全局寻优时，超参数组合是比较接近的，使用联合 方法对超参数能够进行更加精细的寻优。使用遗传算法和网格遍历搜索算法相结 合得到的超参数的寻优结果是 C=22.4844，gamma=0.0408。
5.2 多分类支持向量机模型的训练
本文中的实验数据是 MIT-BIH 中的 11 例受试者数据，使用多分类支持向量机 来构建睡眠分期模型。在该自动分类模型中，使用的多分类方案是一对一的多分 类支持向量机，支持向量机中的核函数选取径向基核函数，支持向量机中的超参 数为 5.1 节中的参数寻优结果 C=22.4844，gamma=0.0408。在 matlab 平台上使用 林智仁教授的 LIBSMV 包中的函数： model = svmtrain(training_label, training_data_matrix，['libsvm_options']) 对多分类支持向量机进行训练。其中 training_data_matrix 是训练数据集， training_label 是训练数据集对应的类别标签，['libsvm_options']是决定支持向量机 模型的一些参数，如使用的核函数，经过参数寻优后得到的超参数组合等。对于 给定的条件使用该函数进行支持向量机模型的训练，得到训练结果 model。
5.3 多分类支持向量机性能评估
由 5.2 节训练出睡眠分期模型 model，利用测试数据集对模型性能进行测试， 测试数据集分布情况如表 5.7 所示：

表 5.7 测试数据集中各个样本分布情况

slp01a slp01b slp02a slp02b slp03 slp04 slp32 slp41 slp48 slp60 slp67x Total

WAKE

REM

LIGHT

DEEP

Total

2

4

32

34

72

54

8

46

0

108

16

23

67

2

108

32

9

40

0

81

45

22

125

24

216

49

7

150

10

216

118

0

56

18

192

69

27

134

4

234

64

9

154

1

228

86

9

118

0

213

22

0

24

0

46

557

118

946

93

1714

由表 5.7 可知，测试数据集共有 1714 个标签。其中 WAKE 期 557 个标签，REM

期 118 个标签，LIGHT 期 946 个标签，DEEP 期 93 个标签。将测试数据集用训练

49

杭州电子科技大学硕士学位论文
出来的模型进行估计，得到预测标签。使用预测标签和测试集的实际标签构建混 淆矩阵对模型的预测结果进行展示，混淆矩阵如表 5.8 所示：

表 5.8 混淆矩阵

WAKE

REM

LIGHT

DEEP

TOTAL

WAKE

529

67

365

0

961

REM

0

47

138

0

185

LIGHT

18

5

421

9

453

DEEP

10

0

21

84

115

TOTAL

557

118

946

93

1714

表 5.8 混淆矩阵的每一行表示训练出来的模型对测试集的预测标签，每一列表

示测试数据集的实际标签。从该表中可以看出模型对测试集总共进行了 1714 个标

签的预测，其中预测得到 961 个 WAKE 标签、185 个 REM 标签、453 个 LIGHT

标签以及 115 个 DEEP 标签。混淆矩阵对角线上的元素表示预测标签和实际标签

相符，是正确分类；非对角线上的元素表示预测标签和实际标签两者不匹配，是

错误分类。从表 5.8 中可以发现，模型对测试集总共预测出 961 个 WAKE 标签， 其中有 529 个标签是正确的，其他的 WAKE 预测标签分类错误，因此模型对 WAKE 的预测准确率为 529/961=0.55。同时可以计算出模型整体平均准确率为 63.10%。 将表格中的数据进行转换，转换为相应的准确率和错误率如表 5.9 所示：
表 5.9 规范化的混淆矩阵

WAKE

REM

LIGHT

DEEP

WAKE

0.55

0.07

0.38

0.00

REM

0.00

0.25

0.75

0.00

LIGHT

0.04

0.01

0.93

0.02

DEEP

0.09

0.00

0.18

0.73

从表 5.9 中可以看出模型对测试数据集的 WAKE 期、REM 期、LIGHT 期和

DEEP 期的分类准确率分别为 0.55、0.25、0.93 和 0.73。发现该模型对睡眠分期中

的 LIGHT 期和 DEEP 期具有较高的辨识度，但是对 WAKE 期和 REM 期的辨识度

却比较低，究其原因可能是心率变异性和 LIGHT 期、DEEP 期之间具有较强的相

关性。为了提高模型对 WAKE 期和 REM 期的辨识度，可以在后期的研究中加入

呼吸、体动等联动信号。

上述是对测试集整体进行性能分析，表 5.10 展示了模型分别对每一个受试者 的预测准确率结果：

50

受试者 准确 率%

杭州电子科技大学硕士学位论文
表 5.10 睡眠分期模型对每一个受试者的准确率 slp01 slp02 slp03 slp04 slp32 slp41 slp48 slp60 slp67x 均值 60.80 64.72 64.37 50.75 40.37 61.17 71.05 87.32 68.64 63.10

对表 5.10 中的数据进行分析可知，大多数受试者使用睡眠分期模型的分期结 果和专家注释相比较的正确率在 60%以上，模型对 slp60 的分类预测准确率甚至高 达 87.32%。实验结果相较于使用脑电信号进行睡眠分期的正确率要低，这是由于 心电信号相较于脑电信号所蕴含的睡眠信息要少，但是使用心率变异性进行睡眠 分期对非专业医务人员而言仍具备一定的实用性。从表 5.10 中可以发现模型对个 别受试者的睡眠分期的准确率较低，产生这种情况的原因可能是受试者提供的数 据比较少，不能够充分训练模型；也有可能是这些结果对应的受试者的身体情况 和其他人有所不同，需要构建特殊的模型来进行睡眠分期处理。
5.4 模型性能之间的比对
为了验证本文构建的模型相较于其他模型得到了性能上的改进，设计对照组 来进行说明。将包含盒维数和最大李亚普诺夫指数这两个非线性特征的模型和不 包含非线性特征的模型之间的分类准确率进行对比，结果如表 5.11 所示：

表 5.11 含非线性特征的模型和不含非线性特征的模型之间的结果比较 受试者 slp01 slp02 slp03 slp04 slp32 slp41 slp48 slp60 slp67x 均值 有非线 60.80 64.72 64.37 50.75 40.37 61.17 71.05 87.32 68.64 63.10 性特征 准确
率% 无非线 59.11 65.62 57.58 59.86 45.68 62.01 65.26 79.38 61.15 60.21 性特征 准确
率%

从表 5.11 中可以看出使用盒维数和最大李雅普诺夫指数这两个非线性指标构 建的睡眠分期模型相较于不包含非线性指标的模型的分类准确率要高，使用线性 指标盒维数、最大李亚普诺夫指数能提高模型的分类准确率。
5.5 本章小结
本章首先对支持向量机中的超参数进行网格遍历搜索算法和遗传算法的联合 寻优，确定支持向量机中的超参数。接着使用训练数据集对多分类支持向量机进 行训练，得到模型参数后对模型的性能使用测试集进行评测。为了突出本文中对

51

杭州电子科技大学硕士学位论文
心率变异性非线性指标盒维数和最大李雅普诺夫指数构建的作用，进行对照实验 来对比有无非线性特征的模型的分类结果，实验结果表明心率变异性非线性指标 的引入确实有助于睡眠分期模型分类准确率的提升。
52

杭州电子科技大学硕士学位论文
第六章 总结与展望
6.1 本文工作总结
睡眠是人体进行生理机能调节的重要手段。良好的睡眠能使人体的生理机能 得到较好的恢复，拥有良好的精神状态，对学习、工作和生活具有重要意义。但 是随着现代工作压力增加，生活节奏加快，人们的睡眠状况越来越差，继而会引 发多方面问题。低质量的睡眠轻则导致第二天状态萎靡，工作效率不高，重则引 发一些疾病甚至是工作、交通事故。针对这些情况，进行睡眠质量分析的必要性 显而易见。在睡眠质量分析中睡眠分期又是较为基础的环节。传统的 PSG 方法对 睡眠分期有多方面局限性：实验费用昂贵、需要专业人员进行仪器连接操作、受 试者佩戴传感器的束缚感较强，睡眠专家对数据的解读经验等。使用心电相关信 号进行睡眠分期能够克服 PSG 方法中的诸多局限性，本文使用心率变异性时域、 频域和非线性相关特征作为特征向量对多分类支持向量机进行训练来构建睡眠分 期模型。
本课题的研究中查阅了大量国内外文献，了解国内外对睡眠分期模型研究的 一些进展、相关原理和方法。同时将这些方法进行对比分析，得出这些方法的优 点和不足。在已有的研究基础之上，本文使用小波变换、经验模态分解对频域指 标进行提取。鉴于传统对心率变异性分析使用的是时域指标和频域指标，这些指 标仅能反映心率变异性的一部分，而心率变异性本身是一个非线性信号，本文通 过混沌和分形两种非线性分析方法相结合对心率变异性非线性特征指标盒维数、 最大李雅普诺夫指数进行提取。进而使用提取出来的特征向量来训练多分类支持 向量机，构建睡眠分期模型。本文所做的主要工作为如下几个方面：
（1）查阅大量国内外文献，了解国内外对睡眠分期模型的研究进展及相关原 理方法。了解到睡眠分期模型主要有神经网络、马尔科夫、决策树、支持向量机 等模型。在特征工程中，主要选取脑电信号的相关特征以及心电信号的时频域等 传统特征作为特征向量对相关模型进行训练。本文基于 PSG 方法的局限性使用心 率变异性相关特征作为睡眠分期的依据。
（2）鉴于实验设备的局限性，本文采用 MIT-BIH 数据库中相关心电数据作为 仿真数据。对数据库中数据进行分析处理，筛选出合适的数据作为实验数据源。 从实验数据源中提取出 RR 间期序列并进行样条插值和重采样操作，得到等时间间 隔的 RR 间期序列，并且从实验数据源中提取出相关睡眠标签。
53

杭州电子科技大学硕士学位论文
（3）对心率变异性相关时频域和非线性特征进行提取。使用统计方法对 RR 间期均值 MEAN、RR 间期标准差 SDNN、相邻 RR 间期差值的均方根 RMSSD 进 行提取。使用小波变换、经验模态分解对心率变异性频域特征 VLF、LF、HF、LF/HF、 TP 进行提取。由于时频域不能够反映心率变异性这种非线性信号的主要信息，本 文将混沌和分形两种非线性分析方法相结合对心率变异性非线性指标盒维数、最 大李雅普诺夫指数进行提取，这些非线性指标更能够体现非线性信号的信息，提 取出来的特征更加可靠，信息量更加丰富，使用非线性指标能构建出更加准确的 模型。
（4）使用多分类支持向量机对睡眠分期模型进行构建。对多分类支持向量机 中的支持向量机基本理论和多分类方案进行详细介绍并且选用一对一方案作为多 分类解决方案。同时选用径向基核函数作为支持向量机核函数，并在超参数寻优 过程中改进相关优化算法，将网格搜索算法和遗传算法相结合进行参数寻优，使 用提取出来的心率变异性的 3 类 10 种特征作为特征向量并且结合 SMO 算法对支 持向量机进行训练。
（5）对睡眠分期模型进行仿真建模以及相关实验验证。首先选取 k 折交叉验 证的 k 值和遗传算法中的一些参数选项。将网格搜索算法和遗传算法相结合进行 超参数寻优，在遗传算法中将种群数量设置为 20，最大遗传代数设置为 50，得到 的寻优结果为 C=22.4844，gamma=0.0408，此时模型对应的最佳准确率为 80.5195%。 仅使用网格搜索算法进行参数寻优的寻优结果为 C=25.8576，gamma=0.00359，模 型相应的最佳准确率为 79.8701%。对比可知，联合使用网格搜索算法和遗传算法 具有更优异的参数寻优结果，模型相应的最佳准确率更高。将得到的超参数和特 征向量使用 SMO 算法对多分类支持向量机进行训练，然后使用模型对测试数据集 进行分类标签预测，使用混淆矩阵对模型性能进行评估。评估结果显示训练得到 的模型对各个受试者进行睡眠分期的平均准确率为 63.10%，模型对 LIGHT 期和 DEEP 期的分类准确率较高，但是对 WAKE 期和 REM 期的分期效果不是很好。同 时设计不包含最大李雅普诺夫指数、盒维数两个非线性特征的模型作为实验对照 组，进行相应的性能评估。评估结果表明，不包含非线性特征的模型的分类准确 率为 60.21%，比包含非线性指标的模型的分类准确率 63.10%要低，使用非线性特 征的睡眠分期模型更为理想。
6.2 不足与展望
本文对睡眠分期课题进行了比较详细的研究，但是由于时间等原因的限制， 仍然存在一些不足之处需要后继加以改善处理：
（1）脑电中蕴含更加丰富的睡眠信息，脑电信号相较于心电信号对睡眠分期 更加客观，因此使用脑电信号的模型的准确率比心电信号的模型更加高。为了提
54

杭州电子科技大学硕士学位论文
高使用心电信号相关特征进行睡眠分期的准确率，可以采取使用心电-体动-呼吸等 联动信号进行睡眠分期模型的构建。联动信号包含有更加多的睡眠相关信息，构 建出来的模型也会更加准确。
（2）特征工程中提取出来的特征对睡眠各个阶段的属性权重可能不够高，需 要进一步分析来构建更加合理的特征向量。
（3）对多分类方案的选取可能不是很完善，后继需要对多分类方案进行进一 步的比较研究，选取更加合理的多分类方案。
（4）可以使用不同类型的机器学习模型组建集成模型来构建睡眠分期模型， 从而提高准确率。
55

杭州电子科技大学硕士学位论文
致谢
时间飞快流逝，近三年的研究生阶段即将结束了。落笔之前我反复琢磨怎么 给自己的研究生生涯做一个最后的总结，可是思绪万千难以下笔。在这段时光里， 在学业和生活中我收获了很多很多。为人处世以及学习态度方面都得到了极大地 提升。在这里我要感谢很多人，是你们的无私帮助让我不断成长进步，是你们的 激励鼓舞让我不断战胜自我，不断前进。
首先特别感谢恩师董林玺教授。董老师在为学方面极其认真，在学业和科研 上给予了我很大的帮助和教诲，他博学多才的专业知识以及认真负责的学术态度 深深的感染着我，让我在科研工作方面努力学习。老师为人极其宽厚，生活中遇 到不如意的事情可以和老师进行交谈，这在生活中给予了我很大的帮助。同时在 论文撰写过程中，董老师在课题选择、方案选定上给了我很多宝贵意见，使得论 文能够在规定时间内高质量的完成。
感谢我的同门任灵、谯志远、李豪和杨阳，在你们的帮助与支持下，我攻克 了很多项目难关，科研能力得到了很大的提升。还要感谢实验室里一起玩耍一起 科研的小伙伴们，是你们让我的生活更加丰富多彩。
最后我还要深深地感谢我的父母，感谢他们对我无微不至的照顾，感谢在我 迷茫困惑时给我的帮助和鼓励。感谢父母这二十多年来的养育和培养之恩，是你 们让我懂得感恩，让我一直努力奋斗着。
56

杭州电子科技大学硕士学位论文
参考文献
[1] 索艳风. 不同年龄睡眠质量对健康相关生命质量影响的差异研究[D]. 北京中 医药大学, 2017.
[2] 彭文, 王慧娣. 阻塞性睡眠呼吸暂停综合征的研究进展[J]. 中国医药导刊, 2013,(9):1458-1459.
[3] 贺弋. 黑色杀手:睡眠呼吸暂停综合征[J]. 家庭医学, 2008,(2):4-5. [4] 王玉平. 睡眠的生理变化和监测[J]. 中国全科医学, 2006, 9(8):612-613. [5] 成 词 松 , 诸 毅 晖 , 赵 莺 . 论 睡 眠 的 生 理 基 础 [J]. 辽 宁 中 医 药 大 学 学 报 ,
2010,(2):31-32. [6] Aserinsky E, Kleitman N. Regularly occurring periods of eye motility and
concomitant phenomena during sleep[J].Science,1953,118(3062):273-274． [7] Echeschaffen A, Kales A. A manual of standardized terminology,techniques and
scoring system for sleep stage of human[J].US.Public Health Service,1968:1-3． [8] 郭柳, 嵇学智, 孙方清, 朱启霞, 袁霞. 多导睡眠监测(PSG)临床应用[J]. 中华
现代耳鼻喉杂志, 2005. [9] 王伟. 基于脑电信号分析的睡眠监测研究[D]. 长春：吉林大学, 2017. [10] Silveira T L T D, Kozakevicius A J, Rodrigues C R. Single-channel EEG sleep
stage classification based on a streamlined set of statistical features in wavelet domain[J]. Medical & Biological Engineering & Computing, 2017, 55(2):1-10. [11] Ebrahimi F, Mikaeili M, Estrada E, et al. Automatic sleep stage classification based on EEG signals by using neural networks and wavelet packet coefficients[C]. International Conference of the IEEE Engineering in Medicine & Biology Society. Conf Proc IEEE Eng Med Biol Soc, 2008:1151. [12] 吴锋, 俞梦孙, 张宏金,等. 心率变化特征与睡眠分期耦合关系研究[J]. 北京 生物医学工程, 2003, 22(3):184-186. [13] Isa S M, Wasito I, Arymurthy A M. Kernel Dimensionality Reduction on Sleep Stage Classification using ECG Signal[J]. International Journal of Computer Science Issues, 2011, 8(4). [14] Mourad Adnane. Automatic sleep-wake stages classifier based on ECG[J]. ICROS.SICE International Joint Conference,2009:493-498. 一
57

杭州电子科技大学硕士学位论文
[15] Gih Sung Chung, Byoung Hoon Choi, Ko Keun Kim, Yong Gyu Lim, Jin Wook Choi, Do-Un Jeong, Kwang Suk Park. REM Sleep Classification with Respiration Rates[J].6th International Special Topic Conference on ITAB,2007:194-197．
[16] Farideh Ebrahimi, Seyed Kamaledin Setarehdan. DFA—and DWT-based features of HRV signal for automatic sleep staging[J].Biomedical Engineering(ICBME), 2012:335-338.
[17] Emad Malaekah, Chanakya Reddy Patti, Dean Cvetkovic. Automatic Sleep-Wake Ddection using Electrooculogram Signals[J].2014 IEEE Conference on Biomedical Engineering and Sciences,2014:724-728.
[18] M.O.Mendez, M.Matteucci, S.Cerutti, E Aletti, A.M.Bianchi. Sleep Staging Classification Based on HRV:Time-Variant Analysis[J].31st Annual International Conference ofthe IEEE EMBS Minneapolis,2009:9-12.
[19] Barschdorff D, Trowitzsch E, Hanheide I, et al. Sleep stage classification in infants and young children using artificial neural networks[J]. Somnologie Schlafforschung and Schlafmedizin, 1999,(3):119-123.
[20] Tagluk ME, Sezgin N, Akin M. Estimation of Sleep Stages by an Artificial Neural Network Employing EEG, EMG and EOG[J]. Journal of Medical Systems, 2010, 34(4):717-725.
[21] Özşen S. Classification of sleep stages using class-dependent sequential feature selection and artificial neural network[J]. Neural Computing & Applications, 2013, 23(5):1239-1250.
[22] Bsoul M, Minn H, Nourani M, et al. Real-time sleep quality assessment using single-lead ECG and multi-stage SVM classifier[C]. Buenos Aires, Argentina: IEEE, 2010: 1178-1181.
[23] Aboalayon K A I, Faezipour M. Multi-class SVM based on sleep stage identification using EEG signal [C]. Seattle, WA, USA: IEEE, 2015:181-184.
[24] Doroshenkov L G, Konyshev V A, Selishchev S V. Classification of human sleep stages based on EEG processing using hidden Markov models[J]. Meditsinskaia Tekhnika, 2007, 41(1):25-28.
[25] Yoshimura M, Murata N. Predicting sleep stages based on time-dependent hidden Markov model[J]. Ieice Technical Report Neurocomputing, 2006, 106(101):7-12.
[26] Giri E P, Arymurthy A M, Fanany M I, et al. Sleep stages classification using shallow classifiers[C]. Depok, Indonesia :IEEE, 2016:297-301.
[27] Calvet L E, Friedman J S, Querlioz D, et al. Sleep stage classification with stochastic Bayesian inference[C]. Beijing, China : IEEE, 2016:117-122.
58

杭州电子科技大学硕士学位论文
[28] 高群霞. 基于 EEG 的睡眠分期与睡眠评估方法研究[D]. 广东工业大学，2015. [29] 唐其彪. 基于脑电信号的自动睡眠分期研究[D]. 广东工业大学, 2016. [30] 贾花萍. 基于神经网络集成的睡眠脑电分期研究[J]. 计算技术与自动化, 2012,
31(2):34-36. [31] 张泾周, 李陈, 李婷, 等. 基于神经网络的心电信号分类方法研究[J]. 中国医
疗器械杂志, 2008, 32(3):183-185. [32] 江朝晖, 李继伟, 冯焕清,等. 隐马尔可夫模型在睡眠分期中的应用[J]. 生物
医学工程研究, 2003, 22(2):4-7. [33] 宁艳, 江朝晖, 安滨, 等. 睡眠生理参数的去趋势波动分析[J]. 生物医学工程
学杂志, 2007, 24(2):249-252. [34] 郑慧君, 俞梦孙, 曹征涛, 等. 基于微动敏感床垫式睡眠监测系统的心率检测
[J]. 北京生物医学工程, 2009, 28(5):486-489. [35] Ichimaru Y, Moody GB. Development of the polysomnographic database on
CD-ROM[J]. Psychiatry and Clinical Neurosciences ,1999 ,53(2):175-177. [36] Lee JM, Kim DJ, Kim IY, Park KS, Kim SI. Detrended fluctuation analysis of EEG
in sleep apnea using MIT/BIH polysomnography data[J]. Computer Biology Medical,2002, 32(1):37-47. [37] Rigney DR, Goldberger AL, Ocasio WC ,et al. Time Series Prediction: Multichannel physiological data description and analysis[J]. Addison-Wesley, 1994, 105-129. [38] Garpestad E, Katayama H, Parker JA, Ringler J, Lilly J, Yasuda T, Moore RH, Strauss HW, Weiss JW. Stroke volume and cardiac output decrease at termination of obstructive apneas[J]. Appl Physiol,1992, 73(5):1743-1748 . [39] Ichimaru Y, Clark KP, Ringler J, Weiss WJ. Effect of sleep stage on the relationship between respiration and heart rate variability[C]. Chicago, IL, USA, USA:IEEE,1990:657-660. [40] Tamaki N, Yasuda T, Moore RH, Gill JB, Boucher CA, Hutter AM, Gold HK, Strauss HW. Continuous monitoring of left ventricular function by an ambulatory radionuclide detector in patients with coronary artery disease[J]. JACC, 1988, 12(3):669-679. [41] Goldberger AL, Amaral LAN, Glass L, Hausdorff JM, Ivanov PCh, Mark RG, Mietus JE, Moody GB, Peng C-K, Stanley HE. PhysioBank, PhysioToolkit, and PhysioNet: Components of a New Research Resource for Complex Physiologic Signals. Circulation 101(23):e215-e220[Circulation Electronic Pages; http://circ.ahajournals.org/content/101/23/e215.full]; 2000(June 13).
59

杭州电子科技大学硕士学位论文
[42] 庹 焱 , 陶 红 , 朱铨 英 . 心 率 变 异 性 研 究 进 展 [J]. 临 床 与 病理 杂 志 , 2001, 21(4):305-308.
[43] 富 路, 池洪杰 . 心率变异性的 应用及 评价 [J]. 中国实用内科杂志 , 2001, 21(5):269-271.
[44] 蒋景英, 吴芝芳, 郑旭媛, 等. 基于混沌理论的心率变异性的研究[C]. 北京： 全国信号处理学术年会. 1999:19-22
[45] 吕可诚, 王继业, 常树人, 等. 心率变异性的非线性分析──人体心搏的混沌 特性[J]. 南开大学学报(自然科学版), 1997,(1):20-26.
[46] 卢金婧, 迟鑫姝. 基于复杂度的心率变异性分析研究进展[J]. 现代电生理学 杂志, 2009, 9(3):155-158.
[47] 辛厚文. 分形理论及其应用[M]. 合肥：中国科学技术大学出版社, 1993. [48] 王东升, 汤鸿霄, 栾兆坤. 分形理论及其研究方法[J]. 环境科学学报, 2001,
1(S1):10-16. [49] 唐巍, 李殿璞, 陈学允. 混沌理论及其应用研究[J]. 电力系统自动化, 2000,
24(7):67-70. [50] 吴彤. 非线性动力学混沌理论方法及其意义[J]. 清华大学学报(哲学社会科学
版), 2000, (3):72-79. [51] 郭彤颖, 吴成东, 曲道奎. 小波变换理论应用进展[J]. 信息与控制, 2004,
33(1):67-71. [52] 龚志强, 邹明玮, 高新全, 等. 基于非线性时间序列分析经验模态分解和小波
分解异同性的研究[J]. 物理学报, 2005, 54(8):3947-3957. [53] 王 万 恒 . 盒 维 数 的 一 个 等 价 定 义 及 其 应 用 [J]. 数 学 物 理 学 报 , 1999,
19(2):130-137. [54] 王炳雪, 史忠科, 吴方向. 时间序列曲线盒维数的一种快速算法[J]. 系统工程,
2000, 18(4):68-72. [55] 马军海, 陈予恕. 混沌时序相空间重构的分析和应用研究[J]. 应用数学和力
学, 2000, 21(11):1117-1124. [56] 肖方红, 阎桂荣, 韩宇航. 混沌时序相空间重构参数确定的信息论方法[J]. 物
理学报, 2005, 54(2):550-556. [57] 王富强, 王东风, 韩璞, 等. 基于混沌相空间重构与支持向量机的风速预测[J].
太阳能学报, 2012, 33(8):1321-1326. [58] 孙海云, 曹庆杰. 相空间重构延迟时间的确定[J]. 山东大学学报(工学版),
2000, 30(2):107-110. [59] 修春波, 刘向东, 张宇河. 相空间重构延迟时间与嵌入维数的选择[J]. 北京理
工大学学报, 2003, 23(2):219-224.
60

杭州电子科技大学硕士学位论文
[60] 刘树勇, 朱石坚, 俞翔. 确定相空间重构嵌入维数的研究[J]. 哈尔滨工程大学 学报, 2008, 29(4):374-381.
[61] 张勇, 关伟. 基于最大李亚普诺夫指数的改进混沌时间序列预测[J]. 信息与 控制, 2009, 38(3):360-364.
[62] 鲁宏伟, 吴雅, 杨叔子. 基于时序的李亚普诺夫指数谱的计算[J]. 华中理工大 学学报, 1995, (6):109-112.
[63] 方瑞明. 支持向量机理论及其应用分析[M]. 湖南：中国电力出版社, 2007. [64] 萧嵘, 王继成, 张福炎. 支持向量机理论综述[J]. 计算机科学, 2000, 27(3):1-3. [65] 李航. 统计学习方法[M]. 北京：清华大学出版社, 2012. [66] 周志华. 机器学习[M]. 北京：清华大学出版社, 2016. [67] 韩家炜, MichelineKamber, 裴健, 等. 数据挖掘:概念与技术[M]. 北京：机械工
业出版社, 2012. [68] 汪镭, 康琦, 吴启迪. 群体智能算法总体模式的形式化研究[J]. 信息与控制,
2004, 33(6):694-697. [69] 吉根林. 遗传算法研究综述[J]. 计算机应用与软件, 2004, 21(2):69-73. [70] 周明, 孙树栋. 遗传算法原理及应用[M].北京：国防工业出版社, 1999. [71] 宋晓峰, 钱志余, 姜斌. 支持向量机 SMO 算法训练过程分析[C]. 西安：中国
生物医学工程联合学术年会. 2007： [72] 黄勇, 郑春颖, 宋忠虎, 等. 多类支持向量机算法综述[J]. 计算技术与自动化,
2005, 24(4):61-63. [73] 赵春晖, 陈万海, 郭春燕. 多类支持向量机方法的研究现状与分析[J]. 智能系
统学报, 2007, 2(2):11-17.
61

杭州电子科技大学硕士学位论文
附录 作者在读期间发表的学术论文及参加的科研项目 一、发表的学术论文和专利
[1] 朱彬. 一种电容式双椭圆盘的微机械带通滤波器. 发明专利，已公开(公开号： CN107248851A)
62

