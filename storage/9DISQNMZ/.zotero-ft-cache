172

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 49, NO. 2, FEBRUARY 2002

to detect and measure the retinal vessels. The vessel width measurement not only provides the size of blood vessel but it is also useful for optimizing the matched filter to improve the successful rate of detection.

An Advanced Detrending Method With Application to HRV Analysis
Mika P. Tarvainen, Perttu O. Ranta-aho, and Pasi A. Karjalainen

ACKNOWLEDGMENT
The authors would like to thank the Singapore National Eye Center for providing image data and clinical details.
REFERENCES
[1] W. Pratt, Digital Image Processing. New York: Wiley, 1978. [2] J. F. Canny, “A computational approach to edge detection,” IEEE Trans.
Pattern Anal. Machine Intell., vol. PAMI-8, pp. 679–698, 1986. [3] Y. Qian, S. Eiho, N. Sugimoto, and M. Fujita, “Automatic extraction of
coronary artery tree on coronary angiograms by morphological operators,” Comput. Cardiol., vol. 25, p. 765, 1998. [4] Y. Sun, “Automated identification of vessel contours in coronary arteriogram by an adaptive tracking algorithm,” IEEE Trans. Med. Imag., vol. 8, pp. 78–88, Feb. 1989. [5] Can, H. Shen, J. Turner, H. Tanenbaum, and B. Roysam, “Rapid automated tracing and feature extraction from retinal fundus images using direct exploratory algorithms,” IEEE Trans. Inform. Technol. Biomed., vol. 3, pp. 125–138, June 1999. [6] P. M. J. Zwet, M. Nettesheim, J. Gerbrands, and J. Reiber, “Derivation of optimal filters for the detection of coronary arteries,” IEEE Trans. Med. Imag., vol. 17, pp. 108–120, Feb. 1998. [7] S. Chaudhuri, S. Chatterjee, N. Katz, and M. Goldbaum, “Detection of blood vessels in retinal images using two-dimensional matched filters,” IEEE Trans. Med. Imag., vol. 3, pp. 263–269, Sept. 1989. [8] F. P. Miles and A. L. Nuttall, “Matched filter estimation of serial blood vessel diameters from video images,” IEEE Trans. Med. Imag., vol. 12, pp. 147–152, June 1993. [9] L. Zhou, M. S. Rzeszotarski, L. J. Singerman, and J. M. Chokreff, “The detection and quantification of retinopathy using digital angiogram,” IEEE Trans. Med. Imag., vol. 13, pp. 619–626, Aug. 1994. [10] O. Chutatape, L. Zheng, and S. M. Krishnan, “Retinal blood vessel detection and tracking by matched Gaussian and Kalman filters,” in Proc. 20th Annu Conf. IEEE Engineering in Medicine and Biology Society, 1998, pp. 3144–3149. [11] W. J. Ohley, Y. Sun, A. S. Most, and D. O. Williams, “A computationally efficient algorithm for tracking coronary arteries on digital arteriograms,” in Proc. IEEE 11th Northeast Bioengineering Conf., Worcester, MA, 1985, pp. 255–258. [12] A. Hoover, V. Kouznetsova, and M. Goldbaum, “Locating blood vessels in retinal images by piecewise threshold probing of a matched filter response,” IEEE Trans. Med. Imag., vol. 19, no. 3, pp. 203–210, 2000. [13] V. Patel, “A new concept in accurately measuring retinal vessel diameter from transmittance and densitometry profile of fundus photographs,” ARVO Abstract. Invest. Ophtha. Vis. Sci., vol. 33, no. 4, pp. 804–804, 1992. [14] P. Jensen, “Video photography of human retinal vessel diameter in vivo,” ARVO Abstract. Invest. Ophtha. Vis. Sci., vol. 33, no. 4, p. 1048, 1992.

Abstract—An advanced, simple to use, detrending method to be used before heart rate variability analysis (HRV) is presented. The method is based on smoothness priors approach and operates like a time-varying finite-impulse response high-pass filter. The effect of the detrending on time- and frequency-domain analysis of HRV is studied.
Index Terms—Heart rate variability, signal detrending, smoothness priors, spectral analysis.
I. INTRODUCTION
Heart rate variability (HRV) is a widely used quantitative marker of autonomic nervous system activity. Various time- and frequency-domain methods have been applied to HRV analysis [1]. A traditional spectral method, power spectral density (PSD) estimation, provides information about power distribution as a function of frequency. Spectral estimation inherently assumes that the signal is at least weakly stationary. However, real HRV is usually nonstationary. Nonstationarities like slow linear or more complex trends in the HRV signal, can cause distortion to time- and frequency-domain analysis. Origins for nonstationarities in HRV are discussed, e.g., in [2].
Two kinds of methods have been used to get around the nonstationarity problem. Weber et al. [3] suggested that HRV data should be systematically tested for nonstationarities and that only stationary segments should be analyzed. Representativeness of these segments in some cases, in comparison with the whole HRV signal, was, however, questioned in [4]. Other methods try to remove the slow nonstationary trends from the HRV signal before analysis. The detrending is usually based on first-order [5], [6] or higher order polynomial [6], [7] models.
In this paper, we present an advanced detrending procedure based on smoothness priors approach. The presented method is simple to use, since the frequency response can be adjusted adequately to different situations by a single parameter. The properties of the method are tested by applying it to real RR interval data and the effect of the method on time- and frequency-domain analysis of HRV is considered.
II. METHODS
A. Data Acquisition
The Electrocardiogram (ECG) was recorded continuously (NeuroScan by NeuroSoft Inc.) during a passive event related potential paradigm, where subject sat in a chair while auditory pitch stimuli were delivered to right ear. Sampling rate of the ECG was 500 Hz.
R 0 R R Discrete event series, i i01 intervals as a function of i occur-
rence times, was constructed by an adaptive QRS detector algorithm. The QRS detector was based on the one presented in [8]. As a result of the detection algorithm, an unevenly sampled RR interval time series was obtained. In order to recover an evenly sampled signal from the irregularly sampled event series, cubic interpolation was applied.

Manuscript received March 2, 2001; revised September 28, 2001. Asterisk indicates corresponding author.
*M. P. Tarvainen is with the University of Kuopio, Department of Applied Physics, P.O. Box 1627, FIN-70211 Kuopio, Finland (e-mail: Mika.Tarvainen @uku.fi).
P. O. Ranta-aho and P. A. Karjalainen are with the University of Kuopio, Department of Applied Physics, FIN-70211 Kuopio, Finland.
Publisher Item Identifier S 0018-9294(02)00637-7.
0018–9294/02$17.00 © 2002 IEEE

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 49, NO. 2, FEBRUARY 2002

173

B. Detrending With Smoothness Priors Method

We denote the RR interval time series as

= 0 0 0 2 0 z (R2 R1; R3 R2; . . . ; RN RN 1)T

N01 (1)

where N is the number of R peaks detected. The RR series can be considered to consist of two components

z = zstat + ztrend

(2)

(a)

where zstat is the nearly stationary RR series of interest and ztrend is the low-frequency aperiodic trend component. The trend component can be modeled with a linear observation model as

ztrend = H + v

(3)

2 2 where H

0 2 (N 1) M is the observation matrix, 

M are the

regression parameters, and v is the observation error. The task is then to

estimate the parameters by some fitting procedure so that the prediction

z^trend = H^ can be used as the estimate of the trend. The properties

of the estimate depend strongly on the properties of the basis vectors

(columns of the matrix H) in the fitting. A widely used method for the

solution of the estimate ^ is the least squares method. We use, however,

a more general approach for the estimation of ^. We state the so-called

regularized least squares solution

k 0 k k k ^

=

arg min 

H

z 2 + 2 Dd(H) 2

(4)

where  is the regularization parameter and Dd indicates the discrete approximation of the dth derivative operator. This is clearly a modifi-
cation of the ordinary least squares solution to the direction in which
k k the side norm Dd(H) gets smaller. In this way, we can implement
prior information about the predicted trend H to the estimation. The
solution of (4) can be written in the form

^ = HT H + 2HT DdT DdH 01 HT z

(5)

z^trend =H^

(6)

where z^trend is the estimated trend which we want to remove. A detailed derivation of the result can be found in [9].

The selection of the observation matrix H can be implemented ac-

cording to some known properties of the data z. For example, a generic

set of Gaussian shaped functions or sigmoids can be used. However, we

want to avoid the problems arising from the basis selection and in this

2 paper we
matrix H

use the =I

tr(iNvi0a1l )c2h(oNic0e1)o.fTihdeenrteigtyulmaraiztraitxiofnorpathrteoofb(s4e)rcvaantiobne

understood to draw the solution toward the null space of the regulariza-

tion matrix Dd. The null space of the second-order difference matrix

contains all first-order curves and, thus, D2 is a good choice for esti-

2 mating
matrix

the D2

aper(iNod0ic3)t2re(Nnd0o1)f

RR series. The is of the form

second-order

difference

0 1 2 1 0 1 1 1 0

D2 =

0
...

1
...

02 1
... ...

... ...

...
0

:

(7)

0 1 1 1 0 0 1 2 1

With these specific choices, the method is called the smoothness priors method [10] and the detrended nearly stationary RR series can be written as

0 0 0 z^stat = z H^ = I (I + 2D2T D2) 1 z:

(8)

(b)
L 0 = = Fig. 1. (a) Time-varying frequency response of (N 1 50 and  10).
Only the first half of the frequency response is presented, since the other half
L is identical. (b) Frequency responses, obtained from the middle row of (cf. = bold lines), for  1, 2, 4, 10, 20, 50, and 300. The corresponding cutoff
frequencies are 0.189, 0.132, 0.093, 0.059, 0.041, 0.025, and 0.011 times the
sampling frequency.

C. PSD Estimation
Methods for PSD estimation can be classified as nonparametric (e.g., methods based on fast Fourier transform) and parametric [methods based on, e.g., autoregressive (AR) time series modeling]. In the latter approach, the RR time series is modeled as an AR(p) process

p

0 0 zt =

aj zt0j + et; t = p + 1; . . . ; N 1

(9)

j=1

where p is the model order, aj are the AR coefficients, and et is the noise term. A modified covariance method is used to solve the AR model. The power spectrum estimate Pz is then calculated as

j j Pz(!) = 1 +

2

0 p
j=1

aj

e

i!j 2

(10)

where 2 is the variance of the prediction error of the model. [11]

III. RESULTS

In order to demonstrate the properties of the proposed detrending

L L 0 method, we first
written as z^stat

consider its frequency = z, where = I

response. (I +

Equation 2D2T D2

)(08)1

can be corre-

sponds to a time-varying finite-impulse response high-pass filter. The
L frequency response of for each discrete time point, obtained as a

Fourier transform of its rows, is presented in Fig. 1(a). It can be seen

that the filter is mostly constant, but the beginning and end of the signal

are handled differently. The filtering effect is attenuated for the first

and last elements of z and, thus, the distortion of end points of data

is avoided. The effect of the smoothing parameter  on the frequency

response of the filter is presented in Fig. 1(b). The cutoff frequency of

the filter decreases when  is increased. Besides, the  parameter the

frequency response naturally depends on the sampling rate of signal z.

The performance of the presented method on real RR interval time

series data is presented in Fig. 2, where it is applied to RR data of four

174

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 49, NO. 2, FEBRUARY 2002

(a) (b)

(c)
Fig. 2. The effect of the detrending method on time- and frequency-domain analysis. (a) Original RR series and fitted trends (above) and detrended RR series (below) for four different data segments. The duration of each data segment is 200 s and they were obtained from different subjects. (b) Effect of the detrending procedure on three time-domain parameters (SDNN, RMSSD, and pNN50). (c) PSD estimates for original (thin line) and detrended (bold line) RR series with Welch’s periodogram method (above) and by using a sixteenth-order AR model (below).

different subjects. Each RR series was first interpolated to obtain a regularly sampled series with sampling rate of 4 Hz. The detrending was
= then performed using a smoothing parameter  300, which equals a
cutoff frequency of 0.043 Hz. The four RR series with the fitted trends and the corresponding detrended series are presented in Fig. 2(a). Three different time-domain parameters, recommended in [1], were selected to demonstrate the effect of the used detrending method on time-domain analysis [Fig. 2(b)]. These were the standard deviation of all RR intervals (SDNN), the square root of the mean-squared differences of successive RR intervals (RMSSD) and the relative amount of successive RR intervals differing more than 50 ms (pNN50).
The effect of the presented detrending method on the PSD estimates calculated with Welch’s periodogram method and by AR modeling is
= presented in Fig. 2(c). AR model order p 16 was selected according
to [1], by using the corrected Akaike information criteria [12]. In each original PSD estimate, the intensity of the very low-frequency (VLF) component is clearly stronger than the intensity of low-frequency (LF) or high-frequency (HF) component. Each spectrum is, however, lim-
ited to 0.035 s2=Hz to enable the comparison of the spectrums before
and after detrending. For Welch’s method, the VLF components are properly removed while the higher frequencies are not significantly altered by the detrending. But when AR models of relatively low orders are used, which is usually desirable in HRV analysis in order to enable a distinct division of the spectrum into VLF, LF, and HF components, the effect of detrending is remarkable. In each original AR spectrum, the peak around 0.1 Hz is spuriously covered by the strong VLF component. However, in the AR spectrums obtained after detrending the component near 0.1 Hz is more realistic when compared to the spectrums obtained by Welch’s method.

IV. DISCUSSION
We have presented an advanced detrending method with application to HRV analysis. The method is based on smoothness priors formulation. The main advantage of the method, compared to methods presented in [5] and [7], is its simplicity. The frequency response of the method is adjusted with a single parameter. This smoothing parameter
 should be selected in such a way that the spectral components of
interest are not significantly affected by the detrending. Another advantage of the presented method is that the filtering effect is attenuated in the beginning and the end of the data and, thus, the distortion of data end points is avoided.
The effect of detrending on time- and frequency-domain analysis of HRV was demonstrated. In time domain, most effect is focused on SDNN, which describes the amount of overall variance of RR series. Instead only little effect is focused on RMSSD and pNN50 which both describe the differences in successive RR intervals. In frequencydomain, the low-frequency trend components increase the power of VLF component. Thus, when using relatively low-order AR models in spectrum estimation detrending is especially recommended, since the strong VLF component distorts other components, especially the LF component, of the spectrum.
The presented detrending method can be applied to, e.g., respiratory sinus arrhythmia (RSA) quantification. RSA component is separated from other frequency components of HRV by adjusting the smoothing
parameter  properly. For other purposes of HRV analysis, one should
make sure that the detrending does not lose any useful information from the lower frequency components. Finally, it should be emphasized that the presented detrending method is not restricted to HRV analysis only,

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 49, NO. 2, FEBRUARY 2002

175

but can be applied as well to other biomedical signals, e.g., for detrending of electroencephalogram (EEG) signals in quantitative EEG analysis.
APPENDIX
All the computation of this paper are executed using MATLAB 6 of The MathWorks Inc. The source code, in all its simplicity, for applying the presented detrending method to signal z is listed below.
For more information, see http://venda.uku.fi/research/biosignal.
REFERENCES
[1] Task Force of the European Society of Cardiology and the North American Society of Pacing and Electrophysiology, “Heart rate variability—standards of measurement, physiological interpretation and clinical use,” Circulation, vol. 93, pp. 1043–1065, Mar. 1996.
[2] G. Berntson, J. T. Bigger, Jr., D. Eckberg, P. Grossman, P. Kaufmann, M. Malik, H. Nagaraja, S. Porges, J. Saul, P. Stone, and W. V. D. Molen, “Heart rate variability: Origins, methods and interpretive caveats,” Psychophysiol., vol. 34, pp. 623–648, 1997.
[3] E. Weber, C. Molenaar, and M. van der Molen, “A nonstationarity test for the spectral analysis of physiological time series with an application to respiratory sinus arrhythmia,” Psychophysiol., vol. 29, pp. 55–65, Jan. 1992.
[4] P. Grossman, “Breathing rhythms of the heart in a world of no steady state: A comment on weber, molenaar and van der molen,” Psychophysiol., vol. 29, pp. 66–72, Jan. 1992.
[5] D. Litvack, T. Oberlander, L. Carney, and J. Saul, “Time and frequency domain methods for heart rate variability analysis: A methodological comparison,” Psychophysiol., vol. 32, pp. 492–504, 1995.
[6] I. Mitov, “A method for assessment and processing of biomedical signals containing trend and periodic components,” Med. Eng. Phys., vol. 20, pp. 660–668, Nov.–Dec. 1998.
[7] S. Porges and R. Bohrer, “The analysis of periodic processes in psychophysiological research,” in Principles of Psychophysiology: Physical Social and Inferential Elements, J. Cacioppo and L. Tassinary, Eds. Cambridge, U.K.: Cambridge Univ. Press, 1990, pp. 708–753.
[8] J. Pan and W. Tompkins, “A real-time QRS detection algorithm,” IEEE Trans. Biomed. Eng., vol. BME-32, pp. 230–236, Mar. 1985.
[9] P. Karjalainen, “Regularization and bayesian methods for evoked potential esimation,” Ph.D. dissertation, Univ. Kuopio, Dept. Appl. Phys., 1997.
[10] W. Gersch, “Smoothness priors,” in New Directions in Time Series Analysis, Part II. Berlin, Germany: Springer-Verlag, 1991, pp. 113–146.
[11] S. Marple, Digital Spectral Analysis with Applications. Englewood Cliffs, NJ: Prentice-Hall, 1987.
[12] F. Gustafsson and H. Hjalmarsson, “Twenty-one ML estimators for model selection,” Automatica, vol. 31, pp. 1377–1392, 1995.

System Design and Performance of a Unilateral Horizontal Semicircular Canal Prosthesis
Wangsong Gong and Daniel M. Merfeld*
Abstract—We have reported preliminary results regarding a prototype semicircular canal prosthesis and concluded that it can provide rotational cues to the nervous system. This paper presents the system design of the prosthesis, and also reports the prosthesis system performance and effectiveness.
The prosthesis delivers electrical pulses to the nerve branch innervating the horizontal semicircular canal on one side via implanted electrodes. To allow us to encode both directions of angular velocity, the baseline stimulation pulse frequency was set at 150 Hz, which is somewhat higher than the average firing rate of afferents innervating the semicircular canals in normal guinea pigs ( 60 Hz). A sensor measures angular velocity to modulate (increase or decrease) the pulse rate.
The prosthetic system was provided to a guinea pig whose horizontal canals were surgically plugged. The animal responded to the baseline stimulation initially and adapted to the baseline stimulation in roughly one day. After this baseline adaptation the animal responded to yaw rotation, showing that the function of the canals was partially restored. The experiments also show that the nervous system adapts to the artificial rotational cue provided via electrical stimulation.
Index Terms—Adaptation, electrical stimulation, guinea pig, neural prosthesis, semicircular canal, vestibular.
I. INTRODUCTION
The primary function of the vestibular system is to provide the nervous system with information about head motion and orientation. This information is essential for postural control and eye movements that compensate for head motion [1]. The afferent fibers innervating the vestibular system run to the vestibular nuclei in the brainstem via the VIIIth cranial nerve. The semicircular canals are the portion of the vestibular system that are sensitive to rotational stimulation; the horizontal (or lateral) semicircular canals respond to yaw head rotations (i.e., those head rotations made when shaking your head to indicate “no”).
Vestibulo-ocular reflexes (VOR) are reflexive eye movements elicited in response to head movements to stabilize the image of the external world on the retina. They are objective, easy to measure, and the most common way to evaluate the vestibular function. Scientific investigations in mammals have documented the effect of electrical stimulation on vestibular responses including VOR [2]–[4] and postural control [5]–[7]. Earlier studies of acute vestibular stimulation have shown that pulsatile electrical stimulation of the canal nerves induces nystagmus parallel to the plane of the canal innervated by the stimulated nerve branch [2], [4]. This mimics the normal response elicited by the semicircular canals, since the canals are primarily sensitive to rotations about an axis that is roughly orthogonal to the plane of the semicircular canal [8]. Rotational cues from the canals are

Manuscript received March 12, 2001; revised October 3, 2001. This work was supported in part by the Whitaker Foundation, in part by the W. M. Keck Foundation, and in part by the National Institutes of Health (NIH)/NIDCD under Grant DC03066. Asterisk indicates corresponding author.
W. Gong is with Department of Otology and Laryngology, Harvard Medical School and the Jenks Vestibular Physiology Laboratory, Massachusetts Eye and Ear Infirmary, Boston, MA 02114 USA.
*D. M. Merfeld is with the Department of Otology and Laryngology, Harvard Medical School and Jenks Vestibular Physiology Laboratory, , Massachusetts Eye and Ear Infirmary, 243 Charles Street, Room 421, Boston, MA 02114 USA (e-mail: merfeld@meei.harvard.edu).
Publisher Item Identifier S 0018-9294(02)00638-9.
0018–9294/02$17.00 © 2002 IEEE

